{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{K as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projectionUtils.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends e{constructor(t){super(t),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:t,grid:e}=this;if(!e||!t||!p(e.center.spatialReference,t))return null;try{const r=l(e.center,t),i=t.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,t):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:g(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?n(t.spacing,t.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return null==t?null:t*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(t,e,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(t),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(t.spatialReference,g))return r;const S=l(t,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=j(x,C,s),{shouldSnapX:b,shouldSnapY:L}=R(U,x,e,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const t=M(U,x,C,\"y\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}if(b){const t=M(U,x,C,\"x\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};t([o({constructOnly:!0})],w.prototype,\"view\",void 0),t([o()],w.prototype,\"options\",void 0),t([o()],w.prototype,\"grid\",null),t([o()],w.prototype,\"effectiveViewRotation\",null),t([o()],w.prototype,\"gridRotation\",null),t([o()],w.prototype,\"gridCenter\",null),t([o()],w.prototype,\"offsetScaleFactor\",null),t([o()],w.prototype,\"spatialReference\",null),t([o()],w.prototype,\"gridMetersPerStride\",null),t([o()],w.prototype,\"viewMetersPerPixel\",null),t([o()],w.prototype,\"viewMetersPerSRUnit\",null),t([o()],w.prototype,\"pixelsPerStride\",null),t([o()],w.prototype,\"updating\",null),w=t([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(t,e,r,i)=>{const n=m(t[0],t[1],t[2]);return a(n,a(n,n,r,e),r,i)},j=(t,e,r)=>{const i=(t[0]-r[0])/e,n=(t[1]-r[1])/e,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*e,c=r[1]+(s+p)*e;return h(l,c)},R=(t,e,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(t[0]-e[0])/i,s=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(t,e,r,i)=>{if(\"y\"===i){const i=e[0]>t[0]?1:-1;return h(t[0]+r*i,t[1])}const n=e[1]>t[1]?1:-1;return h(t[0],t[1]+r*n)};export{w as GridSnappingEngine};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI2vC,IAAIA,KAAE,cAAc,EAAC;AAAA,EAAC,YAAYC,IAAE;AAAC,UAAMA,EAAC,GAAE,KAAK,UAAQ;AAAA,EAAI;AAAA,EAAC,UAAS;AAAC,SAAK,KAAK,WAAU,IAAI;AAAA,EAAC;AAAA,EAAC,IAAI,OAAM;AAAC,WAAO,KAAK,KAAK;AAAA,EAAI;AAAA,EAAC,IAAI,wBAAuB;AAAC,WAAO,KAAK,MAAM,gBAAc,IAAE,EAAE,KAAK,KAAK,YAAU,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,eAAc;AAAC,WAAO,EAAE,KAAK,MAAM,YAAU,CAAC;AAAA,EAAC;AAAA,EAAC,IAAI,aAAY;AAAC,UAAK,EAAC,kBAAiBA,IAAE,MAAK,EAAC,IAAE;AAAK,QAAG,CAAC,KAAG,CAACA,MAAG,CAAC,EAAE,EAAE,OAAO,kBAAiBA,EAAC,EAAE,QAAO;AAAK,QAAG;AAAC,YAAMC,KAAE,EAAE,EAAE,QAAOD,EAAC,GAAEE,KAAEF,GAAE,eAAa,QAAM,KAAK,MAAM,SAAO,EAAEC,GAAE,GAAE,KAAK,KAAK,OAAO,GAAED,EAAC,IAAEC,GAAE;AAAE,aAAO,EAAEC,IAAED,GAAE,GAAEA,GAAE,CAAC;AAAA,IAAC,SAAOC,IAAE;AAAC,aAAO,EAAE,UAAU,IAAI,EAAE,UAAU,kDAAiDA,EAAC,GAAE;AAAA,IAAI;AAAA,EAAC;AAAA,EAAC,IAAI,oBAAmB;AAAC,UAAK,EAAC,iBAAgBF,IAAE,MAAK,EAAC,IAAE;AAAK,QAAG,CAAC,KAAG,CAACA,GAAE,QAAO;AAAE,UAAK,EAAC,mBAAkBC,IAAE,gBAAeC,GAAC,IAAE;AAAE,WAAOD,KAAE,IAAE,OAAK,EAAEA,IAAED,IAAEE,EAAC;AAAA,EAAC;AAAA,EAAC,IAAI,mBAAkB;AAAC,WAAO,KAAK,KAAK;AAAA,EAAgB;AAAA,EAAC,IAAI,sBAAqB;AAAC,UAAK,EAAC,MAAKF,GAAC,IAAE;AAAK,WAAOA,KAAE,EAAEA,GAAE,SAAQA,GAAE,OAAM,QAAQ,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,qBAAoB;AAAC,UAAK,EAAC,qBAAoBA,GAAC,IAAE;AAAK,WAAO,QAAMA,KAAE,OAAKA,KAAE,EAAE,KAAK,KAAK,OAAM,KAAK,KAAK,gBAAgB;AAAA,EAAC;AAAA,EAAC,IAAI,sBAAqB;AAAC,UAAK,EAAC,kBAAiBA,GAAC,IAAE,KAAK;AAAK,WAAO,KAAK,aAAWG,GAAE,KAAK,WAAW,CAAC,GAAE,KAAK,WAAW,CAAC,GAAEH,EAAC,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,kBAAiB;AAAC,UAAK,EAAC,qBAAoBA,IAAE,oBAAmB,EAAC,IAAE;AAAK,WAAO,KAAGA,KAAEA,KAAE,IAAE;AAAA,EAAI;AAAA,EAAC,IAAI,WAAU;AAAC,WAAO,QAAM,KAAK,QAAM,QAAM,KAAK,oBAAkB,QAAM,KAAK;AAAA,EAAmB;AAAA,EAAC,MAAM,gBAAgBA,IAAE,GAAEC,IAAE;AAAC,UAAK,EAAC,SAAQC,IAAE,MAAK,EAAC,IAAE;AAAK,QAAG,CAACA,IAAG,wBAAsB,CAAC,EAAE,QAAMD,GAAE,SAAS,cAAY,KAAKA,GAAE,QAAQ,WAAW,QAAM,CAAC;AAAE,UAAM,IAAEA,GAAE,iBAAiB,aAAaD,EAAC,GAAEI,KAAEF,GAAE,YAAU,YAAUD,GAAE,UAAQC,GAAE,6BAA2B;AAAG,WAAO,KAAK,oBAAoB,GAAEE,EAAC;AAAA,EAAC;AAAA,EAAC,oBAAoBJ,IAAE,GAAE;AAAC,UAAMC,KAAE,CAAC,GAAE,EAAC,MAAKC,IAAE,uBAAsB,GAAE,cAAa,GAAE,YAAWE,IAAE,oBAAmBC,IAAE,qBAAoBC,IAAE,mBAAkBH,IAAE,kBAAiB,GAAE,qBAAoBI,IAAE,iBAAgBC,GAAC,IAAE;AAAK,QAAG,EAAEN,MAAGG,MAAGC,MAAGF,MAAG,KAAGD,MAAGI,MAAGC,IAAG,QAAOP;AAAE,QAAG,CAACC,GAAE,kBAAgBM,KAAE,EAAE,QAAOP;AAAE,QAAG,CAAC,EAAED,GAAE,kBAAiB,CAAC,EAAE,QAAOC;AAAE,UAAM,IAAE,EAAED,IAAE,CAAC,GAAED,KAAE,EAAE,EAAE,GAAE,EAAE,GAAE,EAAE,CAAC,GAAE,IAAEU,GAAEV,IAAE,CAAC,GAAEK,IAAE,CAAC,CAAC,GAAE,IAAEG,KAAED,KAAEH,IAAEO,KAAEC,GAAE,GAAE,GAAEP,EAAC,GAAE,EAAC,aAAYQ,IAAE,aAAY,EAAC,IAAE,EAAEF,IAAE,GAAE,GAAEL,IAAEC,EAAC;AAAE,QAAG,CAACM,MAAG,CAAC,EAAE,QAAM,CAAC;AAAE,UAAM,IAAE,GAAGA,KAAEF,KAAE,GAAG,CAAC,IAAG,IAAEA,KAAE,GAAG,CAAC,CAAC,GAAE,IAAED,GAAE,GAAE,GAAEL,IAAE,CAAC,GAAE,IAAEK,GAAEC,IAAE,GAAEN,IAAE,CAAC;AAAE,QAAG,GAAE;AAAC,YAAMJ,KAAE,EAAEU,IAAE,GAAE,GAAE,GAAG,GAAEG,KAAEJ,GAAET,IAAE,GAAEI,IAAE,CAAC;AAAE,MAAAH,GAAE,KAAK,IAAIA,GAAE,EAAC,WAAU,GAAE,SAAQY,IAAE,aAAY,GAAE,UAAS,MAAE,CAAC,CAAC;AAAA,IAAC;AAAC,QAAGD,IAAE;AAAC,YAAMZ,KAAE,EAAEU,IAAE,GAAE,GAAE,GAAG,GAAEG,KAAEJ,GAAET,IAAE,GAAEI,IAAE,CAAC;AAAE,MAAAH,GAAE,KAAK,IAAIA,GAAE,EAAC,WAAU,GAAE,SAAQY,IAAE,aAAY,GAAE,UAAS,MAAE,CAAC,CAAC;AAAA,IAAC;AAAC,WAAOD,MAAG,KAAGX,GAAE,KAAK,IAAIA,GAAE,GAAEA,GAAE,CAAC,GAAEA,GAAE,CAAC,GAAE,KAAE,CAAC,GAAEA;AAAA,EAAC;AAAC;AAAE,EAAE,CAAC,EAAE,EAAC,eAAc,KAAE,CAAC,CAAC,GAAEF,GAAE,WAAU,QAAO,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,WAAU,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,QAAO,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,yBAAwB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,gBAAe,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,cAAa,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,qBAAoB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,oBAAmB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,uBAAsB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,sBAAqB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,uBAAsB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,mBAAkB,IAAI,GAAE,EAAE,CAAC,EAAE,CAAC,GAAEA,GAAE,WAAU,YAAW,IAAI,GAAEA,KAAE,EAAE,CAAC,EAAE,oDAAoD,CAAC,GAAEA,EAAC;AAAE,IAAMU,KAAE,CAACT,IAAE,GAAEC,IAAEC,OAAI;AAAC,QAAM,IAAE,EAAEF,GAAE,CAAC,GAAEA,GAAE,CAAC,GAAEA,GAAE,CAAC,CAAC;AAAE,SAAO,EAAE,GAAE,EAAE,GAAE,GAAEC,IAAE,CAAC,GAAEA,IAAEC,EAAC;AAAC;AAAxE,IAA0ES,KAAE,CAACX,IAAE,GAAEC,OAAI;AAAC,QAAMC,MAAGF,GAAE,CAAC,IAAEC,GAAE,CAAC,KAAG,GAAE,KAAGD,GAAE,CAAC,IAAEC,GAAE,CAAC,KAAG,GAAE,IAAE,KAAK,MAAMC,EAAC,GAAEE,KAAE,KAAK,MAAM,CAAC,GAAEC,KAAE,KAAK,MAAMH,KAAE,CAAC,GAAE,IAAE,KAAK,MAAM,IAAE,CAAC,GAAEY,KAAEb,GAAE,CAAC,KAAG,IAAEI,MAAG,GAAEC,KAAEL,GAAE,CAAC,KAAGG,KAAE,KAAG;AAAE,SAAO,EAAEU,IAAER,EAAC;AAAC;AAA3O,IAA6O,IAAE,CAACN,IAAE,GAAEC,IAAEC,IAAE,MAAI;AAAC,MAAGA,MAAG,EAAE,QAAM,EAAC,aAAY,OAAG,aAAY,MAAE;AAAE,QAAM,KAAGF,GAAE,CAAC,IAAE,EAAE,CAAC,KAAGE,IAAEE,MAAGJ,GAAE,CAAC,IAAE,EAAE,CAAC,KAAGE;AAAE,SAAM,EAAC,aAAY,KAAK,IAAI,IAAE,CAAC,IAAED,IAAE,aAAY,KAAK,IAAIG,KAAE,CAAC,IAAEH,GAAC;AAAC;AAAhZ,IAAkZ,IAAE,CAACD,IAAE,GAAEC,IAAEC,OAAI;AAAC,MAAG,QAAMA,IAAE;AAAC,UAAMA,KAAE,EAAE,CAAC,IAAEF,GAAE,CAAC,IAAE,IAAE;AAAG,WAAO,EAAEA,GAAE,CAAC,IAAEC,KAAEC,IAAEF,GAAE,CAAC,CAAC;AAAA,EAAC;AAAC,QAAM,IAAE,EAAE,CAAC,IAAEA,GAAE,CAAC,IAAE,IAAE;AAAG,SAAO,EAAEA,GAAE,CAAC,GAAEA,GAAE,CAAC,IAAEC,KAAE,CAAC;AAAC;",
  "names": ["w", "t", "r", "i", "u", "s", "a", "c", "f", "m", "P", "U", "j", "b", "e", "l"]
}
