import {
  a as a4,
  c,
  d as d2,
  u
} from "./chunk-K4QKI25R.js";
import {
  R,
  V as V2
} from "./chunk-TQYXUH7I.js";
import {
  $,
  Z,
  w
} from "./chunk-2JAL6FAS.js";
import "./chunk-P4RYESYB.js";
import "./chunk-BMFPNVV7.js";
import "./chunk-HCBZZ3ZP.js";
import "./chunk-PXOUV6KP.js";
import {
  i as i3
} from "./chunk-PZV6BOD6.js";
import {
  l as l3
} from "./chunk-H7SHPX7W.js";
import {
  s as s2
} from "./chunk-GESOBEYT.js";
import {
  p
} from "./chunk-OQ76WPLD.js";
import {
  e as e2
} from "./chunk-KSVHYEPS.js";
import "./chunk-ELSQQIKB.js";
import {
  j
} from "./chunk-VGIEH4HM.js";
import {
  t
} from "./chunk-X5GD6LFD.js";
import {
  b2 as b,
  d,
  l as l2,
  m as m3
} from "./chunk-G4PMFSAZ.js";
import "./chunk-MX5VW6PC.js";
import "./chunk-JJNHUYXK.js";
import "./chunk-UG6RJXJ2.js";
import {
  S
} from "./chunk-OTCYHWWG.js";
import "./chunk-UGXCZZ7N.js";
import "./chunk-7DFHXN7Z.js";
import "./chunk-NX54JGTL.js";
import "./chunk-JEYXDNAT.js";
import "./chunk-FEGY3M6U.js";
import "./chunk-QG7JWSBW.js";
import "./chunk-5GBXHGKW.js";
import {
  m as m2
} from "./chunk-6TS2ZJL4.js";
import "./chunk-IBGTNH54.js";
import "./chunk-YZLWQJLF.js";
import {
  h
} from "./chunk-L7EN54WK.js";
import "./chunk-6QTMK7BB.js";
import "./chunk-7NMH5MM5.js";
import "./chunk-TCIXF7MM.js";
import "./chunk-UGTICYU7.js";
import "./chunk-3MHRDLQO.js";
import "./chunk-F4KXGA4J.js";
import {
  i3 as i2,
  q
} from "./chunk-YX2VTIZR.js";
import "./chunk-KE3WBZYL.js";
import {
  r as r3
} from "./chunk-EOMIFMDH.js";
import "./chunk-QFU5COFB.js";
import "./chunk-45ILJ6ZH.js";
import "./chunk-VCRP2PLV.js";
import "./chunk-BDLVUYG2.js";
import "./chunk-6QA2BVC5.js";
import "./chunk-HWKQJUGY.js";
import "./chunk-6KFXWKZZ.js";
import "./chunk-HPGYEHVI.js";
import "./chunk-YBJ5GVXQ.js";
import "./chunk-X3R5OB6L.js";
import "./chunk-RACDQ3AL.js";
import "./chunk-TEXTBDH7.js";
import "./chunk-TVM3SZJR.js";
import "./chunk-52HWRRRQ.js";
import "./chunk-VNTEV3V4.js";
import "./chunk-OGOQOMMV.js";
import "./chunk-7Z3AF3B2.js";
import "./chunk-6GWORUT3.js";
import "./chunk-HCYE6OE4.js";
import "./chunk-KJSBBQ22.js";
import "./chunk-LMEOPAGQ.js";
import "./chunk-YIV2QKTZ.js";
import "./chunk-A3VAC24F.js";
import "./chunk-FPSA4NFH.js";
import "./chunk-UY6B6IVT.js";
import "./chunk-6PV45IYU.js";
import "./chunk-SRQCQD63.js";
import "./chunk-FIRNXFAH.js";
import "./chunk-O5TPFXRT.js";
import "./chunk-Q6XRAGMA.js";
import {
  o
} from "./chunk-JUAPMINU.js";
import "./chunk-PK2ZR2SJ.js";
import {
  r as r2
} from "./chunk-YFPGM5UE.js";
import "./chunk-OXSERRAR.js";
import "./chunk-7HI4VRVW.js";
import "./chunk-ZX46THLM.js";
import "./chunk-Y2ZIOB7Y.js";
import "./chunk-KTUX3OKX.js";
import {
  l
} from "./chunk-E3KEUGUG.js";
import {
  m
} from "./chunk-N3XLUQJI.js";
import {
  a2
} from "./chunk-JUAD7TJ6.js";
import {
  x
} from "./chunk-VHLUKPRH.js";
import {
  r
} from "./chunk-5TPMG26T.js";
import "./chunk-3NBBZ43U.js";
import "./chunk-VOLWOTEG.js";
import "./chunk-XTNIDRTB.js";
import "./chunk-FGWIXJQY.js";
import "./chunk-TKYAZCMB.js";
import "./chunk-3TBMFSPB.js";
import "./chunk-PSZLDJJA.js";
import {
  H
} from "./chunk-ZWFY3WY5.js";
import {
  V
} from "./chunk-LQFTAGIV.js";
import "./chunk-S7IJH524.js";
import {
  a as a3
} from "./chunk-GZ2P4SCJ.js";
import {
  i2 as i,
  s
} from "./chunk-XWG6QGFK.js";
import {
  a,
  e
} from "./chunk-GWNLQRNM.js";
import "./chunk-FXKORAMT.js";
import "./chunk-GNMFMITH.js";

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudFilter.js
var t2 = class extends l {
  constructor(o2) {
    super(o2), this.field = null, this.type = null;
  }
  clone() {
    return console.warn(".clone() is not implemented for " + this.declaredClass), null;
  }
};
r([m({ type: String, json: { write: { enabled: true, isRequired: true } } })], t2.prototype, "field", void 0), r([m({ readOnly: true, nonNullable: true, json: { read: false, write: { isRequired: true } } })], t2.prototype, "type", void 0), t2 = r([a2("esri.layers.pointCloudFilters.PointCloudFilter")], t2);
var i4 = t2;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudBitfieldFilter.js
var d3;
var p2 = d3 = class extends i4 {
  constructor(e4) {
    super(e4), this.requiredClearBits = null, this.requiredSetBits = null, this.type = "bitfield";
  }
  clone() {
    return new d3({ field: this.field, requiredClearBits: a(this.requiredClearBits), requiredSetBits: a(this.requiredSetBits) });
  }
};
r([m({ type: [x], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredSetBits };
} } } })], p2.prototype, "requiredClearBits", void 0), r([m({ type: [x], json: { write: { enabled: true, overridePolicy() {
  return { enabled: true, isRequired: !this.requiredClearBits };
} } } })], p2.prototype, "requiredSetBits", void 0), r([r3({ pointCloudBitfieldFilter: "bitfield" })], p2.prototype, "type", void 0), p2 = d3 = r([a2("esri.layers.pointCloudFilters.PointCloudBitfieldFilter")], p2);
var u2 = p2;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudReturnFilter.js
var n;
var p3 = n = class extends i4 {
  constructor(r4) {
    super(r4), this.includedReturns = [], this.type = "return";
  }
  clone() {
    return new n({ field: this.field, includedReturns: a(this.includedReturns) });
  }
};
r([m({ type: [["firstOfMany", "last", "lastOfMany", "single"]], json: { write: { enabled: true, isRequired: true } } })], p3.prototype, "includedReturns", void 0), r([r3({ pointCloudReturnFilter: "return" })], p3.prototype, "type", void 0), p3 = n = r([a2("esri.layers.pointCloudFilters.PointCloudReturnFilter")], p3);
var u3 = p3;

// node_modules/@arcgis/core/layers/pointCloudFilters/PointCloudValueFilter.js
var l4;
var p4 = l4 = class extends i4 {
  constructor(e4) {
    super(e4), this.mode = "exclude", this.type = "value", this.values = [];
  }
  clone() {
    return new l4({ field: this.field, mode: this.mode, values: a(this.values) });
  }
};
r([m({ type: ["exclude", "include"], json: { write: { enabled: true, isRequired: true } } })], p4.prototype, "mode", void 0), r([r3({ pointCloudValueFilter: "value" })], p4.prototype, "type", void 0), r([m({ type: [Number], json: { write: { enabled: true, isRequired: true } } })], p4.prototype, "values", void 0), p4 = l4 = r([a2("esri.layers.pointCloudFilters.PointCloudValueFilter")], p4);
var u4 = p4;

// node_modules/@arcgis/core/layers/pointCloudFilters/typeUtils.js
var e3 = { key: "type", base: i4, typeMap: { value: u4, bitfield: u2, return: u3 } };

// node_modules/@arcgis/core/renderers/PointCloudRGBRenderer.js
var p5;
var c2 = p5 = class extends c {
  constructor(r4) {
    super(r4), this.type = "point-cloud-rgb", this.field = null;
  }
  clone() {
    return new p5({ ...this.cloneProperties(), field: a(this.field) });
  }
};
r([r3({ pointCloudRGBRenderer: "point-cloud-rgb" })], c2.prototype, "type", void 0), r([m({ type: String, json: { write: { isRequired: true } } })], c2.prototype, "field", void 0), c2 = p5 = r([a2("esri.renderers.PointCloudRGBRenderer")], c2);
var n2 = c2;

// node_modules/@arcgis/core/renderers/support/pointCloud/typeUtils.js
var i5 = { key: "type", base: c, typeMap: { "point-cloud-class-breaks": a4, "point-cloud-rgb": n2, "point-cloud-stretch": d2, "point-cloud-unique-value": u }, errorContext: "renderer" };

// node_modules/@arcgis/core/layers/PointCloudLayer.js
var O = s2();
var V3 = class extends R(l3(b(j(t(S(e2(i3(h)))))))) {
  constructor(...e4) {
    super(...e4), this.operationalLayerType = "PointCloudLayer", this.popupEnabled = true, this.popupTemplate = null, this.opacity = 1, this.filters = [], this.fields = null, this.fieldsIndex = null, this.outFields = null, this.path = null, this.legendEnabled = true, this.renderer = null, this.type = "point-cloud";
  }
  normalizeCtorArgs(e4, r4) {
    return "string" == typeof e4 ? { url: e4, ...r4 } : e4;
  }
  get defaultPopupTemplate() {
    return this.attributeStorageInfo ? this.createPopupTemplate() : null;
  }
  getFieldDomain(e4) {
    const r4 = this.fieldsIndex.get(e4);
    return r4?.domain ? r4.domain : null;
  }
  readServiceFields(e4, r4, t3) {
    return Array.isArray(e4) ? e4.map((e5) => {
      const r5 = new m2();
      return "FieldTypeInteger" === e5.type && ((e5 = a(e5)).type = "esriFieldTypeInteger"), r5.read(e5, t3), r5;
    }) : Array.isArray(r4.attributeStorageInfo) ? r4.attributeStorageInfo.map((e5) => new m2({ name: e5.name, type: "ELEVATION" === e5.name ? "double" : "integer" })) : null;
  }
  set elevationInfo(e4) {
    null != e4 && "absolute-height" !== e4.mode || this._set("elevationInfo", e4), this._validateElevationInfo(e4);
  }
  writeRenderer(e4, r4, t3, o2) {
    e("layerDefinition.drawingInfo.renderer", e4.write({}, o2), r4);
  }
  load(e4) {
    const r4 = null != e4 ? e4.signal : null, t3 = this.loadFromPortal({ supportedTypes: ["Scene Service"] }, e4).catch(a3).then(() => this._fetchService(r4));
    return this.addResolvingPromise(t3), Promise.resolve(this);
  }
  createPopupTemplate(e4) {
    const r4 = p(this, e4);
    return r4 && (this._formatPopupTemplateReturnsField(r4), this._formatPopupTemplateRGBField(r4)), r4;
  }
  _formatPopupTemplateReturnsField(e4) {
    const r4 = this.fieldsIndex.get("RETURNS");
    if (!r4) return;
    const t3 = e4.fieldInfos?.find((e5) => e5.fieldName === r4.name);
    if (!t3) return;
    const o2 = new i2({ name: "pcl-returns-decoded", title: r4.alias || r4.name, expression: `
        var returnValue = $feature.${r4.name};
        return (returnValue % 16) + " / " + Floor(returnValue / 16);
      ` });
    e4.expressionInfos = [...e4.expressionInfos || [], o2], t3.fieldName = "expression/pcl-returns-decoded";
  }
  _formatPopupTemplateRGBField(e4) {
    const r4 = this.fieldsIndex.get("RGB");
    if (!r4) return;
    const t3 = e4.fieldInfos?.find((e5) => e5.fieldName === r4.name);
    if (!t3) return;
    const o2 = new i2({ name: "pcl-rgb-decoded", title: r4.alias || r4.name, expression: `
        var rgb = $feature.${r4.name};
        var red = Floor(rgb / 65536, 0);
        var green = Floor((rgb - (red * 65536)) / 256,0);
        var blue = rgb - (red * 65536) - (green * 256);

        return "rgb(" + red + "," + green + "," + blue + ")";
      ` });
    e4.expressionInfos = [...e4.expressionInfos || [], o2], t3.fieldName = "expression/pcl-rgb-decoded";
  }
  async queryCachedStatistics(e4, r4) {
    if (await this.load(r4), !this.attributeStorageInfo) throw new s("scenelayer:no-cached-statistics", "Cached statistics are not available for this layer");
    const i6 = this.fieldsIndex.get(e4);
    if (!i6) throw new s("pointcloudlayer:field-unexisting", `Field '${e4}' does not exist on the layer`);
    for (const o2 of this.attributeStorageInfo) if (o2.name === i6.name) {
      const e5 = V(this.parsedUrl?.path ?? "", `./statistics/${o2.key}`);
      return H(e5, { query: { f: "json", ...this.customParameters, token: this.apiKey }, responseType: "json", signal: r4 ? r4.signal : null }).then((e6) => e6.data);
    }
    throw new s("pointcloudlayer:no-cached-statistics", "Cached statistics for this attribute are not available");
  }
  async saveAs(e4, r4) {
    return this._debouncedSaveOperations(V2.SAVE_AS, { ...r4, getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" }, e4);
  }
  async save() {
    const e4 = { getTypeKeywords: () => this._getTypeKeywords(), portalItemLayerType: "point-cloud" };
    return this._debouncedSaveOperations(V2.SAVE, e4);
  }
  validateLayer(e4) {
    if (e4.layerType && "PointCloud" !== e4.layerType) throw new s("pointcloudlayer:layer-type-not-supported", "PointCloudLayer does not support this layer type", { layerType: e4.layerType });
    if (isNaN(this.version.major) || isNaN(this.version.minor)) throw new s("layer:service-version-not-supported", "Service version is not supported.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
    if (this.version.major > 2) throw new s("layer:service-version-too-new", "Service version is too new.", { serviceVersion: this.version.versionString, supportedVersions: "1.x-2.x" });
  }
  hasCachedStatistics(e4) {
    return null != this.attributeStorageInfo && this.attributeStorageInfo.some((r4) => r4.name === e4);
  }
  _getTypeKeywords() {
    return ["PointCloud"];
  }
  _validateElevationInfo(e4) {
    $(i.getLogger(this), Z("Point cloud layers", "absolute-height", e4)), $(i.getLogger(this), w("Point cloud layers", e4));
  }
};
r([m({ type: ["PointCloudLayer"] })], V3.prototype, "operationalLayerType", void 0), r([m(l2)], V3.prototype, "popupEnabled", void 0), r([m({ type: q, json: { name: "popupInfo", write: true } })], V3.prototype, "popupTemplate", void 0), r([m({ readOnly: true, json: { read: false } })], V3.prototype, "defaultPopupTemplate", null), r([m({ readOnly: true, json: { write: false, read: false, origins: { "web-document": { write: false, read: false } } } })], V3.prototype, "opacity", void 0), r([m({ type: ["show", "hide"] })], V3.prototype, "listMode", void 0), r([m({ types: [e3], json: { origins: { service: { read: { source: "filters" } } }, name: "layerDefinition.filters", write: true } })], V3.prototype, "filters", void 0), r([m({ type: [m2] })], V3.prototype, "fields", void 0), r([m(O.fieldsIndex)], V3.prototype, "fieldsIndex", void 0), r([o("service", "fields", ["fields", "attributeStorageInfo"])], V3.prototype, "readServiceFields", null), r([m(O.outFields)], V3.prototype, "outFields", void 0), r([m({ readOnly: true })], V3.prototype, "attributeStorageInfo", void 0), r([m(m3)], V3.prototype, "elevationInfo", null), r([m({ type: String, json: { origins: { "web-scene": { read: true, write: true }, "portal-item": { read: true, write: true } }, read: false } })], V3.prototype, "path", void 0), r([m(d)], V3.prototype, "legendEnabled", void 0), r([m({ types: i5, json: { origins: { service: { read: { source: "drawingInfo.renderer" } } }, name: "layerDefinition.drawingInfo.renderer", write: { target: { "layerDefinition.drawingInfo.renderer": { types: i5 }, "layerDefinition.drawingInfo.transparency": { type: Number } } } } })], V3.prototype, "renderer", void 0), r([r2("renderer")], V3.prototype, "writeRenderer", null), r([m({ json: { read: false }, readOnly: true })], V3.prototype, "type", void 0), V3 = r([a2("esri.layers.PointCloudLayer")], V3);
var U = V3;
export {
  U as default
};
//# sourceMappingURL=PointCloudLayer-Y2SM5Y3Z.js.map
