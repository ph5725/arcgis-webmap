import {
  b
} from "./chunk-VBGMA7VY.js";
import {
  g
} from "./chunk-Y5SQIDBJ.js";
import "./chunk-LRWR245D.js";
import "./chunk-5MPGCN36.js";
import "./chunk-5WTH3GBK.js";
import "./chunk-B7AMZ4LC.js";
import {
  h,
  j,
  v
} from "./chunk-3GCFO25G.js";
import {
  E,
  U,
  it
} from "./chunk-BGR5EVZD.js";
import "./chunk-UZRZVWLE.js";
import "./chunk-KKAHMR7F.js";
import "./chunk-RTDWTAVK.js";
import "./chunk-QLJ6JQFC.js";
import "./chunk-IMFGC5DS.js";
import "./chunk-LG4SF54U.js";
import "./chunk-6DBRCIDV.js";
import "./chunk-YSRSL2SU.js";
import "./chunk-3LL6ALVC.js";
import "./chunk-NZPABYQQ.js";
import "./chunk-CCHJ3WNU.js";
import "./chunk-DRAQJS2F.js";
import "./chunk-BZYXFNL4.js";
import "./chunk-VNTS5E5O.js";
import {
  p,
  q,
  u
} from "./chunk-TMFB3DKM.js";
import "./chunk-TNW4TPNP.js";
import "./chunk-7FAVUXK2.js";
import "./chunk-IVNFIIVI.js";
import "./chunk-DNZK6PPI.js";
import "./chunk-7BWCD63N.js";
import {
  n,
  t
} from "./chunk-RACDQ3AL.js";
import "./chunk-7Z3AF3B2.js";
import "./chunk-FPSA4NFH.js";
import {
  a2 as a
} from "./chunk-JUAD7TJ6.js";
import "./chunk-VHLUKPRH.js";
import {
  r
} from "./chunk-5TPMG26T.js";
import "./chunk-FGWIXJQY.js";
import "./chunk-TKYAZCMB.js";
import "./chunk-3TBMFSPB.js";
import "./chunk-S7IJH524.js";
import {
  s
} from "./chunk-GZ2P4SCJ.js";
import "./chunk-XWG6QGFK.js";
import "./chunk-GWNLQRNM.js";
import "./chunk-FXKORAMT.js";
import "./chunk-GNMFMITH.js";

// node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js
var t2 = 1e3;
function a2(t3, a3, e) {
  const f2 = E(), m = U(f2);
  return q(m, m, t3, 0.5), q(m, m, a3, 0.5), f2[3] = p(m, t3), u(m, m, e), f2;
}

// node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js
var f = class {
  constructor() {
    this._idToComponent = /* @__PURE__ */ new Map(), this._components = new b((e) => e.bounds), this._edges = new b((e) => e.bounds), this._tmpLineSegment = v(), this._tmpP1 = n(), this._tmpP2 = n(), this._tmpP3 = n(), this.remoteClient = null;
  }
  async fetchCandidates(e, o) {
    await Promise.resolve(), s(o), await this._ensureEdgeLocations(e, o);
    const s2 = [];
    return this._edges.forEachNeighbor((t3) => (this._addCandidates(e, t3, s2), s2.length < t2), e.bounds), { result: { candidates: s2 } };
  }
  async _ensureEdgeLocations(e, t3) {
    const o = [];
    if (this._components.forEachNeighbor((e2) => {
      if (null == e2.info) {
        const { id: t4, uid: s3 } = e2;
        o.push({ id: t4, uid: s3 });
      }
      return true;
    }, e.bounds), !o.length) return;
    const s2 = { components: o }, n2 = await this.remoteClient.invoke("fetchAllEdgeLocations", s2, t3 ?? {});
    for (const i of n2.components) this._setFetchEdgeLocations(i);
  }
  async add(e) {
    const t3 = new j2(e.id, e.bounds);
    return this._idToComponent.set(t3.id, t3), this._components.add([t3]), { result: {} };
  }
  async remove(e) {
    const t3 = this._idToComponent.get(e.id);
    if (t3) {
      const e2 = [];
      this._edges.forEachNeighbor((o) => (o.component === t3 && e2.push(o), true), t3.bounds), this._edges.remove(e2), this._components.remove([t3]), this._idToComponent.delete(t3.id);
    }
    return { result: {} };
  }
  _setFetchEdgeLocations(e) {
    const t3 = this._idToComponent.get(e.id);
    if (null == t3 || e.uid !== t3.uid) return;
    const o = g.createView(e.locations), s2 = new Array(o.count), n2 = n(), r2 = n();
    for (let i = 0; i < o.count; i++) {
      o.position0.getVec(i, n2), o.position1.getVec(i, r2);
      const c2 = a2(n2, r2, e.origin), d2 = new w(t3, i, c2);
      s2[i] = d2;
    }
    this._edges.add(s2);
    const { objectIds: c, origin: d } = e;
    t3.info = { locations: o, objectIds: c, origin: d };
  }
  _addCandidates(e, t3, o) {
    const { info: n2 } = t3.component, { origin: i, objectIds: r2 } = n2, c = n2.locations, d = c.position0.getVec(t3.index, this._tmpP1), a3 = c.position1.getVec(t3.index, this._tmpP2);
    u(d, d, i), u(a3, a3, i);
    const p2 = r2[c.componentIndex.get(t3.index)];
    this._addEdgeCandidate(e, p2, d, a3, o), b2(e, p2, d, o), b2(e, p2, a3, o);
  }
  _addEdgeCandidate(e, t3, o, s2, i) {
    if (!e.returnEdge) return;
    const c = U(e.bounds), u2 = h(o, s2, this._tmpLineSegment), h2 = j(u2, c, this._tmpP3);
    it(e.bounds, h2) && i.push({ type: "edge", objectId: t3, target: t(h2), distance: p(c, h2), start: t(o), end: t(s2) });
  }
};
f = r([a("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")], f);
var _ = f;
function b2(e, t3, o, s2) {
  if (!e.returnVertex || !it(e.bounds, o)) return;
  const i = U(e.bounds);
  s2.push({ type: "vertex", objectId: t3, target: t(o), distance: p(i, o) });
}
var _j = class _j {
  constructor(e, t3) {
    this.id = e, this.bounds = t3, this.info = null, this.uid = ++_j.uid;
  }
};
_j.uid = 0;
var j2 = _j;
var w = class {
  constructor(e, t3, o) {
    this.component = e, this.index = t3, this.bounds = o;
  }
};
export {
  _ as default
};
//# sourceMappingURL=SceneLayerSnappingSourceWorker-W7VBHCKX.js.map
