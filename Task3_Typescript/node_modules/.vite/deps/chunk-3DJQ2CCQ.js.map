{
  "version": 3,
  "sources": ["../../@arcgis/core/chunks/OperatorGeneralize.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{b as t,c as e}from\"./tslib.es6.js\";import{G as s}from\"./SimpleGeometryCursor.js\";import{a as i,c as r,e as a,G as n,f as h,h as m,t as l}from\"./Geometry.js\";import{a as o,P as c,L as u}from\"./MultiPathImpl.js\";import{P as _}from\"./Envelope.js\";import{h as g,P as p,c as k}from\"./Point2D.js\";import{O as f}from\"./OperatorDensify.js\";class P{getOperatorType(){return 10204}supportsCurves(){return!0}accelerateGeometry(t,e,s){return!1}canAccelerateGeometry(t){return!1}executeMany(t,e,s,i){return new y(t,e,s,i)}execute(t,e,s,r){t||i(\"null param is not allowed.\");return new y(null,e,s,r).generalize(t)}}class y extends s{constructor(t,e,s,i){super(),this.m_pline=null,this.m_point=new _,this.m_stack=[],this.m_resultstack=[],this.m_callCount=0,this.m_progressTracker=i,this.m_geoms=t,this.m_maxDeviation=e,this.m_bRemoveDegenerateParts=s}tock(){return!0}getRank(){return 1}next(){const t=this.m_geoms.next();return null===t?null:(r(t),this.generalize(t))}getGeometryID(){return this.m_geoms.getGeometryID()}generalize(s){const i=s.getGeometryType();if(a(i))return s;if(i===n.enumEnvelope){const t=new o({vd:s.getDescription()});return t.addEnvelope(s,!1),this.generalize(t)}if(h(i)){const t=new c({vd:s.getDescription()});return t.addSegment(s,!0),this.generalize(t)}if(m(i)||l(\"\"),s.isEmpty()||this.m_maxDeviation<=0)return s;const r=(new f).execute(s,0,.05*this.m_maxDeviation,0,this.m_progressTracker);s.hasNonLinearSegments()&&(this.m_maxDeviation*=.95);const _=r,p=s.createInstance();if(p.getGeometryType()===n.enumPolygon){p.setFillRule(s.getFillRule())}this.m_xy=_.getAttributeStreamRef(0);{const s={stack:[],error:void 0,hasError:!1};try{const e=new u;this.m_pline=e,t(s,g((()=>{this.m_pline=null}),!1),!1);for(let t=0,s=_.getPathCount();t<s;t++)this.generalizePath(_.getImpl(),t,p.getImpl())}catch(k){s.error=k,s.hasError=!0}finally{e(s)}}return this.m_resultstack.length=0,this.m_stack.length=0,p}generalizePath(t,e,s){if(t.getPathSize(e)<2)return;this.m_resultstack.length=0,this.m_stack.length=0;const i=t.getPathStart(e),r=t.getPathEnd(e)-1,a=t.isClosedPath(e),n=t.isClosedPathInXYPlane(e);let h=0,m=-1;this.m_stack.push(a?i:r),this.m_stack.push(i);let l=!1,o=!1;for(!this.m_bRemoveDegenerateParts&&n&&(l=!0,o=!0);this.m_stack.length>1;){const e=this.m_stack.at(-1);this.m_stack.pop();const s=this.m_stack.at(-1);let i=t.getXY(e);this.m_pline.setStartXY(i),i=t.getXY(s),this.m_pline.setEndXY(i);const a=[Number.NaN];let n=this.findGreatestDistance(e,s,r,a);n>=0&&(l?l=!1:(o&&a[0]>h&&(h=a[0],m=n),a[0]<=this.m_maxDeviation&&(n=-1))),n>=0?(this.m_stack.push(n),this.m_stack.push(e)):this.m_resultstack.push(e)}a||this.m_resultstack.push(this.m_stack[0]);const c=this.m_resultstack.length;if(c===t.getPathSize(e)&&c===this.m_stack.length)s.addPath(t,e,!0);else if(this.m_resultstack.length>0){if(this.m_bRemoveDegenerateParts&&this.m_resultstack.length<=2){if(a||1===this.m_resultstack.length)return;if(p.distance(t.getXY(this.m_resultstack[0]),t.getXY(this.m_resultstack[1]))<=this.m_maxDeviation)return}if(o&&m>=0&&h<=this.m_maxDeviation){const t=this.m_resultstack.at(-1)>m;this.m_resultstack.push(m),t&&(this.m_resultstack[this.m_resultstack.length-2]=k(this.m_resultstack[this.m_resultstack.length-1],this.m_resultstack[this.m_resultstack.length-1]=this.m_resultstack[this.m_resultstack.length-2]))}for(let e=0,i=this.m_resultstack.length;e<i;e++)t.getPointByVal(this.m_resultstack[e],this.m_point),0===e?s.startPathPoint(this.m_point):s.lineToPoint(this.m_point);if(a){for(let t=this.m_resultstack.length;t<3;t++)s.lineToPoint(this.m_point);s.closePathWithLine()}}}findGreatestDistance(t,e,s,i){let r=e-1;e<=t&&(r=s);let a=-1,n=0;const h=new p;for(let m=t+1;m<=r;m++){this.m_xy.queryPoint2D(2*m,h);const t=h.x,e=h.y,s=this.m_pline.getClosestCoordinate(h,!1);h.assign(this.m_pline.getCoord2D(s)),h.x-=t,h.y-=e;const i=h.length();i>n&&(a=m,n=i),this.m_callCount++}return i[0]=n,a}}export{P as O};\r\n"],
  "mappings": "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",
  "names": ["P", "t", "s", "a", "n", "h", "m", "l", "e", "i"]
}
