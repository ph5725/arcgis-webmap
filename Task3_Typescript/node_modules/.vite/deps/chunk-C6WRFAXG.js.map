{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/featurePopupQueryUtils.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{throwIfAborted as e}from\"../../core/promiseUtils.js\";import{sqlAnd as t}from\"../../core/sql.js\";import{unpackFieldNames as o,featureHasFields as i}from\"./fieldUtils.js\";import{loadArcade as n}from\"../../support/loadArcade.js\";async function s(n,s,l,u){const c=new Array(s.length),a=new Map,d=new Map,p=o(n.fieldsIndex,l.outFields),f=u?.hasRequiredFields??i;for(let t=0;t<s.length;t++){const o=s[t];if(o.isAggregate){c[t]=o;continue}let i=!1;if(u?.getPopupTemplate){const t=o.origin?.layer??o.sourceLayer??o.layer,n=u.getPopupTemplate(t);if(null==n)continue;const s=await r(n);e(u),i=s&&s.arcadeUtils.hasGeometryOperations(n)}if(i||!f(o,p)){const e=o.getObjectId();if(null!=e){a.set(e,{graphic:o,index:t});continue}const i=o.getGlobalId();if(null!=i){d.set(i,{graphic:o,index:t});continue}}c[t]=o}if(!n.queryFeatures||0===a.size&&0===d.size)return c.filter(Boolean);const g=[],y=(e,t)=>{t&&(e.outFields??=[],e.outFields.includes(t)||e.outFields.push(t))};if(a.size>0){const e=l.clone();y(e,n.objectIdField),\"uniqueIdFields\"in n&&n.uniqueIdFields?.length&&(e.outFields??=[],e.outFields.push(...n.uniqueIdFields)),e.objectIds=Array.from(a.keys()),g.push({type:\"object-id\",query:e,map:a})}const m=\"globalIdField\"in n?n.globalIdField:null;if(null!=m&&d.size>0){const e=l.clone();y(e,m);const o=Array.from(d.keys());e.where=t(l.where,`${m} IN (${o.map((e=>`'${e}'`)).join(\",\")})`),g.push({type:\"global-id\",query:e,map:d})}const b=u?.updateSourceAttributes??!1;for(const{type:e,query:t,map:o}of g)try{const i=await n.queryFeatures(t,u);for(const t of i.features){const i=\"object-id\"===e?t.getObjectId():t.getGlobalId();if(null==i)continue;const n=o.get(i);if(!n)continue;const{graphic:s,index:r}=n;if(b&&t.attributes){s.attributes??={};for(const e of p)e in t.attributes&&(s.attributes[e]=t.attributes[e])}const{geometry:l,origin:u}=s;t.geometry||=l,t.origin=u,c[r]=t}}catch{}return c.filter(Boolean)}async function r(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return n()}export{s as fetchFeaturePopupFeatures,r as loadFeaturePopupArcadeModules};\r\n"],
  "mappings": "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",
  "names": ["s", "t", "n", "r", "e", "i", "l", "u"]
}
