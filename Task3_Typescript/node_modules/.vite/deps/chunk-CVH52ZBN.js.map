{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/data/executeQueryForSnapping.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{clone as e}from\"../../../core/lang.js\";import{signalFromSignalOrOptions as t}from\"../../../core/promiseUtils.js\";import{fromJSON as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as a}from\"../../../geometry/support/normalizeUtils.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{checkProjectionSupport as s,project as n}from\"./projectionSupport.js\";import{getQueryBBoxes as o}from\"./QueryEngine.js\";import{QueryEngineResult as l}from\"./QueryEngineResult.js\";import{normalizeQueryLike as p}from\"./queryUtils.js\";import{validateQuery as m}from\"./queryValidationUtils.js\";import{getSpatialQueryOperator as c}from\"./spatialQuerySupport.js\";async function u(c,u,y){const d=t(y),{point:x,distance:g,returnEdge:R,vertexMode:j}=u;if(!R&&\"none\"===j)return{candidates:[]};let w=e(u.query);w=await c.schedule((()=>p(w,c.definitionExpression,c.spatialReference)),d),w=await c.reschedule((()=>m(w,{availableFields:c.availableFields,fieldsIndex:c.fieldsIndex,geometryType:c.geometryType,spatialReference:c.spatialReference})),d);const h=!i(x.spatialReference,c.spatialReference);h&&await s(x.spatialReference,c.spatialReference);const b=\"number\"==typeof g?g:g.x,Q=\"number\"==typeof g?g:g.y,S={xmin:x.x-b,xmax:x.x+b,ymin:x.y-Q,ymax:x.y+Q,spatialReference:x.spatialReference},U=h?n(S,c.spatialReference):S;if(!U)return{candidates:[]};const q=(await a(r(x),null,{signal:d}))[0],E=(await a(r(U),null,{signal:d}))[0];if(null==q||null==E)return{candidates:[]};const F=new l(await c.reschedule((()=>c.searchFeatures(o(E.toJSON()))),d),w,c);await c.reschedule((()=>c.executeObjectIdsQuery(F)),d),await c.reschedule((()=>c.executeTimeQuery(F)),d),await c.reschedule((()=>c.executeAttributesQuery(F)),d),await c.reschedule((()=>f(c,F,d)),d);const T=q.toJSON(),v=h?n(T,c.spatialReference):T,I=h?Math.max(U.xmax-U.xmin,U.ymax-U.ymin)/2:g;return F.createSnappingResponse({...u,point:v,distance:I},w.returnZ,x.spatialReference)}async function f(e,t,r){const{query:a}=t,{spatialRel:i}=a;if(!t?.items?.length||!a.geometry||!i)return;const s=await c(i,a.geometry,e.geometryType,e.hasZ,e.hasM),n=await e.runSpatialFilter(t.items,(e=>s(e.geometry)),r);t.items=n}export{u as executeQueryForSnapping};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIysB,eAAe,EAAE,GAAEA,IAAE,GAAE;AAAC,QAAMC,KAAE,EAAE,CAAC,GAAE,EAAC,OAAMC,IAAE,UAAS,GAAE,YAAWC,IAAE,YAAWC,GAAC,IAAEJ;AAAE,MAAG,CAACG,MAAG,WAASC,GAAE,QAAM,EAAC,YAAW,CAAC,EAAC;AAAE,MAAI,IAAE,EAAEJ,GAAE,KAAK;AAAE,MAAE,MAAM,EAAE,SAAU,MAAI,EAAE,GAAE,EAAE,sBAAqB,EAAE,gBAAgB,GAAGC,EAAC,GAAE,IAAE,MAAM,EAAE,WAAY,MAAI,EAAE,GAAE,EAAC,iBAAgB,EAAE,iBAAgB,aAAY,EAAE,aAAY,cAAa,EAAE,cAAa,kBAAiB,EAAE,iBAAgB,CAAC,GAAGA,EAAC;AAAE,QAAM,IAAE,CAAC,EAAEC,GAAE,kBAAiB,EAAE,gBAAgB;AAAE,OAAG,MAAM,EAAEA,GAAE,kBAAiB,EAAE,gBAAgB;AAAE,QAAM,IAAE,YAAU,OAAO,IAAE,IAAE,EAAE,GAAE,IAAE,YAAU,OAAO,IAAE,IAAE,EAAE,GAAE,IAAE,EAAC,MAAKA,GAAE,IAAE,GAAE,MAAKA,GAAE,IAAE,GAAE,MAAKA,GAAE,IAAE,GAAE,MAAKA,GAAE,IAAE,GAAE,kBAAiBA,GAAE,iBAAgB,GAAE,IAAE,IAAE,EAAE,GAAE,EAAE,gBAAgB,IAAE;AAAE,MAAG,CAAC,EAAE,QAAM,EAAC,YAAW,CAAC,EAAC;AAAE,QAAM,KAAG,MAAM,EAAE,EAAEA,EAAC,GAAE,MAAK,EAAC,QAAOD,GAAC,CAAC,GAAG,CAAC,GAAE,KAAG,MAAM,EAAE,EAAE,CAAC,GAAE,MAAK,EAAC,QAAOA,GAAC,CAAC,GAAG,CAAC;AAAE,MAAG,QAAM,KAAG,QAAM,EAAE,QAAM,EAAC,YAAW,CAAC,EAAC;AAAE,QAAM,IAAE,IAAI,EAAE,MAAM,EAAE,WAAY,MAAI,EAAE,eAAe,EAAE,EAAE,OAAO,CAAC,CAAC,GAAGA,EAAC,GAAE,GAAE,CAAC;AAAE,QAAM,EAAE,WAAY,MAAI,EAAE,sBAAsB,CAAC,GAAGA,EAAC,GAAE,MAAM,EAAE,WAAY,MAAI,EAAE,iBAAiB,CAAC,GAAGA,EAAC,GAAE,MAAM,EAAE,WAAY,MAAI,EAAE,uBAAuB,CAAC,GAAGA,EAAC,GAAE,MAAM,EAAE,WAAY,MAAII,GAAE,GAAE,GAAEJ,EAAC,GAAGA,EAAC;AAAE,QAAM,IAAE,EAAE,OAAO,GAAE,IAAE,IAAE,EAAE,GAAE,EAAE,gBAAgB,IAAE,GAAEK,KAAE,IAAE,KAAK,IAAI,EAAE,OAAK,EAAE,MAAK,EAAE,OAAK,EAAE,IAAI,IAAE,IAAE;AAAE,SAAO,EAAE,uBAAuB,EAAC,GAAGN,IAAE,OAAM,GAAE,UAASM,GAAC,GAAE,EAAE,SAAQJ,GAAE,gBAAgB;AAAC;AAAC,eAAeG,GAAE,GAAE,GAAE,GAAE;AAAC,QAAK,EAAC,OAAME,GAAC,IAAE,GAAE,EAAC,YAAW,EAAC,IAAEA;AAAE,MAAG,CAAC,GAAG,OAAO,UAAQ,CAACA,GAAE,YAAU,CAAC,EAAE;AAAO,QAAMC,KAAE,MAAM,EAAE,GAAED,GAAE,UAAS,EAAE,cAAa,EAAE,MAAK,EAAE,IAAI,GAAE,IAAE,MAAM,EAAE,iBAAiB,EAAE,OAAO,CAAAE,OAAGD,GAAEC,GAAE,QAAQ,GAAG,CAAC;AAAE,IAAE,QAAM;AAAC;",
  "names": ["u", "d", "x", "R", "j", "f", "I", "a", "s", "e"]
}
