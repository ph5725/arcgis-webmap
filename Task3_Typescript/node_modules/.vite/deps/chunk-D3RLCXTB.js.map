{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/graphics/applyEditsUtils.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport e from\"../../Graphic.js\";import t from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{getMetersPerCartesianUnitForSR as a}from\"../../core/unitUtils.js\";import{parseData as s}from\"../../core/urlUtils.js\";import{isEqualBaseGCS as o,canProjectWithoutEngine as n,projectWithoutEngine as l}from\"../../geometry/projectionUtils.js\";import{fromJSON as i}from\"../../geometry/support/jsonUtils.js\";import u from\"../../geometry/support/MeshTransform.js\";import{equals as d}from\"../../geometry/support/spatialReferenceUtils.js\";import{isFeatureIdentifierArrayWithGlobalId as c,isFeatureIdentifierArrayWithObjectId as p}from\"./editingSupport.js\";async function m(e,t,r){const{geometry:s}=t,i={...t.attributes};if(null!=r&&\"mesh\"===s?.type){const{transformFieldRoles:t}=r,{origin:c,spatialReference:p,vertexSpace:m}=s,f=s.transform??new u,g=\"local\"===m.type,b=e.spatialReference,y=b.isGeographic,R=d(b,p),h=o(p,b)&&n(p,b);if(!(g&&y&&h||!g&&!y&&R))return null;const I=l(c,p,b);if(null==I)return null;if(i[t.originX]=I.x,i[t.originY]=I.y,i[t.originZ]=I.z??0,null!=f){const{translation:e,scale:r,rotation:s}=f,o=g?1:a(p)/a(b);i[t.translationX]=e[0]*o,i[t.translationY]=e[2]*o,i[t.translationZ]=-e[1]*o,i[t.scaleX]=r[0],i[t.scaleY]=r[2],i[t.scaleZ]=r[1],i[t.rotationX]=s[0],i[t.rotationY]=s[2],i[t.rotationZ]=-s[1],i[t.rotationDeg]=s[3]}return{attributes:i}}return null==s?{attributes:i}:\"mesh\"===s.type||\"extent\"===s.type?null:{geometry:s.toJSON(),attributes:i}}async function f(e,t){const r=await Promise.all((t.addAttachments??[]).map((t=>g(e,t)))),a=await Promise.all((t.updateAttachments??[]).map((t=>g(e,t)))),s=t.deleteAttachments??[];return r.length||a.length||s.length?{adds:r,updates:a,deletes:[...s]}:null}async function g(e,t){const{feature:r,attachment:a}=t,{globalId:o,name:n,contentType:l,data:i,uploadId:u}=a,d={globalId:o};if(r&&(\"attributes\"in r?d.parentGlobalId=r.attributes?.[e.globalIdField]:r.globalId&&(d.parentGlobalId=r.globalId)),u)d.uploadId=u;else if(i){const e=await s(i);e&&(d.contentType=e.mediaType,d.data=e.data),i instanceof File&&(d.name=i.name)}return n&&(d.name=n),l&&(d.contentType=l),d}function b(e,t,r){if(!t||0===t.length)return[];if(r&&c(t))return t.map((e=>e.globalId));if(p(t))return t.map((e=>e.objectId));const a=r?e.globalIdField:e.objectIdField;return a?t.map((e=>e.getAttribute(a))):[]}function y(e){const t=e?.assetMaps;if(t){for(const e of t.addResults)e.success||r.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(const e of t.updateResults)e.success||r.getLogger(\"esri.layers.graphics.sources.support.sourceUtils\").error(`Failed to map asset to feature with globalId ${e.globalId}.`)}const a=e?.attachments,s={addFeatureResults:e?.addResults?.map(R)??[],updateFeatureResults:e?.updateResults?.map(R)??[],deleteFeatureResults:e?.deleteResults?.map(R)??[],addAttachmentResults:a?.addResults?a.addResults.map(R):[],updateAttachmentResults:a?.updateResults?a.updateResults.map(R):[],deleteAttachmentResults:a?.deleteResults?a.deleteResults.map(R):[]};return e?.editMoment&&(s.editMoment=e.editMoment),s}function R(e){const r=!0===e.success?null:e.error||{code:void 0,description:\"Feature edit failed\"};return{objectId:e.objectId,globalId:e.globalId,error:r?new t(\"feature-layer-source:edit-failure\",r.description,{code:r.code}):null}}function h(t,r){return new e({attributes:t.attributes,geometry:i({...t.geometry,spatialReference:r})})}function I(e,t){return{adds:e?.adds?.map((e=>h(e,t)))||[],updates:e?.updates?.map((e=>({original:h(e[0],t),current:h(e[1],t)})))||[],deletes:e?.deletes?.map((e=>h(e,t)))||[],spatialReference:t}}function j(e){const t=e.details.raw,r=+t.code,a=+t.extendedCode;return 500===r&&(-2147217144===a||-2147467261===a)}export{I as createEditedFeatures,R as createFeatureEditResult,f as getAttachmentEditsJSON,b as getFeatureIds,m as getFeatureJSON,j as isProtectedOrPrivateVersionError,y as unpackEditResultData};\r\n"],
  "mappings": "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",
  "names": ["s", "i", "t", "m", "f", "A", "g", "b", "y", "R", "h", "I", "e", "r", "d"]
}
