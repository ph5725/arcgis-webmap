import {
  T
} from "./chunk-NMV57LDC.js";
import {
  s as s7,
  v
} from "./chunk-3U5EJ7ZC.js";
import {
  x
} from "./chunk-EK343S5L.js";
import {
  s as s6
} from "./chunk-YB2E6SEN.js";
import {
  d as d5
} from "./chunk-FZNL76F2.js";
import {
  A as A2,
  D,
  E,
  Ie,
  J,
  K,
  L as L3,
  M,
  Q,
  R as R2,
  Te,
  ae,
  de,
  ee,
  fe,
  ie,
  le,
  ne,
  oe,
  pe,
  q,
  se,
  we,
  x as x2,
  z
} from "./chunk-G72VEDU6.js";
import {
  x as x3
} from "./chunk-JP4WNKIX.js";
import {
  e as e5
} from "./chunk-T35H3KKO.js";
import {
  o as o2
} from "./chunk-XBU3UEEJ.js";
import {
  s as s5
} from "./chunk-XAXNVZUO.js";
import {
  e as e4
} from "./chunk-XNTJ4ENZ.js";
import {
  O,
  c as c3,
  e as e3
} from "./chunk-DIR2YFTR.js";
import {
  L as L2,
  h as h3,
  n2 as n,
  y as y2
} from "./chunk-ZSRASSN6.js";
import {
  t
} from "./chunk-N5GLJRXG.js";
import {
  Xe
} from "./chunk-KXFCAOWK.js";
import {
  p as p3
} from "./chunk-UTU6N7VJ.js";
import {
  c as c5
} from "./chunk-7WKBQS4R.js";
import {
  R
} from "./chunk-7ZMGKXLG.js";
import {
  p as p2
} from "./chunk-JMXPE5PE.js";
import {
  d as d4
} from "./chunk-2IMSGFJN.js";
import {
  I,
  c as c4,
  d as d3,
  i as i3,
  i3 as i4,
  n as n4,
  n3 as n5,
  p
} from "./chunk-YX2VTIZR.js";
import {
  ge
} from "./chunk-VCRP2PLV.js";
import {
  n as n3
} from "./chunk-HWKQJUGY.js";
import {
  d as d2
} from "./chunk-HPGYEHVI.js";
import {
  V
} from "./chunk-X3R5OB6L.js";
import {
  a as a2
} from "./chunk-TVM3SZJR.js";
import {
  s as s4
} from "./chunk-U57T7EQN.js";
import {
  o
} from "./chunk-CMHHL5UO.js";
import {
  e as e2
} from "./chunk-LMEOPAGQ.js";
import {
  a as a3,
  f,
  h as h2,
  l
} from "./chunk-A3VAC24F.js";
import {
  _ as _2
} from "./chunk-Q6XRAGMA.js";
import {
  f as f2
} from "./chunk-PK2ZR2SJ.js";
import {
  s as s3
} from "./chunk-KTUX3OKX.js";
import {
  b as b2,
  m
} from "./chunk-N3XLUQJI.js";
import {
  a2 as a
} from "./chunk-JUAD7TJ6.js";
import {
  r
} from "./chunk-5TPMG26T.js";
import {
  n as n2
} from "./chunk-VOLWOTEG.js";
import {
  H
} from "./chunk-ZWFY3WY5.js";
import {
  _
} from "./chunk-LQFTAGIV.js";
import {
  A,
  b,
  d,
  e2 as e,
  h,
  k,
  s as s2,
  u2 as u,
  y
} from "./chunk-GZ2P4SCJ.js";
import {
  c as c2,
  i,
  i2,
  r as r2,
  s
} from "./chunk-XWG6QGFK.js";
import {
  L,
  c
} from "./chunk-FXKORAMT.js";

// node_modules/@arcgis/core/widgets/Attachments/AttachmentsViewModel.js
var u2 = { editing: false, operations: { add: true, update: true, delete: true } };
var f3 = V.ofType(d5);
var y3 = class extends b2 {
  constructor(t4) {
    super(t4), this._getAttachmentsPromise = null, this._attachmentLayer = null, this.capabilities = { ...u2 }, this.activeAttachmentInfo = null, this.activeFileInfo = null, this.attachmentInfos = new f3(), this.fileInfos = new V(), this.graphic = null, this.mode = "view", this.orderByFields = null, this.filesEnabled = false, this.addHandles(l(() => this.graphic, () => this._graphicChanged(), h2));
  }
  destroy() {
    this._attachmentLayer = null, this.graphic = null;
  }
  castCapabilities(t4) {
    return { ...u2, ...t4 };
  }
  get state() {
    return this._getAttachmentsPromise ? "loading" : this.graphic ? "ready" : "disabled";
  }
  get supportsResizeAttachments() {
    const { graphic: t4 } = this;
    if (!t4) return false;
    const e14 = t4.layer || t4.sourceLayer;
    return e14?.loaded && "capabilities" in e14 && e14.capabilities && "attachment" in e14.capabilities && e14.capabilities.attachment && "supportsResize" in e14.capabilities.attachment && e14.capabilities.attachment.supportsResize || false;
  }
  async getAttachments() {
    const { _attachmentLayer: t4, attachmentInfos: e14, orderByFields: i11 } = this;
    if (!t4 || "function" != typeof t4.queryAttachments) throw new s("invalid-layer", "getAttachments(): A valid layer is required.");
    const a6 = this._getObjectId();
    if ("number" != typeof a6) throw new s("invalid-object-id", "getAttachments(): Numeric object id is required");
    const r6 = i11?.map((t5) => `${t5.field} ${"descending" === t5.order ? "DESC" : "ASC"}`), s11 = new p3({ objectIds: [a6], returnMetadata: true, orderByFields: r6 }), o5 = [], c12 = t4.queryAttachments(s11).then((t5) => t5[a6] || o5).catch(() => o5);
    this._getAttachmentsPromise = c12, this.notifyChange("state");
    const h8 = await c12;
    return e14.destroyAll(), h8.length && e14.addMany(h8), this._getAttachmentsPromise = null, this.notifyChange("state"), h8;
  }
  async addAttachment(t4, e14 = this.graphic) {
    const { _attachmentLayer: i11, attachmentInfos: a6, capabilities: r6 } = this;
    if (!e14) throw new s("invalid-graphic", "addAttachment(): A valid graphic is required.", { graphic: e14 });
    if (!t4) throw new s("invalid-attachment", "addAttachment(): An attachment is required.", { attachment: t4 });
    if (!r6.operations?.add) throw new s("invalid-capabilities", "addAttachment(): add capabilities are required.");
    if (!i11 || "function" != typeof i11.addAttachment) throw new s("invalid-layer", "addAttachment(): A valid layer is required.");
    const s11 = i11.addAttachment(e14, t4).then((t5) => this._queryAttachment(t5.objectId, e14)), o5 = await s11;
    return a6.add(o5), o5;
  }
  async deleteAttachment(t4) {
    const { _attachmentLayer: e14, attachmentInfos: i11, graphic: a6, capabilities: r6 } = this;
    if (!t4) throw new s("invalid-attachment-info", "deleteAttachment(): An attachmentInfo is required.", { attachmentInfo: t4 });
    if (!r6.operations?.delete) throw new s("invalid-capabilities", "deleteAttachment(): delete capabilities are required.");
    if (!e14 || "function" != typeof e14.deleteAttachments) throw new s("invalid-layer", "deleteAttachment(): A valid layer is required.");
    if (!a6) throw new s("invalid-graphic", "deleteAttachment(): A graphic is required.");
    const s11 = e14.deleteAttachments(a6, [t4.id]).then(() => t4), o5 = await s11;
    return i11.remove(o5), o5.destroy(), o5;
  }
  async updateAttachment(t4, e14 = this.activeAttachmentInfo) {
    const { _attachmentLayer: i11, attachmentInfos: a6, graphic: r6, capabilities: s11 } = this;
    if (!t4) throw new s("invalid-attachment", "updateAttachment(): An attachment is required.", { attachment: t4 });
    if (!e14) throw new s("invalid-attachment-info", "updateAttachment(): An attachmentInfo is required.", { attachmentInfo: e14 });
    if (!s11.operations?.update) throw new s("invalid-capabilities", "updateAttachment(): Update capabilities are required.");
    const o5 = a6.indexOf(e14);
    if (!i11 || "function" != typeof i11.updateAttachment) throw new s("invalid-layer", "updateAttachment(): A valid layer is required.");
    if (!r6) throw new s("invalid-graphic", "updateAttachment(): A graphic is required.");
    const c12 = i11.updateAttachment(r6, e14.id, t4).then((t5) => this._queryAttachment(t5.objectId)), h8 = await c12;
    return a6.splice(o5, 1, h8), h8;
  }
  async commitFiles() {
    return await Promise.all(this.fileInfos.items.map((t4) => this.addAttachment(t4.form))), this.fileInfos.removeAll(), this.getAttachments();
  }
  addFile(t4, e14) {
    if (!t4 || !e14) return null;
    const i11 = { file: t4, form: e14 };
    return this.fileInfos.add(i11), i11;
  }
  updateFile(t4, e14, i11 = this.activeFileInfo) {
    if (!t4 || !e14 || !i11) return null;
    const a6 = this.fileInfos.indexOf(i11);
    return a6 > -1 && this.fileInfos.splice(a6, 1, { file: t4, form: e14 }), this.fileInfos.items[a6];
  }
  deleteFile(t4) {
    const e14 = this.fileInfos.find((e15) => e15.file === t4);
    return e14 ? (this.fileInfos.remove(e14), e14) : null;
  }
  async _queryAttachment(t4, e14) {
    const { _attachmentLayer: i11 } = this;
    if (!t4 || !i11?.queryAttachments) throw new s("invalid-attachment-id", "Could not query attachment.");
    const a6 = this._getObjectId(e14);
    if ("number" != typeof a6) throw new s("invalid-object-id", "getAttachments(): Numeric object id is required");
    const r6 = new p3({ objectIds: [a6], attachmentsWhere: `AttachmentId=${t4}`, returnMetadata: true });
    return i11.queryAttachments(r6).then((t5) => t5[a6][0]);
  }
  _getObjectId(t4 = this.graphic) {
    return t4?.getObjectId() ?? null;
  }
  _graphicChanged() {
    this.graphic && (this._setAttachmentLayer(), this.getAttachments().catch(() => this.attachmentInfos.destroyAll()));
  }
  _setAttachmentLayer() {
    const { graphic: t4 } = this, e14 = L3(t4);
    this._attachmentLayer = e14 ? "scene" === e14.type && null != e14.associatedLayer ? e14.associatedLayer : e14 : null;
  }
};
r([m()], y3.prototype, "capabilities", void 0), r([s3("capabilities")], y3.prototype, "castCapabilities", null), r([m()], y3.prototype, "activeAttachmentInfo", void 0), r([m()], y3.prototype, "activeFileInfo", void 0), r([m({ readOnly: true, type: f3 })], y3.prototype, "attachmentInfos", void 0), r([m()], y3.prototype, "fileInfos", void 0), r([m({ type: d4 })], y3.prototype, "graphic", void 0), r([m()], y3.prototype, "mode", void 0), r([m({ type: [n4] })], y3.prototype, "orderByFields", void 0), r([m({ readOnly: true })], y3.prototype, "state", null), r([m()], y3.prototype, "filesEnabled", void 0), r([m({ readOnly: true })], y3.prototype, "supportsResizeAttachments", null), y3 = r([a("esri.widgets.Attachments.AttachmentsViewModel")], y3);

// node_modules/@arcgis/core/widgets/Attachments/support/attachmentUtils.js
function e6(i11) {
  const e14 = i11.toLowerCase();
  return "image/bmp" === e14 || "image/emf" === e14 || "image/exif" === e14 || "image/gif" === e14 || "image/x-icon" === e14 || "image/jpeg" === e14 || "image/png" === e14 || "image/tiff" === e14 || "image/x-wmf" === e14;
}
function p4(e14) {
  const p10 = n2("esri/themes/base/images/files/");
  return e14 ? "text/plain" === e14 ? `${p10}text-32.svg` : "application/pdf" === e14 ? `${p10}pdf-32.svg` : "text/csv" === e14 ? `${p10}csv-32.svg` : "application/gpx+xml" === e14 ? `${p10}gpx-32.svg` : "application/x-dwf" === e14 ? `${p10}cad-32.svg` : "application/postscript" === e14 || "application/json" === e14 || "text/xml" === e14 || "model/vrml" === e14 ? `${p10}code-32.svg` : "application/x-zip-compressed" === e14 || "application/x-7z-compressed" === e14 || "application/x-gzip" === e14 || "application/x-tar" === e14 || "application/x-gtar" === e14 || "application/x-bzip2" === e14 || "application/gzip" === e14 || "application/x-compress" === e14 || "application/x-apple-diskimage" === e14 || "application/x-rar-compressed" === e14 || "application/zip" === e14 ? `${p10}zip-32.svg` : e14.includes("image/") ? `${p10}image-32.svg` : e14.includes("audio/") ? `${p10}sound-32.svg` : e14.includes("video/") ? `${p10}video-32.svg` : e14.includes("msexcel") || e14.includes("ms-excel") || e14.includes("spreadsheetml") ? `${p10}excel-32.svg` : e14.includes("msword") || e14.includes("ms-word") || e14.includes("wordprocessingml") ? `${p10}word-32.svg` : e14.includes("powerpoint") || e14.includes("presentationml") ? `${p10}report-32.svg` : `${p10}generic-32.svg` : `${p10}generic-32.svg`;
}

// node_modules/@arcgis/core/widgets/support/legacyIcon.js
var i5 = { close: "esri-icon-close", collapse: "esri-icon-collapse", down: "esri-icon-down", downArrow: "esri-icon-down-arrow", dragHorizontal: "esri-icon-drag-horizontal", dragVertical: "esri-icon-drag-vertical", duplicate: "esri-icon-duplicate", expand: "esri-icon-expand", fontFallbackText: "esri-icon-font-fallback-text", forward: "esri-icon-forward", handleVertical: "esri-icon-handle-vertical", icon: "esri-icon", left: "esri-icon-left", locateCircled: "esri-icon-locate-circled", noticeTriangle: "esri-icon-notice-triangle", pause: "esri-icon-pause", play: "esri-icon-play", plus: "esri-icon-plus", radioChecked: "esri-icon-radio-checked", radioUnchecked: "esri-icon-radio-unchecked", refresh: "esri-icon-refresh", reverse: "esri-icon-reverse", right: "esri-icon-right", search: "esri-icon-search", swap: "esri-icon-swap", table: "esri-icon-table", trash: "esri-icon-trash", up: "esri-icon-up", upArrow: "esri-icon-up-arrow", upDownArrows: "esri-icon-up-down-arrows", urbanModel: "esri-icon-urban-model", zoomInMagnifyingGlass: "esri-icon-zoom-in-magnifying-glass", zoomToObject: "esri-icon-zoom-to-object" };

// node_modules/@arcgis/core/widgets/Attachments.js
var A3 = { addButton: true, addSubmitButton: true, cancelAddButton: true, cancelUpdateButton: true, deleteButton: true, errorMessage: true, progressBar: true, updateButton: true };
var w = "esri-attachments";
var F = { base: w, loaderContainer: `${w}__loader-container`, loader: `${w}__loader`, container: `${w}__container`, containerList: `${w}__container--list`, containerPreview: `${w}__container--preview`, actions: `${w}__actions`, deleteButton: `${w}__delete-button`, addAttachmentButton: `${w}__add-attachment-button`, errorMessage: `${w}__error-message`, items: `${w}__items`, item: `${w}__item`, itemButton: `${w}__item-button`, itemMask: `${w}__item-mask`, itemMaskIcon: `${w}__item-mask--icon`, itemImage: `${w}__image`, itemImageResizable: `${w}__image--resizable`, itemLabel: `${w}__label`, itemFilename: `${w}__filename`, itemChevronIcon: `${w}__item-chevron-icon`, itemLink: `${w}__item-link`, itemLinkOverlay: `${w}__item-link-overlay`, itemLinkOverlayIcon: `${w}__item-link-overlay-icon`, itemAddIcon: `${w}__item-add-icon`, formNode: `${w}__form-node`, fileFieldset: `${w}__file-fieldset`, fileLabel: `${w}__file-label`, fileName: `${w}__file-name`, fileInput: `${w}__file-input`, metadata: `${w}__metadata`, metadataFieldset: `${w}__metadata-fieldset`, progressBar: `${w}__progress-bar` };
var k2 = window.CSS;
var M2 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this.displayType = "auto", this.messages = null, this.messagesUnits = null, this.selectedFile = null, this.submitting = false, this.viewModel = null, this.visibleElements = { ...A3 }, this._supportsImageOrientation = k2 && k2.supports && k2.supports("image-orientation", "from-image"), this._addAttachmentForm = null, this._updateAttachmentForm = null;
  }
  normalizeCtorArgs(e14) {
    return e14?.viewModel || (e14 = { viewModel: new y3(), ...e14 }), e14;
  }
  initialize() {
    this.addHandles([a3(() => this.viewModel?.attachmentInfos, "change", () => this.scheduleRender()), a3(() => this.viewModel?.fileInfos, "change", () => this.scheduleRender()), l(() => this.viewModel?.mode, () => this._modeChanged(), h2)]);
  }
  loadDependencies() {
    return c3({ icon: () => import("./calcite-icon-5R57LYRD.js") });
  }
  get capabilities() {
    return this.viewModel.capabilities;
  }
  set capabilities(e14) {
    this.viewModel.capabilities = e14;
  }
  get effectiveDisplayType() {
    const { displayType: e14 } = this;
    return e14 && "auto" !== e14 ? e14 : this.viewModel.supportsResizeAttachments ? "preview" : "list";
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e14) {
    this.viewModel.graphic = e14;
  }
  get icon() {
    return "attachment";
  }
  set icon(e14) {
    this._overrideIfSome("icon", e14);
  }
  get label() {
    return this.messages?.widgetLabel ?? "";
  }
  set label(e14) {
    this._overrideIfSome("label", e14);
  }
  castVisibleElements(e14) {
    return { ...A3, ...e14 };
  }
  addAttachment() {
    const { _addAttachmentForm: e14, viewModel: s11 } = this;
    return this._set("submitting", true), this._set("error", null), s11.addAttachment(e14).then((e15) => (this._set("submitting", false), this._set("error", null), s11.mode = "view", e15)).catch((e15) => {
      throw this._set("submitting", false), this._set("error", new s("attachments:add-attachment", this.messages.addErrorMessage, e15)), e15;
    });
  }
  deleteAttachment(e14) {
    const { viewModel: s11 } = this;
    return this._set("submitting", true), this._set("error", null), s11.deleteAttachment(e14).then((e15) => (this._set("submitting", false), this._set("error", null), s11.mode = "view", e15)).catch((e15) => {
      throw this._set("submitting", false), this._set("error", new s("attachments:delete-attachment", this.messages.deleteErrorMessage, e15)), e15;
    });
  }
  updateAttachment() {
    const { viewModel: e14 } = this, { _updateAttachmentForm: s11 } = this;
    return this._set("submitting", true), this._set("error", null), e14.updateAttachment(s11).then((t4) => (this._set("submitting", false), this._set("error", null), e14.mode = "view", t4)).catch((e15) => {
      throw this._set("submitting", false), this._set("error", new s("attachments:update-attachment", this.messages.updateErrorMessage, e15)), e15;
    });
  }
  addFile() {
    const e14 = this.viewModel.addFile(this.selectedFile, this._addAttachmentForm);
    return this.viewModel.mode = "view", e14;
  }
  updateFile() {
    const { viewModel: e14 } = this, t4 = e14.updateFile(this.selectedFile, this._updateAttachmentForm, e14.activeFileInfo);
    return e14.mode = "view", t4;
  }
  deleteFile(e14) {
    const t4 = this.viewModel.deleteFile(e14 || this.viewModel.activeFileInfo?.file);
    return this.viewModel.mode = "view", t4;
  }
  render() {
    const { submitting: e14, viewModel: t4 } = this, { state: s11 } = t4;
    return n("div", { class: this.classes(F.base, e4.widget) }, e14 ? this._renderProgressBar() : null, "loading" === s11 ? this._renderLoading() : this._renderAttachments(), this._renderErrorMessage());
  }
  _renderErrorMessage() {
    const { error: e14, visibleElements: t4 } = this;
    return e14 && t4.errorMessage ? n("div", { class: F.errorMessage, key: "error-message" }, e14.message) : null;
  }
  _renderAttachments() {
    const { activeFileInfo: e14, mode: t4, activeAttachmentInfo: s11 } = this.viewModel;
    return "add" === t4 ? this._renderAddForm() : "edit" === t4 ? this._renderDetailsForm(s11 || e14) : this._renderAttachmentContainer();
  }
  _renderLoading() {
    return n("div", { class: F.loaderContainer, key: "loader" }, n("div", { class: F.loader }));
  }
  _renderProgressBar() {
    return this.visibleElements.progressBar ? n("div", { class: F.progressBar, key: "progress-bar" }) : null;
  }
  _renderAddForm() {
    const { submitting: e14, selectedFile: t4 } = this, s11 = e14 || !t4, i11 = this.visibleElements.cancelAddButton ? n("button", { bind: this, class: this.classes(e4.button, e4.buttonTertiary, e4.buttonSmall, e4.buttonHalf, e14 && e4.buttonDisabled), disabled: e14, onclick: this._cancelForm, type: "button" }, this.messages.cancel) : null, a6 = this.visibleElements.addSubmitButton ? n("button", { class: this.classes(e4.button, e4.buttonSecondary, e4.buttonSmall, e4.buttonHalf, { [e4.buttonDisabled]: s11 }), disabled: s11, type: "submit" }, this.messages.add) : null, n13 = t4 ? n("span", { class: F.fileName, key: "file-name" }, t4.name) : null, l5 = n("form", { afterCreate: y2, afterRemoved: h3, bind: this, "data-node-ref": "_addAttachmentForm", onsubmit: this._submitAddAttachment }, n("fieldset", { class: F.fileFieldset }, n13, n("label", { class: this.classes(F.fileLabel, e4.button, e4.buttonSecondary) }, t4 ? this.messages.changeFile : this.messages.selectFile, n("input", { bind: this, class: F.fileInput, name: "attachment", onchange: this._handleFileInputChange, type: "file" }))), a6, i11);
    return n("div", { class: F.formNode, key: "add-form-container" }, l5);
  }
  _renderDetailsForm(e14) {
    const { visibleElements: t4, viewModel: s11, selectedFile: i11, submitting: a6 } = this, { capabilities: l5 } = s11, r6 = a6 || !i11;
    let o5, d10, c12, m6;
    i11 ? (o5 = i11.type, d10 = i11.name, c12 = i11.size) : e14 && "file" in e14 ? (o5 = e14.file.type, d10 = e14.file.name, c12 = e14.file.size) : e14 && "contentType" in e14 && (o5 = e14.contentType, d10 = e14.name, c12 = e14.size, m6 = e14.url);
    const h8 = l5.editing && l5.operations?.delete && t4.deleteButton ? n("button", { bind: this, class: this.classes(e4.button, e4.buttonSmall, e4.buttonTertiary, F.deleteButton, { [e4.buttonDisabled]: a6 }), disabled: a6, key: "delete-button", onclick: (t5) => this._submitDeleteAttachment(t5, e14), type: "button" }, this.messages.delete) : void 0, u8 = l5.editing && l5.operations?.update && t4.updateButton ? n("button", { class: this.classes(e4.button, e4.buttonSmall, e4.buttonThird, { [e4.buttonDisabled]: r6 }), disabled: r6, key: "update-button", type: "submit" }, this.messages.update) : void 0, b9 = this.visibleElements.cancelUpdateButton ? n("button", { bind: this, class: this.classes(e4.button, e4.buttonSmall, e4.buttonTertiary, e4.buttonThird, { [e4.buttonDisabled]: a6 }), disabled: a6, key: "cancel-button", onclick: this._cancelForm, type: "button" }, this.messages.cancel) : void 0, f8 = l5.editing && l5.operations?.update ? n("fieldset", { class: F.fileFieldset, key: "file" }, n("span", { class: F.fileName, key: "file-name" }, d10), n("label", { class: this.classes(F.fileLabel, e4.button, e4.buttonSecondary) }, this.messages.changeFile, n("input", { bind: this, class: F.fileInput, name: "attachment", onchange: this._handleFileInputChange, type: "file" }))) : void 0, v8 = n("fieldset", { class: F.metadataFieldset, key: "size" }, n("label", null, T(this.messagesUnits, c12 ?? 0))), A5 = n("fieldset", { class: F.metadataFieldset, key: "content-type" }, n("label", null, o5)), w5 = null != m6 ? n("a", { class: F.itemLink, href: m6, rel: "noreferrer", target: "_blank" }, this._renderImageMask(e14, 400), n("div", { class: F.itemLinkOverlay }, n("span", { class: F.itemLinkOverlayIcon }, n("calcite-icon", { icon: "launch" })))) : this._renderImageMask(e14, 400), k4 = n("form", { afterCreate: y2, afterRemoved: h3, bind: this, "data-node-ref": "_updateAttachmentForm", onsubmit: (t5) => this._submitUpdateAttachment(t5, e14) }, n("div", { class: F.metadata }, v8, A5), f8, n("div", { class: F.actions }, h8, b9, u8));
    return n("div", { class: F.formNode, key: "edit-form-container" }, w5, k4);
  }
  _renderImageMask(e14, t4) {
    return e14 ? "file" in e14 ? this._renderGenericImageMask(e14.file.name, e14.file.type) : this._renderImageMaskForAttachment(e14, t4) : null;
  }
  _renderGenericImageMask(e14, t4) {
    const { supportsResizeAttachments: s11 } = this.viewModel, i11 = p4(t4), a6 = { [F.itemImageResizable]: s11 };
    return n("div", { class: this.classes(F.itemMaskIcon, F.itemMask), key: i11 }, n("img", { alt: e14, class: this.classes(a6, F.itemImage), src: i11, title: e14 }));
  }
  _renderImageMaskForAttachment(e14, t4) {
    const { supportsResizeAttachments: s11 } = this.viewModel;
    if (!e14) return null;
    const { contentType: i11, name: a6, size: n13, url: l5 } = e14;
    if (!s11 || !e6(i11)) return this._renderGenericImageMask(a6, i11);
    const r6 = this._getCSSTransform(e14), o5 = r6 ? { transform: r6, "image-orientation": "none" } : {}, d10 = `${l5}${l5?.includes("?") ? "&" : "?"}w=${t4}&s=${n13}`, c12 = { [F.itemImageResizable]: s11 };
    return n("div", { class: this.classes(F.itemMask), key: d10 }, n("img", { alt: a6, class: this.classes(c12, F.itemImage), src: d10, styles: o5, title: a6 }));
  }
  _renderFile(e14) {
    const { file: t4 } = e14;
    return n("li", { class: F.item, key: t4 }, n("button", { "aria-label": this.messages.attachmentDetails, bind: this, class: F.itemButton, key: "details-button", onclick: () => this._startEditFile(e14), title: this.messages.attachmentDetails, type: "button" }, this._renderImageMask(e14), n("label", { class: F.itemLabel }, n("span", { class: F.itemFilename }, t4.name || this.messages.noTitle), n("span", { "aria-hidden": "true", class: this.classes(F.itemChevronIcon, L2(this.container) ? i5.left : i5.right) }))));
  }
  _renderAttachmentInfo({ attachmentInfo: e14, displayType: t4 }) {
    const { viewModel: s11, effectiveDisplayType: i11 } = this, { capabilities: a6, supportsResizeAttachments: n13 } = s11, { contentType: l5, name: r6, url: o5 } = e14, d10 = this._renderImageMask(e14, "list" === t4 ? 48 : 400), c12 = a6.editing ? n("span", { "aria-hidden": "true", class: this.classes(F.itemChevronIcon, L2(this.container) ? i5.left : i5.right) }) : null, m6 = [d10, "preview" === i11 && n13 && e6(l5) ? null : n("label", { class: F.itemLabel }, n("span", { class: F.itemFilename }, r6 || this.messages.noTitle), c12)], u8 = a6.editing ? n("button", { "aria-label": this.messages.attachmentDetails, bind: this, class: F.itemButton, "data-attachment-info-id": e14.id, key: "details-button", onclick: () => this._startEditAttachment(e14), title: this.messages.attachmentDetails, type: "button" }, m6) : n("a", { class: F.itemButton, href: o5 ?? void 0, key: "details-link", rel: "noreferrer", target: "_blank" }, m6);
    return n("li", { class: F.item, key: e14 }, u8);
  }
  _renderAttachmentContainer() {
    const { effectiveDisplayType: e14, viewModel: t4, visibleElements: s11 } = this, { attachmentInfos: i11, capabilities: a6, fileInfos: n13 } = t4, l5 = !!i11?.length, r6 = !!n13?.length, o5 = { [F.containerList]: "preview" !== e14, [F.containerPreview]: "preview" === e14 }, d10 = a6.editing && a6.operations?.add && s11.addButton ? n("button", { bind: this, class: this.classes(e4.button, e4.buttonTertiary, F.addAttachmentButton), onclick: () => this._startAddAttachment(), type: "button" }, n("span", { "aria-hidden": "true", class: this.classes(F.itemAddIcon, i5.plus) }), this.messages.add) : void 0, c12 = l5 ? n("ul", { class: F.items, key: "attachments-list" }, i11.toArray().map((t5) => this._renderAttachmentInfo({ attachmentInfo: t5, displayType: e14 }))) : void 0, m6 = r6 ? n("ul", { class: F.items, key: "file-list" }, n13.toArray().map((e15) => this._renderFile(e15))) : void 0, h8 = r6 || l5 ? void 0 : n("div", { class: e4.empty }, this.messages.noAttachments);
    return n("div", { class: this.classes(F.container, o5), key: "attachments-container" }, c12, m6, h8, d10);
  }
  _modeChanged() {
    this._set("error", null), this._set("selectedFile", null);
  }
  _handleFileInputChange(e14) {
    const t4 = e14.target, s11 = t4.files?.item(0);
    this._set("selectedFile", s11);
  }
  _submitDeleteAttachment(e14, t4) {
    e14.preventDefault(), t4 && ("file" in t4 ? this.deleteFile(t4.file) : t4 && this.deleteAttachment(t4));
  }
  _submitAddAttachment(e14) {
    e14.preventDefault(), this.viewModel.filesEnabled ? this.addFile() : this.addAttachment();
  }
  _submitUpdateAttachment(e14, t4) {
    e14.preventDefault(), t4 && "file" in t4 ? this.updateFile() : this.updateAttachment();
  }
  _startEditAttachment(e14) {
    const { viewModel: t4 } = this;
    t4.activeFileInfo = null, t4.activeAttachmentInfo = e14, t4.mode = "edit";
  }
  _startEditFile(e14) {
    const { viewModel: t4 } = this;
    t4.activeAttachmentInfo = null, t4.activeFileInfo = e14, t4.mode = "edit";
  }
  _startAddAttachment() {
    this.viewModel.mode = "add";
  }
  _cancelForm(e14) {
    e14.preventDefault(), this.viewModel.mode = "view";
  }
  _getCSSTransform(e14) {
    const { orientationInfo: t4 } = e14;
    return !this._supportsImageOrientation && t4 ? [t4.rotation ? `rotate(${t4.rotation}deg)` : "", t4.mirrored ? "scaleX(-1)" : ""].join(" ") : "";
  }
};
r([m()], M2.prototype, "capabilities", null), r([m()], M2.prototype, "displayType", void 0), r([m({ readOnly: true })], M2.prototype, "effectiveDisplayType", null), r([m()], M2.prototype, "graphic", null), r([m()], M2.prototype, "icon", null), r([m()], M2.prototype, "label", null), r([m(), e3("esri/widgets/Attachments/t9n/Attachments")], M2.prototype, "messages", void 0), r([m(), e3("esri/core/t9n/Units")], M2.prototype, "messagesUnits", void 0), r([m({ readOnly: true })], M2.prototype, "selectedFile", void 0), r([m({ readOnly: true })], M2.prototype, "submitting", void 0), r([m({ readOnly: true })], M2.prototype, "error", void 0), r([m({ type: y3 })], M2.prototype, "viewModel", void 0), r([m()], M2.prototype, "visibleElements", void 0), r([s3("visibleElements")], M2.prototype, "castVisibleElements", null), M2 = r([a("esri.widgets.Attachments")], M2);

// node_modules/@arcgis/core/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel.js
var s8 = class extends y3 {
  constructor(t4) {
    super(t4), this.description = null, this.title = null;
  }
};
r([m()], s8.prototype, "description", void 0), r([m()], s8.prototype, "title", void 0), s8 = r([a("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")], s8);

// node_modules/@arcgis/core/widgets/Feature/support/FeatureElementInfo.js
var p5 = "esri-feature-element-info";
var n6 = { base: p5, title: `${p5}__title`, description: `${p5}__description` };
var c6 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this.description = null, this.headingLevel = 2, this.title = null;
  }
  render() {
    return n("div", { class: n6.base }, this._renderTitle(), this._renderDescription());
  }
  _renderTitle() {
    const { title: e14 } = this;
    return e14 ? n(e5, { class: n6.title, innerHTML: e14, level: this.headingLevel }) : null;
  }
  _renderDescription() {
    const { description: e14 } = this;
    return e14 ? n("div", { class: n6.description, innerHTML: e14, key: "description" }) : null;
  }
};
r([m()], c6.prototype, "description", void 0), r([m()], c6.prototype, "headingLevel", void 0), r([m()], c6.prototype, "title", void 0), c6 = r([a("esri.widgets.Feature.support.FeatureElementInfo")], c6);

// node_modules/@arcgis/core/widgets/Feature/FeatureAttachments.js
var d6 = { base: "esri-feature-attachments" };
var h4 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._featureElementInfo = null, this.attachmentsWidget = new M2(), this.headingLevel = 2, this.viewModel = new s8();
  }
  initialize() {
    this._featureElementInfo = new c6(), this.addHandles([l(() => [this.viewModel?.description, this.viewModel?.title, this.headingLevel], () => this._setupFeatureElementInfo(), h2), l(() => this.viewModel, (e14) => this.attachmentsWidget.viewModel = e14, h2)]);
  }
  destroy() {
    this.attachmentsWidget.viewModel = null, this.attachmentsWidget.destroy(), this._featureElementInfo?.destroy();
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e14) {
    this.viewModel.description = e14;
  }
  get displayType() {
    return this.attachmentsWidget.displayType;
  }
  set displayType(e14) {
    this.attachmentsWidget.displayType = e14;
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e14) {
    this.viewModel.graphic = e14;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e14) {
    this.viewModel.title = e14;
  }
  render() {
    const { attachmentsWidget: e14 } = this;
    return n("div", { class: d6.base }, this._featureElementInfo?.render(), e14?.render());
  }
  _setupFeatureElementInfo() {
    const { description: e14, title: t4, headingLevel: i11 } = this;
    this._featureElementInfo?.set({ description: e14, title: t4, headingLevel: i11 });
  }
};
r([m({ readOnly: true })], h4.prototype, "attachmentsWidget", void 0), r([m()], h4.prototype, "description", null), r([m()], h4.prototype, "displayType", null), r([m()], h4.prototype, "graphic", null), r([m()], h4.prototype, "headingLevel", void 0), r([m()], h4.prototype, "title", null), r([m({ type: s8 })], h4.prototype, "viewModel", void 0), h4 = r([a("esri.widgets.Feature.FeatureAttachments")], h4);

// node_modules/@arcgis/core/widgets/Feature/FeatureContent/FeatureContentViewModel.js
var c7 = class extends b2 {
  constructor(t4) {
    super(t4), this._loadingPromise = null, this.created = null, this.creator = null, this.destroyer = null, this.graphic = null, this.addHandles(l(() => this.creator, (t5) => {
      this._destroyContent(), this._createContent(t5);
    }, h2));
  }
  destroy() {
    this._destroyContent();
  }
  get state() {
    return this._loadingPromise ? "loading" : "ready";
  }
  _destroyContent() {
    const { created: t4, graphic: e14, destroyer: r6 } = this;
    t4 && e14 && (q({ type: "content", value: r6, event: { graphic: e14 } }), this._set("created", null));
  }
  async _createContent(t4) {
    const e14 = this.graphic;
    if (!e14 || !t4) return;
    const r6 = q({ type: "content", value: t4, event: { graphic: e14 } });
    this._loadingPromise = r6, this.notifyChange("state");
    const o5 = await r6;
    r6 === this._loadingPromise && (this._loadingPromise = null, this.notifyChange("state"), this._set("created", o5));
  }
};
r([m({ readOnly: true })], c7.prototype, "created", void 0), r([m()], c7.prototype, "creator", void 0), r([m()], c7.prototype, "destroyer", void 0), r([m({ type: d4 })], c7.prototype, "graphic", void 0), r([m({ readOnly: true })], c7.prototype, "state", null), c7 = r([a("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")], c7);

// node_modules/@arcgis/core/widgets/support/widget.js
function e8(e14) {
  return e14 && "function" == typeof e14.render;
}
function o3(e14) {
  return e14 && "function" == typeof e14.postMixInProperties && "function" == typeof e14.buildRendering && "function" == typeof e14.postCreate && "function" == typeof e14.startup;
}

// node_modules/@arcgis/core/widgets/Feature/FeatureContent.js
var n8 = "esri-feature-content";
var c8 = { base: n8, loaderContainer: `${n8}__loader-container`, loader: `${n8}__loader` };
var l2 = class extends O {
  constructor(e14, r6) {
    super(e14, r6), this.viewModel = null, this._addTargetToAnchors = (e15) => {
      Array.from(e15.querySelectorAll("a")).forEach((e16) => {
        x2(e16.href) && !e16.hasAttribute("target") && e16.setAttribute("target", "_blank");
      });
    };
  }
  get creator() {
    return this.viewModel?.creator;
  }
  set creator(e14) {
    this.viewModel && (this.viewModel.creator = e14);
  }
  get graphic() {
    return this.viewModel?.graphic;
  }
  set graphic(e14) {
    this.viewModel && (this.viewModel.graphic = e14);
  }
  render() {
    const e14 = this.viewModel?.state;
    return n("div", { class: c8.base }, "loading" === e14 ? this._renderLoading() : this._renderCreated());
  }
  _renderLoading() {
    return n("div", { class: c8.loaderContainer, key: "loader" }, n("div", { class: c8.loader }));
  }
  _renderCreated() {
    const e14 = this.viewModel?.created;
    return e14 ? e14 instanceof HTMLElement ? n("div", { afterCreate: this._attachToNode, bind: e14, key: e14 }) : e8(e14) ? n("div", { key: e14 }, !e14.destroyed && e14.render()) : n("div", { afterCreate: this._addTargetToAnchors, innerHTML: e14, key: e14 }) : null;
  }
  _attachToNode(e14) {
    const r6 = this;
    e14.appendChild(r6);
  }
};
r([m()], l2.prototype, "creator", null), r([m()], l2.prototype, "graphic", null), r([m({ type: c7 })], l2.prototype, "viewModel", void 0), l2 = r([a("esri.widgets.Feature.FeatureContent")], l2);

// node_modules/@arcgis/core/widgets/Feature/FeatureFields/FeatureFieldsViewModel.js
var l3 = class extends b2 {
  constructor(o5) {
    super(o5), this.attributes = null, this.expressionInfos = null, this.description = null, this.fieldInfos = null, this.title = null;
  }
  get formattedFieldInfos() {
    const { expressionInfos: o5, fieldInfos: e14 } = this, t4 = [];
    return e14?.forEach((e15) => {
      if (!(!e15.hasOwnProperty("visible") || e15.visible)) return;
      const s11 = e15.clone();
      s11.label = A2(s11, o5), t4.push(s11);
    }), t4;
  }
};
r([m()], l3.prototype, "attributes", void 0), r([m({ type: [i4] })], l3.prototype, "expressionInfos", void 0), r([m()], l3.prototype, "description", void 0), r([m({ type: [n5] })], l3.prototype, "fieldInfos", void 0), r([m({ readOnly: true })], l3.prototype, "formattedFieldInfos", null), r([m()], l3.prototype, "title", void 0), l3 = r([a("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")], l3);

// node_modules/@arcgis/core/widgets/support/uriUtils.js
var p7 = [{ pattern: /^\s*(https?:\/\/([^\s]+))\s*$/i, target: "_blank", label: "{messages.view}" }, { pattern: /^\s*(tel:([^\s]+))\s*$/i, label: "{hierPart}" }, { pattern: /^\s*(mailto:([^\s]+))\s*$/i, label: "{hierPart}" }, { pattern: /^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "App Studio Player" }, { pattern: /^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Collector" }, { pattern: /^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Explorer" }, { pattern: /^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Navigator" }, { pattern: /^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Survey123" }, { pattern: /^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Trek2There" }, { pattern: /^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Workforce" }, { pattern: /^\s*(iform:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "iForm" }, { pattern: /^\s*(flow:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "FlowFinity" }, { pattern: /^\s*(lfmobile:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Laserfische" }, { pattern: /^\s*(mspbi:\/\/([^\s]+))\s*$/i, label: "{messages.openInApp}", appName: "Microsoft Power Bi" }];
function r3(r6, t4) {
  if ("string" != typeof t4 || !t4) return t4;
  const n13 = p7.find((e14) => e14.pattern.test(t4));
  if (!n13) return t4;
  const i11 = t4.match(n13.pattern), l5 = i11?.[2], o5 = r2(r2(n13.label, { messages: r6, hierPart: l5 }), { appName: n13.appName }), m6 = n13.target ? ` target="${n13.target}"` : "", g8 = "_blank" === n13.target ? ' rel="noreferrer"' : "";
  return t.sanitizeUrl(_(t4)).replace(n13.pattern, `<a${m6} href="$1"${g8}>${o5}</a>`);
}

// node_modules/@arcgis/core/widgets/Feature/FeatureFields.js
var u3 = "esri-feature-fields";
var m2 = { base: u3, fieldHeader: `${u3}__field-header`, fieldData: `${u3}__field-data`, fieldDataDate: `${u3}__field-data--date` };
var c9 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._featureElementInfo = null, this.viewModel = new l3(), this.messages = null, this.messagesURIUtils = null;
  }
  initialize() {
    this._featureElementInfo = new c6(), this.addHandles(l(() => [this.viewModel?.description, this.viewModel?.title], () => this._setupFeatureElementInfo(), h2));
  }
  destroy() {
    this._featureElementInfo?.destroy();
  }
  get attributes() {
    return this.viewModel.attributes;
  }
  set attributes(e14) {
    this.viewModel.attributes = e14;
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e14) {
    this.viewModel.description = e14;
  }
  get expressionInfos() {
    return this.viewModel.expressionInfos;
  }
  set expressionInfos(e14) {
    this.viewModel.expressionInfos = e14;
  }
  get fieldInfos() {
    return this.viewModel.fieldInfos;
  }
  set fieldInfos(e14) {
    this.viewModel.fieldInfos = e14;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e14) {
    this.viewModel.title = e14;
  }
  render() {
    return n("div", { class: m2.base }, this._featureElementInfo?.render(), this._renderFields());
  }
  _renderFieldInfo(e14, t4) {
    const { attributes: s11 } = this.viewModel, i11 = e14.fieldName || "", r6 = e14.label || i11, o5 = s11 ? null == s11[i11] ? "" : s11[i11] : "", l5 = !!e14.format?.dateFormat, n13 = "number" == typeof o5 && !l5 ? this._forceLTR(o5) : r3(this.messagesURIUtils, o5), d10 = { [m2.fieldDataDate]: l5 };
    return n("tr", { key: `fields-element-info-row-${i11}-${t4}` }, n("th", { class: m2.fieldHeader, innerHTML: r6, key: `fields-element-info-row-header-${i11}-${t4}` }), n("td", { class: this.classes(m2.fieldData, d10), innerHTML: n13, key: `fields-element-info-row-data-${i11}-${t4}` }));
  }
  _renderFields() {
    const { formattedFieldInfos: e14 } = this.viewModel;
    return e14?.length ? n("table", { class: e4.table, summary: this.messages.fieldsSummary }, n("tbody", null, e14.map((e15, t4) => this._renderFieldInfo(e15, t4)))) : null;
  }
  _setupFeatureElementInfo() {
    const { description: e14, title: t4 } = this;
    this._featureElementInfo?.set({ description: e14, title: t4 });
  }
  _forceLTR(e14) {
    return `&lrm;${e14}`;
  }
};
r([m()], c9.prototype, "attributes", null), r([m()], c9.prototype, "description", null), r([m()], c9.prototype, "expressionInfos", null), r([m()], c9.prototype, "fieldInfos", null), r([m()], c9.prototype, "title", null), r([m({ type: l3, nonNullable: true })], c9.prototype, "viewModel", void 0), r([m(), e3("esri/widgets/Feature/t9n/Feature")], c9.prototype, "messages", void 0), r([m(), e3("esri/widgets/support/t9n/uriUtils")], c9.prototype, "messagesURIUtils", void 0), c9 = r([a("esri.widgets.Feature.FeatureFields")], c9);

// node_modules/@arcgis/core/widgets/Feature/support/relatedFeatureUtils.js
var d7 = "esri.widgets.Feature.support.relatedFeatureUtils";
var p8 = () => i2.getLogger(d7);
var m3 = /* @__PURE__ */ new Map();
function h5(e14) {
  if (!pe(e14)) return null;
  const [t4, r6] = e14.split("/").slice(1);
  return { layerId: t4, fieldName: r6 };
}
function y4(e14, t4) {
  if (!t4.relationships) return null;
  let r6 = null;
  const { relationships: i11 } = t4;
  return i11.some((t5) => t5.id === parseInt(e14, 10) && (r6 = t5, true)), r6;
}
function I2({ originRelationship: e14, relationships: t4, layerId: r6 }) {
  return t4.find(({ relatedTableId: t5, id: i11 }) => `${t5}` === r6 && i11 === e14?.id) ?? null;
}
function F2(e14, t4) {
  const r6 = t4.toLowerCase();
  for (const i11 in e14) if (i11.toLowerCase() === r6) return e14[i11];
  return null;
}
function b4(e14, t4) {
  const r6 = y4(e14, t4);
  if (!r6) return;
  return { url: `${t4.url}/${r6.relatedTableId}`, sourceSpatialReference: t4.spatialReference, relation: r6, relatedFields: [], outStatistics: [] };
}
function g(e14, t4) {
  if (!t4) return;
  if (!e14) return;
  const { features: r6, statsFeatures: i11 } = e14, o5 = r6?.value;
  t4.relatedFeatures = o5 ? o5.features : [];
  const s11 = i11?.value;
  t4.relatedStatsFeatures = s11 ? s11.features : [];
}
function S(e14, t4, r6, i11) {
  const o5 = new c5();
  return o5.outFields = ["*"], o5.relationshipId = "number" == typeof t4.id ? t4.id : parseInt(t4.id, 10), o5.objectIds = [e14.attributes[r6.objectIdField]], o5.gdbVersion = r6.gdbVersion ?? null, o5.historicMoment = r6.historicMoment ?? null, r6.queryRelatedFeatures?.(o5, i11) ?? Promise.resolve({});
}
function w2(e14, t4, r6) {
  let i11 = 0;
  const o5 = [];
  for (; i11 < t4.length; ) o5.push(`${e14} IN (${t4.slice(i11, r6 + i11)})`), i11 += r6;
  return o5.join(" OR ");
}
function j2(e14) {
  return e14 ? c(e14) : void 0;
}
function R3(e14) {
  return e14 ? c(e14, (e15, t4) => JSON.stringify(e15.toJSON()) === JSON.stringify(t4.toJSON())) : void 0;
}
async function $(e14, t4, r6, i11) {
  const o5 = r6.layerId.toString(), { layerInfo: u8, relation: c12, relatedFields: f8, outStatistics: d10, url: p10, sourceSpatialReference: m6 } = t4, h8 = j2(f8), y10 = R3(d10);
  if (!u8 || !c12) return null;
  const b9 = I2({ originRelationship: c12, relationships: u8.relationships, layerId: o5 });
  if (b9?.relationshipTableId && b9.keyFieldInRelationshipTable) {
    const t5 = (await S(e14, b9, r6, i11))[e14.attributes[r6.objectIdField]];
    if (!t5) return null;
    const o6 = t5.features.map((e15) => e15.attributes[u8.objectIdField]);
    if (y10?.length && u8.supportsStatistics) {
      const e15 = new R();
      e15.where = w2(u8.objectIdField, o6, 1e3), e15.outFields = h8, e15.outStatistics = y10, e15.sourceSpatialReference = m6;
      const r7 = { features: Promise.resolve(t5), statsFeatures: s6(p10, e15) };
      return y(r7);
    }
  }
  const g8 = b9?.keyField;
  if (g8) {
    const t5 = ge(L4(u8.fields, g8)), o6 = F2(e14.attributes, c12.keyField), f9 = t5 ? `${g8}=${o6}` : `${g8}='${o6}'`, d11 = r6.historicMoment, I6 = r6.gdbVersion, b10 = s6(p10, new R({ where: f9, outFields: h8, sourceSpatialReference: m6, historicMoment: d11, gdbVersion: I6 }), i11), S2 = !!y10?.length && u8.supportsStatistics ? s6(p10, new R({ where: f9, outFields: h8, outStatistics: y10, sourceSpatialReference: m6 }), i11) : null, w5 = { features: b10 };
    return S2 && (w5.statsFeatures = S2), y(w5);
  }
  return null;
}
function N(t4, r6) {
  return H(t4, { query: { f: "json" }, signal: r6?.signal });
}
function v3({ relatedInfos: e14, layer: t4 }, i11) {
  const n13 = {};
  return e14.forEach((e15, i12) => {
    const { relation: o5 } = e15;
    if (!o5) {
      const e16 = new s("editor:relation-required", "A relation is required on a layer to retrieve related records.");
      throw p8().error(e16), e16;
    }
    const { relatedTableId: s11 } = o5;
    if ("number" != typeof s11) {
      const e16 = new s("editor:related-table", "A related table ID is required on a layer to retrieve related records.");
      throw p8().error(e16), e16;
    }
    const l5 = `${t4.url}/${s11}`, a6 = m3.get(l5), u8 = a6 ?? N(l5);
    a6 || m3.set(l5, u8), n13[i12] = u8;
  }), h(y(n13), i11);
}
function T2({ graphic: e14, relatedInfos: t4, layer: r6 }, i11) {
  const o5 = {};
  return t4.forEach((t5, s11) => {
    t5.layerInfo && (o5[s11] = $(e14, t5, r6, i11));
  }), y(o5);
}
function q2({ relatedInfo: e14, fieldName: t4, fieldInfo: r6 }) {
  if (e14.relatedFields?.push(t4), r6.statisticType) {
    const i11 = new p2({ statisticType: r6.statisticType, onStatisticField: t4, outStatisticFieldName: t4 });
    e14.outStatistics?.push(i11);
  }
}
function L4(e14, t4) {
  if (null != e14) {
    t4 = t4.toLowerCase();
    for (const r6 of e14) if (r6 && r6.name.toLowerCase() === t4) return r6;
  }
  return null;
}

// node_modules/@arcgis/core/widgets/Feature/FeatureMedia/FeatureMediaViewModel.js
var I3 = { chartAnimation: true };
var v4 = class extends b2 {
  constructor(t4) {
    super(t4), this.abilities = { ...I3 }, this.activeMediaInfoIndex = 0, this.attributes = null, this.description = null, this.fieldInfoMap = null, this.formattedAttributes = null, this.expressionAttributes = null, this.isAggregate = false, this.layer = null, this.mediaInfos = null, this.popupTemplate = null, this.relatedInfos = null, this.title = null;
  }
  castAbilities(t4) {
    return { ...I3, ...t4 };
  }
  get activeMediaInfo() {
    return this.formattedMediaInfos[this.activeMediaInfoIndex] || null;
  }
  get formattedMediaInfos() {
    return this._formatMediaInfos() || [];
  }
  get formattedMediaInfoCount() {
    return this.formattedMediaInfos.length;
  }
  setActiveMedia(t4) {
    this._setContentElementMedia(t4);
  }
  next() {
    this._pageContentElementMedia(1);
  }
  previous() {
    this._pageContentElementMedia(-1);
  }
  _setContentElementMedia(t4) {
    const { formattedMediaInfoCount: e14 } = this, i11 = (t4 + e14) % e14;
    this.activeMediaInfoIndex = i11;
  }
  _pageContentElementMedia(t4) {
    const { activeMediaInfoIndex: e14 } = this, i11 = e14 + t4;
    this._setContentElementMedia(i11);
  }
  _formatMediaInfos() {
    const { mediaInfos: t4, layer: e14 } = this, o5 = this.attributes ?? {}, r6 = this.formattedAttributes ?? {}, a6 = this.expressionAttributes ?? {}, s11 = this.fieldInfoMap ?? /* @__PURE__ */ new Map();
    return t4?.map((t5) => {
      const i11 = t5?.clone();
      if (!i11) return null;
      if (i11.title = D({ attributes: o5, fieldInfoMap: s11, globalAttributes: r6, expressionAttributes: a6, layer: e14, text: i11.title }), i11.caption = D({ attributes: o5, fieldInfoMap: s11, globalAttributes: r6, expressionAttributes: a6, layer: e14, text: i11.caption }), i11.altText = D({ attributes: o5, fieldInfoMap: s11, globalAttributes: r6, expressionAttributes: a6, layer: e14, text: i11.altText }), "image" === i11.type) {
        if (!i11.value) return;
        return this._setImageValue({ value: i11.value, formattedAttributes: r6, layer: e14 }), i11.value.sourceURL ? i11 : void 0;
      }
      if ("pie-chart" === i11.type || "line-chart" === i11.type || "column-chart" === i11.type || "bar-chart" === i11.type) {
        if (!i11.value) return;
        return this._setChartValue({ value: i11.value, chartType: i11.type, attributes: o5, formattedAttributes: r6, layer: e14, expressionAttributes: a6 }), i11;
      }
      return null;
    }).filter(L) ?? [];
  }
  _setImageValue(t4) {
    const e14 = this.fieldInfoMap ?? /* @__PURE__ */ new Map(), { value: i11, formattedAttributes: o5, layer: r6 } = t4, { linkURL: a6, sourceURL: s11 } = i11;
    if (s11) {
      const t5 = Q(s11, r6);
      i11.sourceURL = z({ formattedAttributes: o5, template: t5, fieldInfoMap: e14 });
    }
    if (a6) {
      const t5 = Q(a6, r6);
      i11.linkURL = z({ formattedAttributes: o5, template: t5, fieldInfoMap: e14 });
    }
  }
  _setChartValue(t4) {
    const { value: e14, attributes: i11, formattedAttributes: o5, chartType: r6, layer: a6, expressionAttributes: s11 } = t4, { popupTemplate: l5, relatedInfos: n13 } = this, { fields: p10, normalizeField: u8 } = e14, m6 = a6;
    e14.fields = R2(p10, m6), u8 && (e14.normalizeField = M(u8, m6));
    if (!p10.some((t5) => !!(null != o5[t5] || pe(t5) && n13?.size))) return;
    const h8 = l5?.fieldInfos ?? [];
    p10.forEach((t5, a7) => {
      const l6 = e14.colors?.[a7];
      if (pe(t5)) return void (e14.series = [...e14.series, ...this._getRelatedChartInfos({ fieldInfos: h8, fieldName: t5, formattedAttributes: o5, chartType: r6, value: e14, color: l6 })]);
      const n14 = this._getChartOption({ value: e14, attributes: i11, chartType: r6, formattedAttributes: o5, expressionAttributes: s11, fieldName: t5, fieldInfos: h8, color: l6 });
      e14.series.push(n14);
    });
  }
  _getRelatedChartInfos(t4) {
    const { fieldInfos: e14, fieldName: i11, formattedAttributes: o5, chartType: r6, value: a6, color: s11 } = t4, l5 = [], n13 = h5(i11), p10 = n13 && this.relatedInfos?.get(n13.layerId.toString());
    if (!p10) return l5;
    const { relatedFeatures: u8, relation: d10 } = p10;
    if (!d10 || !u8) return l5;
    const { cardinality: f8 } = d10;
    u8.forEach((t5) => {
      const { attributes: p11 } = t5;
      p11 && Object.keys(p11).forEach((t6) => {
        t6 === n13.fieldName && l5.push(this._getChartOption({ value: a6, attributes: p11, formattedAttributes: o5, fieldName: i11, chartType: r6, relatedFieldName: t6, hasMultipleRelatedFeatures: u8?.length > 1, fieldInfos: e14, color: s11 }));
      });
    });
    return "one-to-many" === f8 || "many-to-many" === f8 ? l5 : [l5[0]];
  }
  _getTooltip({ label: t4, value: e14, chartType: i11 }) {
    return "pie-chart" === i11 ? `${t4}` : `${t4}: ${e14}`;
  }
  _getChartOption(t4) {
    const { value: e14, attributes: i11, formattedAttributes: o5, expressionAttributes: r6, fieldName: a6, relatedFieldName: n13, fieldInfos: p10, chartType: u8, hasMultipleRelatedFeatures: d10, color: I6 } = t4, v8 = this.layer, M5 = this.fieldInfoMap ?? /* @__PURE__ */ new Map(), { normalizeField: A5, tooltipField: g8 } = e14, x7 = A5 ? pe(A5) ? i11[h5(A5).fieldName] : i11[A5] : null, _5 = E(a6) && r6 && void 0 !== r6[a6] ? r6[a6] : n13 && void 0 !== i11[n13] ? i11[n13] : void 0 !== i11[a6] ? i11[a6] : o5[a6], C4 = void 0 === _5 ? null : _5 && x7 ? _5 / x7 : _5, T6 = new p({ fieldName: a6, color: I6, value: "number" == typeof C4 ? C4 : Number(C4) });
    if (pe(a6)) {
      const t5 = M5.get(a6.toLowerCase()), e15 = g8 && M5.get(g8.toLowerCase()), r7 = t5?.fieldName ?? a6, s11 = d10 && g8 ? h5(g8).fieldName : e15?.fieldName ?? g8, l5 = d10 && s11 ? i11[s11] : o5[s11] ?? t5?.label ?? t5?.fieldName ?? n13, p11 = d10 && n13 ? i11[n13] : o5[r7];
      return T6.tooltip = this._getTooltip({ label: l5, value: p11, chartType: u8 }), T6;
    }
    const N3 = ee(p10, a6), F9 = M(a6, v8), j3 = g8 && void 0 !== o5[g8] ? o5[g8] : A2(N3 || new n5({ fieldName: F9 }), this.popupTemplate?.expressionInfos), w5 = o5[F9];
    return T6.tooltip = this._getTooltip({ label: j3, value: w5, chartType: u8 }), T6;
  }
};
r([m()], v4.prototype, "abilities", void 0), r([s3("abilities")], v4.prototype, "castAbilities", null), r([m()], v4.prototype, "activeMediaInfoIndex", void 0), r([m({ readOnly: true })], v4.prototype, "activeMediaInfo", null), r([m()], v4.prototype, "attributes", void 0), r([m()], v4.prototype, "description", void 0), r([m()], v4.prototype, "fieldInfoMap", void 0), r([m()], v4.prototype, "formattedAttributes", void 0), r([m()], v4.prototype, "expressionAttributes", void 0), r([m({ readOnly: true })], v4.prototype, "formattedMediaInfos", null), r([m()], v4.prototype, "isAggregate", void 0), r([m()], v4.prototype, "layer", void 0), r([m({ readOnly: true })], v4.prototype, "formattedMediaInfoCount", null), r([m()], v4.prototype, "mediaInfos", void 0), r([m()], v4.prototype, "popupTemplate", void 0), r([m()], v4.prototype, "relatedInfos", void 0), r([m()], v4.prototype, "title", void 0), v4 = r([a("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")], v4);

// node_modules/@arcgis/core/widgets/Feature/FeatureMedia.js
var _3 = "esri-feature-media";
var M3 = { base: _3, mediaContainer: `${_3}__container`, mediaItemContainer: `${_3}__item-container`, mediaItem: `${_3}__item`, mediaItemText: `${_3}__item-text`, mediaItemTitle: `${_3}__item-title`, mediaItemCaption: `${_3}__item-caption`, mediaNavigation: `${_3}__item-navigation`, mediaPagination: `${_3}__pagination`, mediaPaginationText: `${_3}__pagination-text`, mediaChart: `${_3}__chart`, mediaPaginationButton: `${_3}__pagination-button`, mediaPaginationIcon: `${_3}__pagination-icon`, mediaChartRendered: `${_3}__chart--rendered` };
var v5 = 15;
var w3 = "category";
var A4 = "value";
var I4 = "rgba(50, 50, 50, 1)";
var C = 250;
var y5 = 500;
var x4 = 200;
var T3 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._refreshTimer = null, this._refreshIntervalInfo = null, this._featureElementInfo = null, this._chartRootMap = /* @__PURE__ */ new WeakMap(), this.viewModel = new v4(), this.messages = null, this._disposeChart = (e15) => {
      this._chartRootMap.get(e15)?.dispose(), this._chartRootMap.delete(e15);
    }, this._createChart = async (e15) => {
      const { destroyed: t5, viewModel: i11 } = this;
      if (t5 || !i11 || !e15) return;
      const { createRoot: r6 } = await import("./chartUtilsAm5-4HTIBZVB.js"), a6 = await r6(e15);
      this._chartRootMap.set(e15, a6), this._renderChart({ mediaInfo: i11.activeMediaInfo, root: a6 });
    };
  }
  initialize() {
    this._featureElementInfo = new c6(), this.addHandles([l(() => [this.viewModel?.activeMediaInfo, this.viewModel?.activeMediaInfoIndex], () => this._setupMediaRefreshTimer(), h2), l(() => [this.viewModel?.description, this.viewModel?.title], () => this._setupFeatureElementInfo(), h2)]);
  }
  loadDependencies() {
    return c3({ icon: () => import("./calcite-icon-5R57LYRD.js") });
  }
  destroy() {
    this._clearMediaRefreshTimer(), this._featureElementInfo?.destroy();
  }
  get attributes() {
    return this.viewModel.attributes;
  }
  set attributes(e14) {
    this.viewModel.attributes = e14;
  }
  get activeMediaInfoIndex() {
    return this.viewModel.activeMediaInfoIndex;
  }
  set activeMediaInfoIndex(e14) {
    this.viewModel.activeMediaInfoIndex = e14;
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e14) {
    this.viewModel.description = e14;
  }
  get fieldInfoMap() {
    return this.viewModel.fieldInfoMap;
  }
  set fieldInfoMap(e14) {
    this.viewModel.fieldInfoMap = e14;
  }
  get layer() {
    return this.viewModel.layer;
  }
  set layer(e14) {
    this.viewModel.layer = e14;
  }
  get mediaInfos() {
    return this.viewModel.mediaInfos;
  }
  set mediaInfos(e14) {
    this.viewModel.mediaInfos = e14;
  }
  get popupTemplate() {
    return this.viewModel.popupTemplate;
  }
  set popupTemplate(e14) {
    this.viewModel.popupTemplate = e14;
  }
  get relatedInfos() {
    return this.viewModel.relatedInfos;
  }
  set relatedInfos(e14) {
    this.viewModel.relatedInfos = e14;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e14) {
    this.viewModel.title = e14;
  }
  render() {
    return n("div", { bind: this, class: M3.base, onkeyup: this._handleMediaKeyup }, this._featureElementInfo?.render(), this._renderMedia());
  }
  _renderMedia() {
    const { formattedMediaInfoCount: e14, activeMediaInfoIndex: t4 } = this.viewModel, i11 = this._renderMediaText();
    return e14 ? n("div", { class: M3.mediaContainer, key: "media-element-container" }, this._renderMediaInfo(), n("div", { class: M3.mediaNavigation }, i11, e14 > 1 ? n("div", { class: M3.mediaPagination }, this._renderMediaPageButton("previous"), n("span", { class: M3.mediaPaginationText }, s4(this.messages.pageText, { index: t4 + 1, total: e14 })), this._renderMediaPageButton("next")) : null)) : null;
  }
  _renderMediaText() {
    const { activeMediaInfo: e14 } = this.viewModel;
    if (!e14) return null;
    const t4 = e14 && e14.title ? n("div", { class: M3.mediaItemTitle, innerHTML: e14.title, key: "media-title" }) : null, i11 = e14 && e14.caption ? n("div", { class: M3.mediaItemCaption, innerHTML: e14.caption, key: "media-caption" }) : null;
    return t4 || i11 ? n("div", { class: M3.mediaItemText, key: "media-text" }, t4, i11) : null;
  }
  _renderImageMediaInfo(e14) {
    if (!e14.value) return null;
    const { _refreshIntervalInfo: t4 } = this, { activeMediaInfoIndex: i11, formattedMediaInfoCount: r6 } = this.viewModel, { value: a6, refreshInterval: o5, altText: s11, title: n13, type: l5 } = e14, { sourceURL: d10, linkURL: c12 } = a6, h8 = x2(c12 ?? void 0) ? "_blank" : "_self", p10 = "_blank" === h8 ? "noreferrer" : "", f8 = o5 ? t4 : null, g8 = f8 ? f8.timestamp : 0, _5 = f8 ? f8.sourceURL : d10, M5 = n("img", { alt: s11 || n13, key: `media-${l5}-${i11}-${r6}-${g8}`, src: _5 ?? void 0 });
    return (c12 ? n("a", { href: c12, rel: p10, target: h8, title: n13 }, M5) : null) ?? M5;
  }
  _renderChartMediaInfo(e14) {
    const { activeMediaInfoIndex: t4, formattedMediaInfoCount: i11 } = this.viewModel;
    return n("div", { afterCreate: this._createChart, afterRemoved: this._disposeChart, bind: this, class: M3.mediaChart, key: `media-${e14.type}-${t4}-${i11}` });
  }
  _renderMediaInfoType() {
    const { activeMediaInfo: e14 } = this.viewModel;
    return e14 ? "image" === e14.type ? this._renderImageMediaInfo(e14) : e14.type.includes("chart") ? this._renderChartMediaInfo(e14) : null : null;
  }
  _renderMediaInfo() {
    const { activeMediaInfo: e14 } = this.viewModel;
    return e14 ? n("div", { class: M3.mediaItemContainer, key: "media-container" }, n("div", { class: M3.mediaItem, key: "media-item-container" }, this._renderMediaInfoType())) : null;
  }
  _renderMediaPageButton(e14) {
    if (this.viewModel.formattedMediaInfoCount < 2) return null;
    const t4 = "previous" === e14, i11 = t4 ? this.messages.previous : this.messages.next, r6 = t4 ? "chevron-left" : "chevron-right", a6 = t4 ? "media-previous" : "media-next", o5 = t4 ? this._previous : this._next;
    return n("button", { "aria-label": i11, bind: this, class: M3.mediaPaginationButton, key: a6, onclick: o5, tabIndex: 0, title: i11, type: "button" }, n("calcite-icon", { class: M3.mediaPaginationIcon, icon: r6, scale: "s" }));
  }
  _setupFeatureElementInfo() {
    const { description: e14, title: t4 } = this;
    this._featureElementInfo?.set({ description: e14, title: t4 });
  }
  _next() {
    this.viewModel.next();
  }
  _previous() {
    this.viewModel.previous();
  }
  _getRenderer() {
    if (!this.viewModel) return;
    const { isAggregate: e14, layer: t4 } = this.viewModel;
    return e14 && t4?.featureReduction && "renderer" in t4.featureReduction ? t4.featureReduction.renderer : t4?.renderer;
  }
  async _getSeriesColors(e14) {
    const { colorAm5: t4 } = await import("./chartCommon-MY7IS7CC.js"), i11 = /* @__PURE__ */ new Map();
    return e14.forEach((e15) => {
      e15.color && i11.set(e15, t4(e15.color.toCss(true)));
    }), i11;
  }
  async _getRendererColors() {
    const { colorAm5: e14 } = await import("./chartCommon-MY7IS7CC.js"), t4 = /* @__PURE__ */ new Map(), i11 = this._getRenderer(), r6 = "default";
    if (!i11) return t4;
    const a6 = await x3(i11);
    a6.delete(r6);
    return Array.from(a6.values()).every((e15) => 1 === e15?.length) ? (Array.from(a6.keys()).forEach((i12) => {
      const r7 = a6.get(i12)?.[0]?.toCss(true);
      r7 && t4.set(i12, e14(r7));
    }), t4) : t4;
  }
  _handleMediaKeyup(e14) {
    const { key: t4 } = e14;
    "ArrowLeft" === t4 && (e14.stopPropagation(), this.viewModel.previous()), "ArrowRight" === t4 && (e14.stopPropagation(), this.viewModel.next());
  }
  _canAnimateChart() {
    return !!this.viewModel && (!!this.viewModel.abilities.chartAnimation && !o2());
  }
  _getChartAnimationMS() {
    return this._canAnimateChart() ? C : 0;
  }
  _getChartSeriesAnimationMS() {
    return this._canAnimateChart() ? y5 : 0;
  }
  async _renderChart(e14) {
    const { root: t4, mediaInfo: i11 } = e14, { value: r6, type: a6 } = i11, { ResponsiveThemeAm5: o5, DarkThemeAm5: s11, AnimatedThemeAm5: n13, ColorSetAm5: l5, ThemeAm5: d10, esriChartColorSet: m6 } = await import("./chartCommon-MY7IS7CC.js"), c12 = d10.new(t4);
    c12.rule("ColorSet").set("colors", m6), c12.rule("ColorSet").set("reuse", true);
    const h8 = [o5.new(t4), c12];
    s5() && h8.push(s11.new(t4)), this._canAnimateChart() && h8.push(n13.new(t4)), t4.setThemes(h8);
    const p10 = await this._getRendererColors(), u8 = await this._getSeriesColors(r6.series), g8 = l5.new(t4, {}), _5 = u8.get(r6.series[0]), M5 = _5 ? { lineSettings: { stroke: _5 } } : void 0, v8 = r6.series.map((e15, t5) => {
      const i12 = u8.get(e15) || p10.get(e15.fieldName) || g8.getIndex(t5);
      return { [w3]: e15.tooltip, [A4]: e15.value, columnSettings: { fill: i12, stroke: i12 }, ...M5 };
    }).filter((e15) => "pie-chart" !== a6 || null != e15.value && e15.value > 0);
    "pie-chart" === a6 ? this._createPieChart(e14, v8) : this._createXYChart(e14, v8);
  }
  _getDirection() {
    return L2(this.container) ? "rtl" : "ltr";
  }
  async _customizeChartTooltip(e14, t4 = "horizontal") {
    const { colorAm5: i11 } = await import("./chartCommon-MY7IS7CC.js");
    e14.setAll({ pointerOrientation: t4 }), e14.get("background")?.setAll({ stroke: i11(I4) }), e14.label.setAll({ direction: this._getDirection(), oversizedBehavior: "wrap", maxWidth: x4 });
  }
  async _createPieChart(e14, t4) {
    const { TooltipAm5: i11 } = await import("./chartCommon-MY7IS7CC.js"), { PieChartAm5: r6, PieSeriesAm5: a6 } = await import("./pieChart-APOQB2AQ.js"), { mediaInfo: o5, root: s11 } = e14, { title: n13 } = o5, l5 = 5, d10 = o5?.altText || o5?.title || "", m6 = s11.container.children.push(r6.new(s11, { ariaLabel: d10, focusable: true, paddingBottom: l5, paddingTop: l5, paddingLeft: l5, paddingRight: l5 })), c12 = "{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})", h8 = i11.new(s11, { labelText: c12 }), p10 = m6.series.push(a6.new(s11, { name: n13, valueField: A4, categoryField: w3, tooltip: h8 }));
    p10.ticks.template.set("forceHidden", true), p10.labels.template.set("forceHidden", true), p10.slices.template.states.create("active", { shiftRadius: l5 }), this._customizeChartTooltip(h8), p10.slices.template.setAll({ ariaLabel: c12, focusable: true, templateField: "columnSettings" }), p10.data.setAll(t4), p10.appear(this._getChartSeriesAnimationMS()), m6.appear(this._getChartAnimationMS()), m6.root.dom.classList.toggle(M3.mediaChartRendered, true);
  }
  _getMinSeriesValue(e14) {
    let t4 = 0;
    return e14.forEach((e15) => t4 = Math.min(e15.value, t4)), t4;
  }
  async _createColumnChart(e14, t4, i11) {
    const { TooltipAm5: r6, ScrollbarAm5: a6 } = await import("./chartCommon-MY7IS7CC.js"), { CategoryAxisAm5: o5, AxisRendererXAm5: s11, ValueAxisAm5: n13, AxisRendererYAm5: l5, ColumnSeriesAm5: d10 } = await import("./xyChart-7IY4CDZS.js"), { mediaInfo: m6, root: c12 } = t4, { value: p10, title: u8 } = m6;
    e14.setAll({ wheelX: "panX", wheelY: "zoomX" });
    const f8 = e14.xAxes.push(o5.new(c12, { renderer: s11.new(c12, { inversed: L2(this.container) }), categoryField: w3 }));
    f8.get("renderer").labels.template.setAll({ forceHidden: true });
    const g8 = e14.yAxes.push(n13.new(c12, { renderer: l5.new(c12, { inside: false }), min: this._getMinSeriesValue(p10.series) }));
    g8.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryX}", M5 = r6.new(c12, { labelText: _5 }), I6 = e14.series.push(d10.new(c12, { name: u8, xAxis: f8, yAxis: g8, valueYField: A4, categoryXField: w3, tooltip: M5 }));
    this._customizeChartTooltip(M5), I6.columns.template.setAll({ ariaLabel: _5, focusable: true, templateField: "columnSettings" }), p10.series.length > v5 && e14.set("scrollbarX", a6.new(c12, { orientation: "horizontal" })), f8.data.setAll(i11), I6.data.setAll(i11), I6.appear(this._getChartSeriesAnimationMS()), e14.appear(this._getChartAnimationMS());
  }
  async _createBarChart(e14, t4, i11) {
    const { TooltipAm5: r6, ScrollbarAm5: a6 } = await import("./chartCommon-MY7IS7CC.js"), { CategoryAxisAm5: o5, AxisRendererXAm5: s11, ValueAxisAm5: n13, AxisRendererYAm5: l5, ColumnSeriesAm5: d10 } = await import("./xyChart-7IY4CDZS.js"), { mediaInfo: m6, root: c12 } = t4, { value: p10, title: u8 } = m6;
    e14.setAll({ wheelX: "panY", wheelY: "zoomY" });
    const f8 = e14.yAxes.push(o5.new(c12, { renderer: l5.new(c12, { inversed: true }), categoryField: w3 }));
    f8.get("renderer").labels.template.setAll({ forceHidden: true });
    const g8 = e14.xAxes.push(n13.new(c12, { renderer: s11.new(c12, { inside: false, inversed: L2(this.container) }), min: this._getMinSeriesValue(p10.series) }));
    g8.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryY}", M5 = r6.new(c12, { labelText: _5 }), I6 = e14.series.push(d10.new(c12, { name: u8, xAxis: g8, yAxis: f8, valueXField: A4, categoryYField: w3, tooltip: M5 }));
    this._customizeChartTooltip(M5, "vertical"), I6.columns.template.setAll({ ariaLabel: _5, focusable: true, templateField: "columnSettings" }), p10.series.length > v5 && e14.set("scrollbarY", a6.new(c12, { orientation: "vertical" })), f8.data.setAll(i11), I6.data.setAll(i11), I6.appear(this._getChartSeriesAnimationMS()), e14.appear(this._getChartAnimationMS());
  }
  async _createLineChart(e14, t4, i11) {
    const { TooltipAm5: r6, ScrollbarAm5: a6 } = await import("./chartCommon-MY7IS7CC.js"), { CategoryAxisAm5: o5, AxisRendererXAm5: s11, ValueAxisAm5: n13, AxisRendererYAm5: l5, LineSeriesAm5: d10 } = await import("./xyChart-7IY4CDZS.js"), { root: m6, mediaInfo: c12 } = t4, { value: p10, title: u8 } = c12;
    e14.setAll({ wheelX: "panX", wheelY: "zoomX" });
    const f8 = e14.xAxes.push(o5.new(m6, { renderer: s11.new(m6, { inversed: L2(this.container) }), categoryField: w3 }));
    f8.get("renderer").labels.template.setAll({ forceHidden: true });
    const g8 = e14.yAxes.push(n13.new(m6, { renderer: l5.new(m6, { inside: false }), min: this._getMinSeriesValue(p10.series) }));
    g8.get("renderer").labels.template.setAll({ direction: this._getDirection() });
    const _5 = "{categoryX}", M5 = i11[0]?.lineSettings?.stroke, I6 = r6.new(m6, { getFillFromSprite: !M5, labelText: _5 });
    M5 && I6.get("background")?.setAll({ fill: M5 });
    const C4 = e14.series.push(d10.new(m6, { name: u8, xAxis: f8, yAxis: g8, valueYField: A4, categoryXField: w3, tooltip: I6 }));
    C4.strokes.template.setAll({ templateField: "lineSettings" }), this._customizeChartTooltip(I6, "vertical"), p10.series.length > v5 && e14.set("scrollbarX", a6.new(m6, { orientation: "horizontal" })), f8.data.setAll(i11), C4.data.setAll(i11), C4.appear(this._getChartSeriesAnimationMS()), e14.appear(this._getChartAnimationMS());
  }
  async _createXYChart(e14, t4) {
    const { XYChartAm5: i11, XYCursorAm5: r6 } = await import("./xyChart-7IY4CDZS.js"), { root: a6, mediaInfo: o5 } = e14, { type: s11 } = o5, n13 = o5?.altText || o5?.title || "", l5 = a6.container.children.push(i11.new(a6, { ariaLabel: n13, focusable: true, panX: true, panY: true }));
    l5.set("cursor", r6.new(a6, {})), "column-chart" === s11 && await this._createColumnChart(l5, e14, t4), "bar-chart" === s11 && await this._createBarChart(l5, e14, t4), "line-chart" === s11 && await this._createLineChart(l5, e14, t4), l5.root.dom.classList.toggle(M3.mediaChartRendered, true);
  }
  _clearMediaRefreshTimer() {
    const { _refreshTimer: e14 } = this;
    e14 && (clearTimeout(e14), this._refreshTimer = null);
  }
  _updateMediaInfoTimestamp(e14) {
    const t4 = Date.now();
    this._refreshIntervalInfo = { timestamp: t4, sourceURL: e14 && this._getImageSource(e14, t4) };
  }
  _setupMediaRefreshTimer() {
    this._clearMediaRefreshTimer();
    const { activeMediaInfo: e14 } = this.viewModel;
    "image" === e14?.type && e14?.refreshInterval > 0 && this._setRefreshTimeout(e14);
  }
  _setRefreshTimeout(e14) {
    const { refreshInterval: t4, value: i11 } = e14, r6 = 6e4 * t4;
    this._updateMediaInfoTimestamp(i11.sourceURL);
    const a6 = setInterval(() => {
      this._updateMediaInfoTimestamp(i11.sourceURL);
    }, r6);
    this._refreshTimer = a6;
  }
  _getImageSource(e14, t4) {
    const i11 = e14.includes("?") ? "&" : "?", [r6, a6 = ""] = e14.split("#");
    return `${r6}${i11}timestamp=${t4}${a6 ? "#" : ""}${a6}`;
  }
};
r([m()], T3.prototype, "_refreshIntervalInfo", void 0), r([m()], T3.prototype, "attributes", null), r([m()], T3.prototype, "activeMediaInfoIndex", null), r([m()], T3.prototype, "description", null), r([m()], T3.prototype, "fieldInfoMap", null), r([m()], T3.prototype, "layer", null), r([m()], T3.prototype, "mediaInfos", null), r([m()], T3.prototype, "popupTemplate", null), r([m()], T3.prototype, "relatedInfos", null), r([m()], T3.prototype, "title", null), r([m({ type: v4 })], T3.prototype, "viewModel", void 0), r([m(), e3("esri/widgets/Feature/t9n/Feature")], T3.prototype, "messages", void 0), T3 = r([a("esri.widgets.Feature.FeatureMedia")], T3);

// node_modules/@arcgis/core/core/throttle.js
function e9(e14, t4, l5, n13) {
  let o5 = null, p10 = 1e3;
  "number" == typeof t4 ? (p10 = t4, n13 = l5) : (o5 = t4 ?? null, p10 = l5);
  let r6, u8 = 0;
  const a6 = () => {
    u8 = 0, e14.apply(n13, r6);
  }, c12 = (...e15) => {
    o5 && o5.apply(n13, e15), r6 = e15, p10 ? u8 || (u8 = setTimeout(a6, p10)) : a6();
  };
  return c12.remove = () => {
    u8 && (clearTimeout(u8), u8 = 0);
  }, c12.forceUpdate = () => {
    u8 && (clearTimeout(u8), a6());
  }, c12.hasPendingUpdates = () => !!u8, c12;
}

// node_modules/@arcgis/core/widgets/Feature/support/arcadeFeatureUtils.js
var o4 = "esri.widgets.Feature.support.arcadeFeatureUtils";
var i8 = () => i2.getLogger(o4);
function c10(e14) {
  return "string" == typeof e14 ? le(ae(e14)) : Array.isArray(e14) ? p9(e14) : "esri.arcade.Dictionary" === e14?.declaredClass ? u4(e14) : e14;
}
function p9(e14) {
  return `<ul class="esri-widget__list">${e14.map((e15) => `<li>${"string" == typeof e15 ? le(ae(e15)) : e15}</li>`).join("")}</ul>`;
}
function u4(e14) {
  const r6 = e14.keys().map((r7) => {
    const t4 = e14.field(r7);
    return `<tr><th>${r7}</th><td>${"string" == typeof t4 ? le(ae(t4)) : t4}</td></tr>`;
  }).join("");
  return `<table class="${e4.table}">${r6}</table>`;
}
async function l4() {
  const [e14, r6] = await Promise.all([import("./arcade-BK5TQQFO.js"), import("./arcade-UVP6FUPC.js")]);
  return { executor: e14, syntaxUtils: r6 };
}
function d8(e14) {
  return "createQuery" in e14 && "queryFeatures" in e14;
}
async function y6({ graphic: e14, view: r6, options: t4 }) {
  const { isAggregate: a6 } = e14, n13 = e14.layer ?? e14.sourceLayer;
  if (!a6 || !n13 || "2d" !== r6?.type) return [];
  const s11 = await r6.whenLayerView(n13);
  if (!d8(s11)) return [];
  const o5 = s11.createQuery(), i11 = e14.getObjectId();
  o5.aggregateIds = null != i11 ? [i11] : [];
  const { features: c12 } = await s11.queryFeatures(o5, t4);
  return c12;
}
function f4({ layer: e14, aggregatedFeatures: r6, interceptor: a6 }) {
  const { fields: n13, objectIdField: s11, geometryType: o5, spatialReference: i11, displayField: c12 } = e14;
  return new Xe({ fields: n13, objectIdField: s11, geometryType: o5, spatialReference: i11, displayField: c12, interceptor: a6, ..."feature" === e14.type ? { templates: e14.templates, typeIdField: e14.typeIdField, types: e14.types } : null, source: r6 });
}
function g2(e14) {
  const r6 = "esri.views.3d.layers.VoxelGraphic" === e14.declaredClass;
  return e14.isAggregate ? "popup-feature-reduction" : r6 ? "popup-voxel" : "popup";
}
function w4(e14) {
  return { scale: e14?.scale, timeProperties: { currentStart: e14?.timeExtent?.start, currentEnd: e14?.timeExtent?.end, startIncluded: true, endIncluded: true } };
}
function m4(e14) {
  return { $voxel: e14 };
}
async function x5(e14, r6, t4, a6, n13) {
  let s11 = null;
  if (n13.has("$aggregatedfeatures")) {
    const n14 = await y6({ graphic: e14, view: r6, options: t4 }), o5 = e14.sourceLayer || e14.layer;
    s11 = f4({ layer: o5, aggregatedFeatures: n14, interceptor: a6 });
  }
  return { vars: { $feature: e14, $aggregatedFeatures: s11, $view: w4(r6) }, [Symbol.dispose]: () => s11?.[Symbol.dispose]() };
}
function v6(r6, t4, a6, n13) {
  const s11 = (r6.sourceLayer || r6.layer) ?? void 0;
  return { $feature: r6, $layer: null != s11 && x(s11) ? s11 : "scene" === s11?.type && null != s11.associatedLayer ? s11.associatedLayer : void 0, $map: t4, $datastore: s11?.url, $userInput: a6, $graph: "knowledge-graph-sublayer" === s11?.type ? s11?.parentCompositeLayer?.knowledgeGraph : void 0, $view: w4(n13) };
}
async function h6(e14, { graphic: r6, map: t4, location: a6, view: n13, options: s11, interceptor: o5, arcadeExecutor: i11 }) {
  switch (e14) {
    case "popup":
      return { vars: v6(r6, t4, a6, n13), [Symbol.dispose]() {
      } };
    case "popup-feature-reduction": {
      const e15 = new Set(i11.variablesUsed);
      return await x5(r6, n13, s11, o5, e15);
    }
    case "popup-voxel":
      return { vars: m4(r6), [Symbol.dispose]() {
      } };
    default:
      throw new Error(`Unexpected profile name ${e14}`);
  }
}
async function $2({ expressionInfo: e14, arcade: { executor: r6, syntaxUtils: t4 }, graphic: a6 }) {
  const n13 = e14?.expression;
  if (!n13) return null;
  const s11 = g2(a6), o5 = r6.createArcadeProfile(s11);
  let c12;
  try {
    c12 = await r6.createArcadeExecutor(n13, o5);
  } catch (u8) {
    return i8().error("arcade-executor-error", { error: u8, expressionInfo: e14 }), null;
  }
  const p10 = /* @__PURE__ */ new Set();
  return c12.variablesUsed.includes("$view") && (t4.scriptUsesViewProperties(c12.syntaxTree, ["scale"]) && p10.add("view-scale"), t4.scriptUsesViewProperties(c12.syntaxTree, ["timeProperties"]) && p10.add("view-time-extent")), { dependencies: p10, async evaluate({ graphic: r7, interceptor: t5, location: a7, map: n14, options: o6, spatialReference: p11, view: l5 }) {
    const d10 = await h6(s11, { graphic: r7, map: n14, location: a7, view: l5, options: o6, interceptor: t5, arcadeExecutor: c12 }), y10 = { abortSignal: o6?.signal ?? void 0, interceptor: t5 ?? void 0, rawOutput: true, spatialReference: p11 ?? void 0, timeZone: l5?.timeZone, console(...e15) {
      i8().info(...e15);
    } };
    try {
      return await c12.executeAsync(d10.vars, y10);
    } catch (u8) {
      if (o6?.signal?.aborted) return;
      return void i8().error("arcade-execution-error", { error: u8, graphic: r7, expressionInfo: e14 });
    } finally {
      d10[Symbol.dispose]();
    }
  } };
}
async function b5(e14, r6) {
  if (!e14?.length) return { dependencies: /* @__PURE__ */ new Set(), expressions: /* @__PURE__ */ new Map() };
  const t4 = await l4(), a6 = /* @__PURE__ */ new Set(), n13 = /* @__PURE__ */ new Map();
  for (const s11 of e14) {
    const e15 = await $2({ expressionInfo: s11, arcade: t4, graphic: r6 });
    n13.set(`expression/${s11.name}`, e15), e15?.dependencies.forEach((e16) => a6.add(e16));
  }
  return { dependencies: a6, expressions: n13 };
}

// node_modules/@arcgis/core/widgets/Feature/FeatureExpression/FeatureExpressionViewModel.js
var k3 = 1;
var g3 = class extends b2 {
  constructor(t4) {
    super(t4), this._compileTask = null, this._evaluateTask = null, this.expressionInfo = null, this.graphic = null, this.contentElementViewModel = null, this.interceptor = null, this.location = null, this.view = null, this._createVM = () => {
      const t5 = this.contentElement?.type;
      this.contentElementViewModel?.destroy();
      const e14 = "fields" === t5 ? new l3() : "media" === t5 ? new v4() : "text" === t5 ? new c7() : null;
      this._set("contentElementViewModel", e14);
    }, this._compileThrottled = e9(this._startCompile, () => this.notifyChange("state"), k3, this), this._evaluateThrottled = e9(this._startEvaluate, () => this.notifyChange("state"), k3, this), this.addHandles([l(() => [this.expressionInfo, this.graphic], () => this._compileThrottled(), h2), l(() => [this.contentElement], () => this._createVM(), h2), f(() => {
      if (!this._compileTask?.finished) return null;
      const t5 = this._compileTask.value, e14 = t5?.dependencies;
      return [t5, this.spatialReference, this.map, this.view, e14?.has("view-scale") ? this.view?.scale : null, e14?.has("view-time-extent") ? this.view?.timeExtent?.start : null, e14?.has("view-time-extent") ? this.view?.timeExtent?.end : null];
    }, ([t5]) => this._evaluateThrottled(t5))]);
  }
  initialize() {
    this.addHandles([this._compileThrottled, this._evaluateThrottled]);
  }
  destroy() {
    this._compileTask = e(this._compileTask), this._evaluateTask = e(this._evaluateTask), this.contentElementViewModel?.destroy(), this._set("contentElementViewModel", null);
  }
  get contentElement() {
    return this._evaluateTask?.value;
  }
  get spatialReference() {
    return this.view?.spatialReference ?? null;
  }
  set spatialReference(t4) {
    this._override("spatialReference", t4);
  }
  get state() {
    const { contentElement: t4, contentElementViewModel: e14 } = this;
    return this._compileThrottled.hasPendingUpdates() || this._evaluateThrottled.hasPendingUpdates() || !this._compileTask?.finished || !this._evaluateTask?.finished ? "loading" : t4 || e14 ? "ready" : "disabled";
  }
  get map() {
    return this.view?.map ?? null;
  }
  set map(t4) {
    this._override("map", t4);
  }
  _startCompile() {
    this._evaluateTask = e(this._evaluateTask), this._compileTask = e(this._compileTask), this._compileTask = d2(async (t4) => {
      const { expressionInfo: e14, graphic: o5 } = this;
      if (!e14 || !o5) return null;
      const s11 = await l4();
      s2(t4);
      const i11 = await $2({ expressionInfo: e14, arcade: s11, graphic: o5 });
      return s2(t4), i11;
    });
  }
  _startEvaluate(t4) {
    this._evaluateTask = e(this._evaluateTask), this._evaluateTask = d2(async (e14) => {
      const { graphic: o5 } = this;
      if (!t4 || !o5) return null;
      const { interceptor: s11, spatialReference: i11, map: r6, location: a6, view: l5 } = this, p10 = await t4.evaluate({ graphic: o5, interceptor: s11, location: a6, map: r6, options: { signal: e14 }, spatialReference: i11, view: l5 });
      s2(e14);
      const c12 = p10;
      if (!c12 || "esri.arcade.Dictionary" !== c12.declaredClass) return null;
      const m6 = await c12.castAsJsonAsync(e14);
      s2(e14);
      const h8 = m6?.type, v8 = "media" === h8 ? I.fromJSON(m6) : "text" === h8 ? c4.fromJSON(m6) : "fields" === h8 ? d3.fromJSON(m6) : null;
      return "media" === v8.type && !v8.mediaInfos || "fields" === v8.type && !v8.fieldInfos || "text" === v8.type && !v8.text ? null : v8;
    });
  }
};
r([m()], g3.prototype, "_compileTask", void 0), r([m()], g3.prototype, "_evaluateTask", void 0), r([m({ type: i3 })], g3.prototype, "expressionInfo", void 0), r([m({ type: d4 })], g3.prototype, "graphic", void 0), r([m({ readOnly: true })], g3.prototype, "contentElement", null), r([m({ readOnly: true })], g3.prototype, "contentElementViewModel", void 0), r([m()], g3.prototype, "interceptor", void 0), r([m({ type: _2 })], g3.prototype, "location", void 0), r([m()], g3.prototype, "spatialReference", null), r([m({ readOnly: true })], g3.prototype, "state", null), r([m()], g3.prototype, "map", null), r([m()], g3.prototype, "view", void 0), g3 = r([a("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")], g3);

// node_modules/@arcgis/core/widgets/Feature/FeatureExpression.js
var m5 = "esri-feature";
var u5 = { base: `${m5}-expression`, loadingSpinnerContainer: `${m5}__loading-container` };
var g4 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._contentWidget = null, this.viewModel = new g3();
  }
  initialize() {
    this.addHandles(l(() => this.viewModel?.contentElementViewModel, () => this._setupExpressionWidget(), h2));
  }
  loadDependencies() {
    return c3({ loader: () => import("./calcite-loader-QHY6QNRQ.js") });
  }
  destroy() {
    this._destroyContentWidget();
  }
  render() {
    const { state: e14 } = this.viewModel;
    return n("div", { class: u5.base }, "loading" === e14 ? this._renderLoading() : "disabled" === e14 ? null : this._contentWidget?.render());
  }
  _renderLoading() {
    return n("div", { class: u5.loadingSpinnerContainer, key: "loading-container" }, n("calcite-loader", { inline: true, label: "" }));
  }
  _destroyContentWidget() {
    const { _contentWidget: e14 } = this;
    e14 && (e14.viewModel = null, e14.destroy()), this._contentWidget = null;
  }
  _setupExpressionWidget() {
    const { contentElementViewModel: e14, contentElement: t4 } = this.viewModel, o5 = t4?.type;
    this._destroyContentWidget();
    const i11 = e14 ? "fields" === o5 ? new c9({ viewModel: e14 }) : "media" === o5 ? new T3({ viewModel: e14 }) : "text" === o5 ? new l2({ viewModel: e14 }) : null : null;
    this._contentWidget = i11, this.scheduleRender();
  }
};
r([m({ type: g3 })], g4.prototype, "viewModel", void 0), g4 = r([a("esri.widgets.Feature.FeatureExpression")], g4);

// node_modules/@arcgis/core/widgets/support/forms/formUtils.js
var i10;
var u7;
!function(t4) {
  t4.Text = "text", t4.Number = "number", t4.Date = "date", t4.Unsupported = "unsupported";
}(i10 || (i10 = {})), function(t4) {
  t4.CANNOT_BE_EMPTY = "input-validation-error::cannot-be-empty", t4.TOO_SHORT = "length-validation-error::too-short", t4.TOO_LONG = "length-validation-error::too-long";
}(u7 || (u7 = {}));

// node_modules/@arcgis/core/widgets/FeatureForm/featureFormUtils.js
var J2 = (e14) => {
  const t4 = [];
  if (e14.formTemplate) {
    const { description: r6, title: n13 } = e14.formTemplate;
    e14.fields?.forEach((e15) => {
      const i11 = n13 && i(n13, e15.name), s11 = r6 && i(r6, e15.name);
      (i11 || s11) && t4.push(e15.name);
    });
  }
  return t4;
};

// node_modules/@arcgis/core/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel.js
var F6 = 100;
var _4 = class extends a2.ClonableMixin(n3.IdentifiableMixin(b2)) {
  constructor(e14) {
    super(e14), this._loaded = false, this._queryAbortController = null, this._queryPageAbortController = null, this._queryFeatureCountAbortController = null, this.featuresPerPage = 10, this.activeCategory = null, this.allCategories = null, this.description = null, this.graphic = null, this.layer = null, this.map = null, this.orderByFields = null, this.featureCount = 0, this.relationshipId = null, this.showAllEnabled = false, this.title = null, this._cancelQuery = () => {
      const { _queryAbortController: e15 } = this;
      e15 && e15.abort(), this._queryAbortController = null;
    }, this._cancelQueryFeatureCount = () => {
      const { _queryFeatureCountAbortController: e15 } = this;
      e15 && e15.abort(), this._queryFeatureCountAbortController = null;
    }, this._cancelQueryPage = () => {
      const { _queryPageAbortController: e15 } = this;
      e15 && e15.abort(), this._queryPageAbortController = null;
    }, this._queryController = async () => {
      this._cancelQuery();
      const e15 = new AbortController();
      this._queryAbortController = e15, await d(this._query()), this._queryAbortController === e15 && (this._queryAbortController = null);
    }, this._queryFeatureCountController = async () => {
      this._loaded = false, this._cancelQueryFeatureCount();
      const e15 = new AbortController();
      this._queryFeatureCountAbortController = e15, await d(this._queryFeatureCount()), this._queryFeatureCountAbortController === e15 && (this._queryFeatureCountAbortController = null), this._loaded = true;
    }, this._queryPageController = async () => {
      const e15 = new AbortController();
      this._queryPageAbortController = e15, await d(this._queryPage()), this._queryPageAbortController === e15 && (this._queryPageAbortController = null);
    }, this._queryDebounced = k(this._queryController, F6), this._queryFeatureCountDebounced = k(this._queryFeatureCountController, F6), this._queryPageDebounced = k(this._queryPageController, F6), this._query = async () => {
      const { _queryAbortController: e15, relatedFeatures: t4 } = this;
      this.featureCount && ("subtype-group" !== this.relatedLayer?.type || this.activeCategory) && (this._destroyRelatedFeatureViewModels(), this.featurePage = 1, t4.destroyAll(), this.destroyed || t4.addMany(this._sliceFeatures(await this._queryRelatedFeatures({ signal: e15?.signal }))));
    }, this.addHandles([l(() => [this.displayCount, this.graphic, this.layer, this.layer?.loaded, this.map, this.orderByFields, this.relationshipId, this.featuresPerPage, this.showAllEnabled, this.canQuery, this.featureCount, this.activeCategory], () => this._queryDebounced(), h2), l(() => [this.featurePage, this.showAllEnabled], () => this._queryPageDebounced()), l(() => [this.layer, this.relationshipId, this.objectId, this.canQuery, this.activeCategory], () => this._queryFeatureCountDebounced())]);
  }
  destroy() {
    this._destroyRelatedFeatureViewModels(), this.relatedFeatures.destroyAll(), this._cancelQuery(), this._cancelQueryFeatureCount(), this._cancelQueryPage();
  }
  set featurePage(e14) {
    const { featuresPerPage: t4, featureCount: r6 } = this, o5 = 1, l5 = Math.ceil(r6 / t4) || 1;
    this._set("featurePage", Math.min(Math.max(e14, o5), l5));
  }
  get featurePage() {
    return this._get("featurePage");
  }
  get orderByFieldsFixedCasing() {
    const { orderByFields: e14, relatedLayer: t4 } = this;
    return e14 && t4?.loaded ? e14.map((e15) => {
      const r6 = e15.clone();
      return r6.field = M(e15.field, t4), r6;
    }) : e14 ?? [];
  }
  get supportsCacheHint() {
    return !!this.layer?.capabilities?.queryRelated?.supportsCacheHint;
  }
  get canLoad() {
    return !!this.map && null != this.relationshipId && "number" == typeof this.objectId;
  }
  get canQuery() {
    const e14 = this.layer?.capabilities?.queryRelated;
    return !!(this.relatedLayer && this.relationship && null != this.relationshipId && null != this.objectId && e14?.supportsCount && e14?.supportsPagination);
  }
  get allCategoriesCount() {
    return this.allCategories?.length ?? 0;
  }
  get categories() {
    const { allCategories: e14 } = this;
    return this.showAllEnabled ? e14 : e14?.slice(0, this.displayCount) ?? null;
  }
  set displayCount(e14) {
    const t4 = 0, r6 = 10, o5 = 3;
    this._set("displayCount", Math.min(Math.max(e14 ?? o5, t4), r6));
  }
  get displayCount() {
    return this._get("displayCount");
  }
  get itemDescriptionFieldName() {
    return this.orderByFieldsFixedCasing[0]?.field || null;
  }
  get objectId() {
    return (this.objectIdField && this.graphic?.attributes?.[this.objectIdField]) ?? null;
  }
  get objectIdField() {
    return this.layer?.objectIdField || null;
  }
  get relatedFeatures() {
    return this._get("relatedFeatures") || new V();
  }
  get relatedLayer() {
    const { layer: e14, map: t4, relationship: r6 } = this;
    if (!e14?.loaded || !t4 || !r6) return null;
    const o5 = "subtype-sublayer" === e14.type && e14.parent && J(e14.parent) ? e14.parent : e14;
    return Te(t4, o5, r6) ?? null;
  }
  get relatedLayerKeyField() {
    const { relatedLayer: e14, relationshipId: t4 } = this;
    return e14?.loaded && null != t4 ? e14.relationships?.find((e15) => e15.id === t4)?.keyField : null;
  }
  get relatedLayerKeyFields() {
    const { relatedLayer: e14 } = this;
    return e14?.loaded ? e14.relationships?.map((e15) => e15.keyField).filter(L) ?? [] : [];
  }
  get relationship() {
    const { relationshipId: e14, layer: t4 } = this;
    return null != e14 && t4?.loaded ? t4.relationships?.find(({ id: t5 }) => t5 === e14) ?? null : null;
  }
  get relationshipKey() {
    const { relationshipKeyField: e14 } = this;
    return (e14 && this.graphic?.attributes?.[e14]) ?? null;
  }
  get relationshipKeyField() {
    return this.relationship?.keyField || null;
  }
  get relatedFeatureViewModels() {
    return this._get("relatedFeatureViewModels") || new V();
  }
  get state() {
    const { _queryAbortController: e14, _queryFeatureCountAbortController: t4, _queryPageAbortController: r6, canQuery: o5, _loaded: l5, canLoad: a6 } = this;
    return t4 || a6 && !l5 ? "loading" : e14 || r6 ? "querying" : o5 ? "ready" : "disabled";
  }
  getRelatedFeatureByObjectId(e14) {
    return this.relatedFeatures.find((t4) => t4.getObjectId() === e14);
  }
  refresh() {
    this._queryFeatureCountDebounced();
  }
  _destroyRelatedFeatureViewModels() {
    this.relatedFeatureViewModels?.destroyAll();
  }
  async _queryFeatureCount() {
    const { layer: e14, relatedLayer: t4 } = this;
    await e14?.load(), await t4?.load();
    const { _queryFeatureCountAbortController: r6, activeCategory: l5, canQuery: a6, objectId: i11, relatedLayerKeyField: s11, relationshipId: n13, relationshipKey: u8, supportsCacheHint: d10 } = this;
    if (!a6 || !e14 || !t4 || null == i11) return this._set("featureCount", 0), void this._set("allCategories", null);
    if ("subtype-group" === t4?.type && !l5) {
      if (this._set("featureCount", 0), this._destroyRelatedFeatureViewModels(), this.featurePage = 1, this.relatedFeatures.destroyAll(), s11 && null != u8) {
        const { default: e15 } = await import("./uniqueValues-SKGVIYWN.js"), { uniqueValueInfos: l6 } = await e15({ layer: t4, sqlWhere: `${s11} = '${u8}'`, field: t4.subtypeField, signal: r6?.signal }), a7 = l6.map(({ count: e16, value: r7 }) => {
          const o5 = t4.subtypes?.find((e17) => e17.code === r7)?.name;
          return null != r7 && o5 ? { count: e16, value: r7, name: o5 } : void 0;
        }).filter(L);
        this._set("allCategories", a7);
      }
      return;
    }
    const { historicMoment: y10, gdbVersion: h8 } = e14, c12 = new c5({ cacheHint: d10, gdbVersion: h8, historicMoment: y10, relationshipId: n13, returnGeometry: false, objectIds: [i11], where: this._getRelationshipWhereClause(t4) }), g8 = await e14.queryRelatedFeaturesCount(c12, { signal: r6?.signal });
    this._set("allCategories", null), this._set("featureCount", g8[i11] || 0);
  }
  _getRelationshipWhereClause(e14) {
    const { activeCategory: t4 } = this, r6 = e14.createQuery(), o5 = "subtypeField" in e14 ? e14.subtypeField : void 0, l5 = t4 && o5 ? `${o5} = ${t4.value}` : void 0, a6 = r6.where;
    return a6 && l5 ? `(${a6}) AND (${l5})` : a6 ?? l5;
  }
  _sliceFeatures(e14) {
    const { showAllEnabled: t4, displayCount: r6 } = this;
    return t4 ? e14 : r6 ? e14.slice(0, r6) : [];
  }
  async _queryPage() {
    const { relatedFeatures: e14, featurePage: t4, showAllEnabled: r6, _queryPageAbortController: o5, featureCount: l5 } = this;
    !r6 || t4 < 2 || !l5 || "subtype-group" === this.relatedLayer?.type && !this.activeCategory || e14.addMany(await this._queryRelatedFeatures({ signal: o5?.signal }));
  }
  async _queryRelatedFeatures(e14) {
    const { displayCount: t4, featureCount: r6, featurePage: o5, featuresPerPage: l5, layer: a6, orderByFieldsFixedCasing: i11, relatedLayer: s11, relatedLayerKeyFields: n13, relationshipId: u8, showAllEnabled: d10, supportsCacheHint: y10 } = this, { canQuery: h8, objectId: c12 } = this;
    if (!h8 || !a6 || !s11 || null == c12) return [];
    const g8 = d10 ? ((o5 - 1) * l5 + r6) % r6 : 0, C4 = d10 ? l5 : t4, F9 = s11.objectIdField, _5 = "subtypeField" in s11 ? s11.subtypeField : void 0, m6 = [...i11.map((e15) => e15.field), ...J2(s11), ...n13, F9, _5].filter(f6), q3 = i11.map((e15) => `${e15.field} ${e15.order}`), { historicMoment: A5, gdbVersion: w5 } = a6, P = new c5({ orderByFields: q3, start: g8, num: C4, outFields: m6, cacheHint: y10, historicMoment: A5, gdbVersion: w5, relationshipId: u8, returnGeometry: false, objectIds: [c12], where: this._getRelationshipWhereClause(s11) }), v8 = await a6.queryRelatedFeatures(P, { signal: e14?.signal }), j3 = v8[c12]?.features || [];
    return "subtype-group" === s11.type && _5 ? j3.forEach((e15) => {
      const t5 = e15.attributes[_5], r7 = s11.findSublayerForSubtypeCode?.(t5);
      e15.sourceLayer = r7, e15.layer = r7;
    }) : j3.forEach((e15) => {
      e15.sourceLayer = s11, e15.layer = s11;
    }), j3;
  }
};
function f6(e14) {
  return null != e14 && "" !== e14;
}
r([m()], _4.prototype, "_loaded", void 0), r([m()], _4.prototype, "_queryAbortController", void 0), r([m()], _4.prototype, "_queryPageAbortController", void 0), r([m()], _4.prototype, "_queryFeatureCountAbortController", void 0), r([m({ value: 1 })], _4.prototype, "featurePage", null), r([m()], _4.prototype, "featuresPerPage", void 0), r([m({ readOnly: true })], _4.prototype, "orderByFieldsFixedCasing", null), r([m({ readOnly: true })], _4.prototype, "supportsCacheHint", null), r([m({ readOnly: true })], _4.prototype, "canLoad", null), r([m({ readOnly: true })], _4.prototype, "canQuery", null), r([m()], _4.prototype, "activeCategory", void 0), r([m({ readOnly: true })], _4.prototype, "allCategories", void 0), r([m({ readOnly: true })], _4.prototype, "allCategoriesCount", null), r([m({ readOnly: true })], _4.prototype, "categories", null), r([m()], _4.prototype, "description", void 0), r([m({ value: 3 })], _4.prototype, "displayCount", null), r([m({ type: d4 })], _4.prototype, "graphic", void 0), r([m({ readOnly: true })], _4.prototype, "itemDescriptionFieldName", null), r([m()], _4.prototype, "layer", void 0), r([m()], _4.prototype, "map", void 0), r([m({ readOnly: true })], _4.prototype, "objectId", null), r([m({ readOnly: true })], _4.prototype, "objectIdField", null), r([m()], _4.prototype, "orderByFields", void 0), r([m({ readOnly: true })], _4.prototype, "relatedFeatures", null), r([m({ readOnly: true })], _4.prototype, "relatedLayer", null), r([m({ readOnly: true })], _4.prototype, "relatedLayerKeyField", null), r([m({ readOnly: true })], _4.prototype, "relatedLayerKeyFields", null), r([m({ readOnly: true })], _4.prototype, "relationship", null), r([m({ readOnly: true })], _4.prototype, "relationshipKey", null), r([m({ readOnly: true })], _4.prototype, "relationshipKeyField", null), r([m({ readOnly: true })], _4.prototype, "featureCount", void 0), r([m({ readOnly: true })], _4.prototype, "relatedFeatureViewModels", null), r([m()], _4.prototype, "relationshipId", void 0), r([m()], _4.prototype, "showAllEnabled", void 0), r([m()], _4.prototype, "state", null), r([m()], _4.prototype, "title", void 0), _4 = r([a("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")], _4);

// node_modules/@arcgis/core/widgets/Feature/FeatureRelationship.js
var b7;
var y8 = "esri-feature";
var I5 = `${y8}-relationship`;
var F7 = { base: I5, listContainer: `${I5}__list`, listItem: `${I5}__list-item`, listItemHidden: `${I5}__list-item--hidden`, listContainerQuerying: `${I5}__list--querying`, featureObserver: `${y8}__feature-observer`, stickySpinnerContainer: `${y8}__sticky-loading-container`, loadingSpinnerContainer: `${y8}__loading-container` };
var C3 = { title: true, description: true };
var M4 = b7 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._featureElementInfo = null, this._relatedFeatureIntersectionObserverNode = null, this._relatedFeatureIntersectionObserver = new IntersectionObserver(([e15]) => {
      e15?.isIntersecting && this._increaseFeaturePage();
    }, { root: window.document }), this.flowItems = null, this.flowType = "feature-relationship", this.headingLevel = 2, this.viewModel = new _4(), this.messages = null, this.messagesCommon = null, this.visibleElements = { ...C3 }, this._increaseFeaturePage = () => {
      const { state: e15, showAllEnabled: t5, relatedFeatures: s11, featuresPerPage: i11, featurePage: r6 } = this.viewModel;
      "ready" === e15 && t5 && s11.length >= i11 * r6 && this.viewModel.featurePage++;
    };
  }
  initialize() {
    this._featureElementInfo = new c6(), this.addHandles([l(() => [this.viewModel.description, this.viewModel.title, this.headingLevel], () => this._setupFeatureElementInfo(), h2), l(() => [this.viewModel.state, this.viewModel.showAllEnabled, this._relatedFeatureIntersectionObserverNode], () => this._handleRelatedFeatureObserverChange()), a3(() => this.viewModel.relatedFeatureViewModels, "change", () => this._setupRelatedFeatureViewModels())]);
  }
  loadDependencies() {
    return c3({ chip: () => import("./calcite-chip-WULQ3PZX.js"), icon: () => import("./calcite-icon-5R57LYRD.js"), list: () => import("./calcite-list-MQ3JC2MC.js"), "list-item": () => import("./calcite-list-item-MPXXGGGF.js"), loader: () => import("./calcite-loader-QHY6QNRQ.js"), notice: () => import("./calcite-notice-2INJGHRM.js") });
  }
  destroy() {
    this._unobserveRelatedFeatureObserver(), this._featureElementInfo = u(this._featureElementInfo);
  }
  get displayShowAllButton() {
    const { showAllEnabled: e14, featureCount: t4, displayCount: s11, state: i11, allCategoriesCount: r6 } = this.viewModel;
    return !e14 && "ready" === i11 && (!!r6 && (r6 > s11 || 0 === s11) || !!t4 && (t4 > s11 || 0 === s11));
  }
  get displayListItems() {
    const { relatedFeatureViewModels: e14, allCategoriesCount: t4 } = this.viewModel;
    return this.displayShowAllButton || !!e14.length || !!t4;
  }
  get allItemsDescription() {
    const { messages: e14 } = this, { featureCount: t4, allCategories: s11, allCategoriesCount: i11 } = this.viewModel;
    return s4(e14?.numberRecords, { number: o(s11 ? i11 : t4) });
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e14) {
    this.viewModel.description = e14;
  }
  get title() {
    const { activeCategory: e14, title: t4 } = this.viewModel;
    return e14?.name ?? t4;
  }
  set title(e14) {
    this.viewModel.title = e14;
  }
  castVisibleElements(e14) {
    return { ...C3, ...e14 };
  }
  render() {
    const { state: e14 } = this.viewModel;
    return n("div", { class: this.classes(F7.base, e4.widget) }, this._featureElementInfo?.render(), "loading" === e14 ? this._renderLoading() : "disabled" === e14 ? this._renderRelationshipNotFound() : this._renderRelatedFeatures());
  }
  async _selectCategory(e14) {
    const { flowItems: t4, featureVisibleElements: s11, viewModel: i11 } = this;
    t4 && (i11.activeCategory = e14, i11.showAllEnabled = true, t4.push(new b7({ flowItems: t4, featureVisibleElements: s11, visibleElements: { title: false, description: false }, viewModel: i11 })));
  }
  async _selectRecord(e14) {
    const { flowItems: t4, featureVisibleElements: s11 } = this;
    if (!t4) return;
    e14.abilities = { relationshipContent: true };
    const { default: i11 } = await import("./Feature-4OSHNSF6.js");
    t4.push(new i11({ flowItems: t4, flowType: this.flowType, viewModel: e14, visibleElements: s11 }));
  }
  _showAllRecords() {
    const { flowItems: e14 } = this;
    if (!e14) return;
    const { viewModel: t4, featureVisibleElements: s11 } = this;
    t4.showAllEnabled = true;
    const i11 = new b7({ flowItems: e14, featureVisibleElements: s11, visibleElements: { title: false, description: false }, viewModel: t4 });
    e14.push(i11);
  }
  _renderStickyLoading() {
    return "querying" === this.viewModel.state ? n("div", { class: F7.stickySpinnerContainer, key: "sticky-loader" }, this._renderLoadingIcon()) : null;
  }
  _renderLoadingIcon() {
    return n("calcite-loader", { inline: true, label: "" });
  }
  _renderLoading() {
    return n("div", { class: F7.loadingSpinnerContainer, key: "loading-container" }, this._renderLoadingIcon());
  }
  _renderShowAllIconNode() {
    return n("calcite-icon", { icon: "list", scale: "s", slot: "content-end" });
  }
  _renderChevronIconNode() {
    const e14 = L2(this.container) ? "chevron-left" : "chevron-right";
    return n("calcite-icon", { icon: e14, scale: "s", slot: "content-end" });
  }
  _renderCategory(e14) {
    const { count: t4, name: s11, value: i11 } = e14, r6 = o(t4);
    return n("calcite-list-item", { class: F7.listItem, disabled: !t4, key: i11, label: s11, onCalciteListItemSelect: () => this._selectCategory(e14) }, n("calcite-chip", { label: r6, scale: "s", slot: "content-end" }, r6), this._renderChevronIconNode());
  }
  _renderRelatedFeature(e14) {
    const { itemDescriptionFieldName: t4 } = this.viewModel, s11 = e14.title;
    e14.description = t4 && e14.formattedAttributes?.global[t4];
    const i11 = "loading" === e14.state;
    return n("calcite-list-item", { class: this.classes(F7.listItem, { [F7.listItemHidden]: i11 }), description: c2(e14.description ?? ""), key: e14.uid, label: c2(s11), onCalciteListItemSelect: () => this._selectRecord(e14) }, this._renderChevronIconNode());
  }
  _renderShowAllListItem() {
    return this.displayShowAllButton ? n("calcite-list-item", { description: this.allItemsDescription, key: "show-all-item", label: this.messages?.showAll, onCalciteListItemSelect: () => this._showAllRecords() }, this._renderShowAllIconNode()) : null;
  }
  _renderNoRelatedFeaturesMessage() {
    return n("calcite-notice", { icon: "information", key: "no-related-features-message", kind: "brand", open: true, scale: "s", width: "full" }, n("div", { slot: "message" }, this.messages?.noRelatedFeatures));
  }
  _renderFeatureObserver() {
    return n("div", { afterCreate: this._relatedFeatureIntersectionObserverCreated, bind: this, class: F7.featureObserver, key: "feature-observer" });
  }
  _renderList() {
    const { relatedFeatureViewModels: e14, categories: t4 } = this.viewModel;
    return n("calcite-list", { displayMode: "flat", label: this.messages?.relatedFeaturesList }, t4?.map((e15) => this._renderCategory(e15)) ?? e14.toArray().map((e15) => this._renderRelatedFeature(e15)), this._renderShowAllListItem());
  }
  _renderRelatedFeatures() {
    const { displayListItems: e14 } = this, { state: t4 } = this.viewModel;
    return n("div", { class: this.classes(F7.listContainer, { [F7.listContainerQuerying]: "querying" === t4 }), key: "list-container" }, e14 ? this._renderList() : "ready" === t4 ? this._renderNoRelatedFeaturesMessage() : null, this._renderStickyLoading(), this._renderFeatureObserver());
  }
  _renderRelationshipNotFound() {
    return n("calcite-notice", { icon: "exclamation-mark-triangle", key: "relationship-not-found", kind: "danger", open: true, scale: "s", width: "full" }, n("div", { slot: "message" }, this.messages?.relationshipNotFound));
  }
  _setupRelatedFeatureViewModels() {
    const { relatedFeatureViewModels: e14 } = this.viewModel, t4 = "related-feature-viewmodels";
    this.removeHandles(t4), e14?.forEach((e15) => {
      this.addHandles(l(() => [e15.title, e15.state], () => this.scheduleRender(), h2), t4);
    }), this.scheduleRender();
  }
  _setupFeatureElementInfo() {
    const { headingLevel: e14, visibleElements: t4 } = this, s11 = t4.description && this.description, i11 = t4.title && this.title;
    this._featureElementInfo?.set({ description: s11, title: i11, headingLevel: e14 });
  }
  async _handleRelatedFeatureObserverChange() {
    this._unobserveRelatedFeatureObserver();
    const { state: e14, showAllEnabled: t4 } = this.viewModel;
    await A(0), this._relatedFeatureIntersectionObserverNode && "ready" === e14 && t4 && this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode);
  }
  _relatedFeatureIntersectionObserverCreated(e14) {
    this._relatedFeatureIntersectionObserverNode = e14;
  }
  _unobserveRelatedFeatureObserver() {
    this._relatedFeatureIntersectionObserverNode && this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode);
  }
};
r([m()], M4.prototype, "_relatedFeatureIntersectionObserverNode", void 0), r([m({ readOnly: true })], M4.prototype, "displayShowAllButton", null), r([m({ readOnly: true })], M4.prototype, "displayListItems", null), r([m({ readOnly: true })], M4.prototype, "allItemsDescription", null), r([m()], M4.prototype, "description", null), r([m()], M4.prototype, "featureVisibleElements", void 0), r([m()], M4.prototype, "flowItems", void 0), r([m()], M4.prototype, "flowType", void 0), r([m()], M4.prototype, "headingLevel", void 0), r([m()], M4.prototype, "title", null), r([m({ type: _4 })], M4.prototype, "viewModel", void 0), r([m(), e3("esri/widgets/Feature/t9n/Feature")], M4.prototype, "messages", void 0), r([m(), e3("esri/t9n/common")], M4.prototype, "messagesCommon", void 0), r([m()], M4.prototype, "visibleElements", void 0), r([s3("visibleElements")], M4.prototype, "castVisibleElements", null), M4 = b7 = r([a("esri.widgets.Feature.FeatureRelationship")], M4);

// node_modules/@arcgis/core/widgets/Feature/FeatureUtilityNetworkAssociations.js
var y9 = "esri-feature-utility-network-associations";
var g7 = `${y9}__loading-container`;
var f7 = { base: y9, listContainer: `${y9}__list`, loadingContainer: g7, loadingContainerSticky: `${g7}--sticky` };
var v7 = class extends O {
  constructor(e14, t4) {
    super(e14, t4), this._featureElementInfo = null, this.onSelectAssociationType = () => {
    }, this.flowType = "feature-utility-network-associations", this.flowItems = null, this.parentFeatureViewModel = null, this.headingLevel = 5, this.viewModel = new v(), this.messages = null, this.messagesCommon = null, this.visibleElements = new s7();
  }
  initialize() {
    this._featureElementInfo = new c6(), this.addHandles([l(() => [this.viewModel.description, this.viewModel.title, this.headingLevel], () => this._setupFeatureElementInfo(), h2)]);
  }
  loadDependencies() {
    return c3({ icon: () => import("./calcite-icon-5R57LYRD.js"), list: () => import("./calcite-list-MQ3JC2MC.js"), "list-item": () => import("./calcite-list-item-MPXXGGGF.js"), loader: () => import("./calcite-loader-QHY6QNRQ.js"), notice: () => import("./calcite-notice-2INJGHRM.js") });
  }
  destroy() {
    this._featureElementInfo = u(this._featureElementInfo);
  }
  get description() {
    return this.viewModel.description;
  }
  set description(e14) {
    this.viewModel.description = e14;
  }
  get title() {
    return this.viewModel.title;
  }
  set title(e14) {
    this.viewModel.title = e14;
  }
  render() {
    const { state: e14 } = this.viewModel;
    return n("div", { class: this.classes(f7.base, e4.widget) }, this._featureElementInfo?.render(), "loading" === e14 ? this._renderLoading() : "disabled" === e14 ? this._renderAssociationNotFound() : this._renderContent());
  }
  _renderStickyLoading() {
    return "querying" === this.viewModel.state ? n("div", { class: f7.loadingContainerSticky, key: "sticky-loader" }, this._renderLoadingIcon()) : null;
  }
  _renderLoadingIcon() {
    return n("calcite-loader", { inline: true, label: this.messagesCommon.loading });
  }
  _renderLoading() {
    return n("div", { class: f7.loadingContainer, key: "loading-container" }, this._renderLoadingIcon());
  }
  _renderAssociationNotFound() {
    return n("calcite-notice", { icon: "information", key: "association-not-found", kind: "info", open: true, scale: "s", width: "full" }, n("div", { slot: "message" }, this.messages?.noAssociations));
  }
  _renderAssociationType(e14) {
    const { viewModel: t4 } = this, i11 = this._getAssociationTypeTitle(e14);
    return n("calcite-list-item", { description: c2(e14.description), key: `association-type-${e14.type}`, label: c2(i11), value: e14.type, onCalciteListItemSelect: () => this.onSelectAssociationType({ viewModel: t4, listType: e14, title: i11 }) }, n("calcite-icon", { flipRtl: true, icon: "chevron-right", scale: "s", slot: "content-end" }));
  }
  _renderAssociations(e14) {
    const { viewModel: t4 } = this;
    return "featureForm" === t4.source || t4.getFeatureCountForAssociationType(e14.type) > 0 ? this._renderAssociationType(e14) : void 0;
  }
  _renderContent() {
    const { messages: e14, viewModel: t4 } = this, { state: i11, associationTypes: o5 } = t4;
    return n("div", { class: f7.listContainer, key: "list-container" }, "ready" === i11 ? n("div", null, n("calcite-list", { displayMode: "flat", label: e14?.associationsList }, o5.map((e15) => this._renderAssociations(e15)))) : null, this._renderStickyLoading());
  }
  _getAssociationTypeTitle(e14) {
    const { messages: t4 } = this;
    if (e14.title) return e14.title;
    switch (e14.type) {
      case "attachment":
        return t4.associationsAttachments;
      case "connectivity":
        return t4.associationsConnectivity;
      case "structure":
        return t4.associationsStructure;
      case "content":
        return t4.associationsContents;
      case "container":
        return t4.associationsContainer;
    }
  }
  _setupFeatureElementInfo() {
    const { headingLevel: e14, visibleElements: t4 } = this, i11 = t4.description && this.description, o5 = t4.title && this.title;
    this._featureElementInfo?.set({ description: i11, title: o5, headingLevel: e14 });
  }
};
r([m({ constructOnly: true })], v7.prototype, "onSelectAssociationType", void 0), r([m()], v7.prototype, "flowType", void 0), r([m()], v7.prototype, "flowItems", void 0), r([m()], v7.prototype, "parentFeatureViewModel", void 0), r([m()], v7.prototype, "featureVisibleElements", void 0), r([m()], v7.prototype, "description", null), r([m()], v7.prototype, "headingLevel", void 0), r([m()], v7.prototype, "title", null), r([m({ type: v })], v7.prototype, "viewModel", void 0), r([m(), e3("esri/widgets/Feature/t9n/Feature")], v7.prototype, "messages", void 0), r([m(), e3("esri/t9n/common")], v7.prototype, "messagesCommon", void 0), r([m({ type: s7, nonNullable: true })], v7.prototype, "visibleElements", void 0), v7 = r([a("esri.widgets.Feature.FeatureUtilityNetworkAssociations")], v7);

// node_modules/@arcgis/core/arcade/featureset/support/FeatureSetQueryInterceptor.js
var e12 = class {
  constructor(e14, a6) {
    this.preLayerQueryCallback = e14, this.preRequestCallback = a6, this.preLayerQueryCallback || (this.preLayerQueryCallback = (e15) => {
    }), this.preRequestCallback || (this.preLayerQueryCallback = (e15) => {
    });
  }
};

// node_modules/@arcgis/core/widgets/Feature/FeatureViewModel.js
var te;
var ie2 = 1;
var se2 = "content-view-models";
var oe2 = "relationship-view-models";
var re = "association-view-models";
var ae2 = { attachmentsContent: true, chartAnimation: true, customContent: true, expressionContent: true, fieldsContent: true, mediaContent: true, textContent: true, relationshipContent: true, utilityNetworkAssociationsContent: true };
var _a;
var ne2 = (_a = class extends n3.IdentifiableMixin(b2) {
  constructor(e14) {
    super(e14), this._error = null, this._graphicChangedTask = null, this._evaluateExpressionAttributesTask = null, this._associationVMAbortController = null, this._expressionAttributes = null, this._graphicExpressionAttributes = null, this.abilities = { ...ae2 }, this.content = null, this.contentViewModels = [], this.description = null, this.defaultPopupTemplateEnabled = false, this.formattedAttributes = null, this.lastEditInfo = null, this.location = null, this.relatedInfos = /* @__PURE__ */ new Map(), this.title = "", this.view = null, this._graphicChangedThrottled = e9(this._graphicChanged, () => this.notifyChange("waitingForContent"), ie2, this), this._isAllowedContentType = (e15) => {
      const { abilities: t4 } = this;
      return "attachments" === e15.type && !!t4.attachmentsContent || "custom" === e15.type && !!t4.customContent || "fields" === e15.type && !!t4.fieldsContent || "media" === e15.type && !!t4.mediaContent || "text" === e15.type && !!t4.textContent || "expression" === e15.type && !!t4.expressionContent || "relationship" === e15.type && !!t4.relationshipContent || "utility-network-associations" === e15.type && !!t4.utilityNetworkAssociationsContent;
    }, this._evaluateExpressionAttributesThrottled = e9(this._evaluateExpressionAttributes, () => this.notifyChange("waitingForContent"), ie2, this), this.addHandles([l(() => [this.graphic, this._effectivePopupTemplate, this.abilities, this.timeZone], () => this._graphicChangedThrottled(), h2), f(() => {
      if (!this._graphicChangedTask?.finished || null == this._graphicChangedTask.value) return null;
      const e15 = this._graphicChangedTask.value, t4 = e15?.expressionInfos?.dependencies;
      return [e15, t4?.has("view-scale") ? this.view?.scale : null, t4?.has("view-time-extent") ? this.view?.timeExtent?.start : null, t4?.has("view-time-extent") ? this.view?.timeExtent?.end : null];
    }, ([e15]) => this._evaluateExpressionAttributesThrottled(e15))]);
  }
  initialize() {
    this.addHandles([this._graphicChangedThrottled, this._evaluateExpressionAttributesThrottled]);
  }
  destroy() {
    this._clear(), this._graphicChangedTask = e(this._graphicChangedTask), this._evaluateExpressionAttributesTask = e(this._evaluateExpressionAttributesTask), this._error = null, this.graphic = null, this._destroyContentViewModels(), this.relatedInfos.clear();
  }
  get _effectivePopupTemplate() {
    return null != this.graphic ? this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled) : null;
  }
  get _fieldInfoMap() {
    return ie(oe(this._effectivePopupTemplate), this._sourceLayer);
  }
  get _sourceLayer() {
    return L3(this.graphic);
  }
  castAbilities(e14) {
    return { ...ae2, ...e14 };
  }
  get isFeatureFromTable() {
    return this._sourceLayer?.isTable || false;
  }
  get state() {
    return this.graphic ? this._error ? "error" : this.waitingForContent ? "loading" : "ready" : "disabled";
  }
  set graphic(e14) {
    this._set("graphic", e14?.clone() ?? null);
  }
  get spatialReference() {
    return this.view?.spatialReference ?? null;
  }
  set spatialReference(e14) {
    this._override("spatialReference", e14);
  }
  get timeZone() {
    return this.view?.timeZone ?? e2;
  }
  set timeZone(e14) {
    this._overrideIfSome("timeZone", e14);
  }
  get map() {
    return this.view?.map || null;
  }
  set map(e14) {
    this._override("map", e14);
  }
  get waitingForContent() {
    const { _graphicChangedThrottled: e14, _evaluateExpressionAttributesThrottled: t4, _graphicChangedTask: i11, _evaluateExpressionAttributesTask: s11, _associationVMAbortController: o5 } = this;
    return e14.hasPendingUpdates() || t4.hasPendingUpdates() || null != i11 && !i11.finished || null != s11 && !s11.finished || !!o5;
  }
  setActiveMedia(e14, t4) {
    const i11 = this.contentViewModels[e14];
    i11 instanceof v4 && i11.setActiveMedia(t4);
  }
  nextMedia(e14) {
    const t4 = this.contentViewModels[e14];
    t4 instanceof v4 && t4.next();
  }
  previousMedia(e14) {
    const t4 = this.contentViewModels[e14];
    t4 instanceof v4 && t4.previous();
  }
  async updateGeometry() {
    const { graphic: e14, spatialReference: t4, _sourceLayer: i11 } = this;
    await i11?.load();
    const s11 = i11?.objectIdField;
    if (!s11 || !e14 || !i11) return;
    const o5 = e14?.attributes?.[s11];
    if (null == o5) return;
    const r6 = [o5];
    if (!e14.geometry) {
      const s12 = await fe({ layer: i11, graphic: e14, outFields: [], objectIds: r6, returnGeometry: true, spatialReference: t4 }), o6 = s12?.geometry;
      o6 && (e14.geometry = o6);
    }
  }
  _clear() {
    this._set("title", ""), this._set("content", null), this._set("formattedAttributes", null);
  }
  _graphicChanged() {
    this._evaluateExpressionAttributesTask = e(this._evaluateExpressionAttributesTask), this._graphicChangedTask = e(this._graphicChangedTask), this._graphicChangedTask = d2(async (e14) => {
      this._error = null, this._clear();
      const { graphic: t4 } = this;
      try {
        if (!t4) return null;
        const { _sourceLayer: i11, _effectivePopupTemplate: s11 } = this, o5 = this.spatialReference;
        await de({ graphic: t4, popupTemplate: s11, layer: i11, spatialReference: o5 }, { signal: e14 });
        const [{ value: r6 }, { value: a6 }] = await y([this._getContent(), this._getTitle()]), [, { value: n13 }] = await y([this._checkForRelatedFeatures({ signal: e14 }), b5(s11?.expressionInfos, t4)]);
        return { expressionInfos: n13, content: r6, title: a6 };
      } catch (i11) {
        throw b(i11) || (this._error = i11, i2.getLogger(this).error("error", "The popupTemplate could not be displayed for this feature.", { error: i11, graphic: t4, popupTemplate: this._effectivePopupTemplate })), i11;
      }
    });
  }
  _compileContentElement(e14, t4) {
    return "attachments" === e14.type ? this._compileAttachments(e14, t4) : "custom" === e14.type ? this._compileCustom(e14, t4) : "fields" === e14.type ? this._compileFields(e14, t4) : "media" === e14.type ? this._compileMedia(e14, t4) : "text" === e14.type ? this._compileText(e14, t4) : "expression" === e14.type ? this._compileExpression(e14, t4) : "relationship" === e14.type ? this._compileRelationship(e14, t4) : "utility-network-associations" === e14.type ? this._compileUtilityNetworkAssociation(e14, t4) : void 0;
  }
  _compileContent(e14) {
    if (this._destroyContentViewModels(), this.graphic) return Array.isArray(e14) ? e14.filter(this._isAllowedContentType).map((e15, t4) => this._compileContentElement(e15, t4)).filter(L) : "string" == typeof e14 ? this._compileText(new c4({ text: e14 }), 0).text : e14;
  }
  _destroyContentViewModels() {
    this.removeHandles(oe2), this.removeHandles(se2), this.contentViewModels.forEach((e14) => e14 && !e14.destroyed && e14.destroy()), this._set("contentViewModels", []);
  }
  _matchesFeature(e14, t4) {
    const i11 = e14?.graphic?.getObjectId(), s11 = t4?.getObjectId();
    return null != i11 && null != s11 && i11 === s11;
  }
  _setRelatedFeaturesViewModels({ relatedFeatureViewModels: e14, relatedFeatures: t4, map: i11 }) {
    const { view: s11, spatialReference: o5, timeZone: r6 } = this;
    t4?.filter(Boolean).forEach((t5) => {
      e14.some((e15) => this._matchesFeature(e15, t5)) || e14.add(new te({ abilities: { relationshipContent: false }, map: i11, view: s11, spatialReference: o5, timeZone: r6, graphic: t5 }));
    }), e14.forEach((i12) => {
      const s12 = t4?.find((e15) => this._matchesFeature(i12, e15));
      s12 || e14.remove(i12);
    });
  }
  _setExpressionContentVM(e14, t4) {
    const i11 = this.formattedAttributes, { contentElement: s11, contentElementViewModel: o5 } = e14, r6 = s11?.type;
    o5 && r6 && ("fields" === r6 && (this._createFieldsFormattedAttributes({ contentElement: s11, contentElementIndex: t4, formattedAttributes: i11 }), o5.set(this._createFieldsVMParams(s11, t4))), "media" === r6 && (this._createMediaFormattedAttributes({ contentElement: s11, contentElementIndex: t4, formattedAttributes: i11 }), o5.set(this._createMediaVMParams(s11, t4))), "text" === r6 && o5.set(this._createTextVMParams(s11)));
  }
  _compileRelationship(e14, t4) {
    const { displayCount: i11, orderByFields: s11, relationshipId: o5, title: r6, description: a6 } = e14, { _sourceLayer: n13, graphic: l5, map: p10 } = this;
    if (!J(n13)) return;
    const c12 = new _4({ displayCount: i11, graphic: l5, orderByFields: s11, relationshipId: o5, layer: n13, map: p10, ...this._compileTitleAndDesc({ title: r6, description: a6 }) });
    return this.contentViewModels[t4] = c12, this.addHandles(a3(() => c12.relatedFeatures, "change", () => this._setRelatedFeaturesViewModels(c12)), oe2), e14;
  }
  _matchesGlobalFeature(e14, t4) {
    const i11 = e14?.association.globalId, s11 = t4?.association.globalId;
    return null != i11 && null != s11 && i11 === s11;
  }
  async _setUpUtilityNetworkAssociationsViewModels(e14, t4, i11) {
    const { view: s11, spatialReference: o5, timeZone: r6 } = this;
    e14.forEach((i12, s12) => {
      const o6 = t4.get(s12);
      o6 ? i12.forEach((t5) => {
        o6.find((e15) => this._matchesGlobalFeature(t5, e15)) || (i12.remove(t5), 0 === i12.length && e14.delete(s12));
      }) : (i12.removeAll(), e14.delete(s12));
    }), t4.forEach((t5, n13) => {
      const l5 = e14.get(n13) || new V();
      t5?.filter(Boolean).forEach((e15) => {
        if (!l5.some((t6) => this._matchesGlobalFeature(t6, e15))) {
          const { association: t6, feature: a6, terminalName: n14, title: p10 } = e15;
          l5.add({ title: p10, association: t6, featureViewModel: new te({ abilities: { utilityNetworkAssociationsContent: false }, map: i11, view: s11, spatialReference: o5, timeZone: r6, graphic: a6 }), terminalName: n14 });
        }
      }), e14.set(n13, l5);
    }), this._sortListObjectsByTitle(e14);
  }
  async _sortListObjectsByTitle(e14) {
    for (const t4 of e14.values()) t4.sort(this._compareByFeatureTitle);
  }
  _compareByFeatureTitle(e14, t4) {
    return e14.title.localeCompare(t4.title, void 0, { numeric: true });
  }
  _compileUtilityNetworkAssociation(e14, t4) {
    const { displayCount: i11, title: s11, description: o5, associationTypes: r6 } = e14, { _sourceLayer: a6, graphic: n13, map: l5 } = this;
    if (!K(a6)) return;
    const p10 = new v({ graphic: n13, displayCount: i11, associationTypes: r6, layer: a6, map: l5, ...this._compileTitleAndDesc({ title: s11, description: o5 }) });
    return this.contentViewModels[t4] = p10, this.addHandles([l(() => p10.associationFeatures.values(), () => this._setUpUtilityNetworkAssociationsViewModels(p10.associationViewModels, p10.associationFeatures, p10.map))], re), e14;
  }
  _compileExpression(e14, t4) {
    const { expressionInfo: i11 } = e14, { graphic: s11, map: o5, spatialReference: r6, view: a6, location: n13 } = this, l5 = new g3({ expressionInfo: i11, graphic: s11, interceptor: te.interceptor, map: o5, spatialReference: r6, view: a6, location: n13 });
    return this.contentViewModels[t4] = l5, this.addHandles(l(() => l5.contentElementViewModel, () => this._setExpressionContentVM(l5, t4), h2), se2), e14;
  }
  _compileAttachments(e14, t4) {
    const { graphic: i11 } = this, { description: s11, title: o5, orderByFields: r6 } = e14;
    return this.contentViewModels[t4] = new s8({ graphic: i11, orderByFields: r6, ...this._compileTitleAndDesc({ title: o5, description: s11 }) }), e14;
  }
  _compileCustom(e14, t4) {
    const { graphic: i11 } = this, { creator: s11, destroyer: o5 } = e14;
    return this.contentViewModels[t4] = new c7({ graphic: i11, creator: s11, destroyer: o5 }), e14;
  }
  _compileTitleAndDesc({ title: e14, description: t4 }) {
    const { _fieldInfoMap: i11, _sourceLayer: s11, graphic: o5, formattedAttributes: r6 } = this, a6 = o5?.attributes, n13 = this._expressionAttributes, l5 = r6.global;
    return { title: D({ attributes: a6, fieldInfoMap: i11, globalAttributes: l5, expressionAttributes: n13, layer: s11, text: e14 }), description: D({ attributes: a6, fieldInfoMap: i11, globalAttributes: l5, expressionAttributes: n13, layer: s11, text: t4 }) };
  }
  _createFieldsVMParams(e14, t4) {
    const i11 = this._effectivePopupTemplate, s11 = this.formattedAttributes, o5 = { ...s11?.global, ...s11?.content[t4] }, r6 = e14?.fieldInfos || i11?.fieldInfos, a6 = r6?.filter(({ fieldName: e15 }) => !!e15 && (E(e15) || pe(e15) || o5.hasOwnProperty(e15))), n13 = i11?.expressionInfos, { description: l5, title: p10 } = e14;
    return { attributes: o5, expressionInfos: n13, fieldInfos: a6, ...this._compileTitleAndDesc({ title: p10, description: l5 }) };
  }
  _compileFields(e14, t4) {
    const i11 = e14.clone(), s11 = new l3(this._createFieldsVMParams(e14, t4));
    return this.contentViewModels[t4] = s11, i11.fieldInfos = s11.formattedFieldInfos.slice(), i11;
  }
  _createMediaVMParams(e14, t4) {
    const { abilities: i11, graphic: s11, _fieldInfoMap: o5, _effectivePopupTemplate: r6, relatedInfos: a6, _sourceLayer: n13, _expressionAttributes: l5 } = this, p10 = this.formattedAttributes, c12 = s11?.attributes ?? {}, { description: d10, mediaInfos: h8, title: u8 } = e14;
    return { abilities: { chartAnimation: i11.chartAnimation }, activeMediaInfoIndex: e14.activeMediaInfoIndex || 0, attributes: c12, isAggregate: s11?.isAggregate, layer: n13, fieldInfoMap: o5, formattedAttributes: { ...p10?.global, ...p10?.content[t4] }, expressionAttributes: l5, mediaInfos: h8, popupTemplate: r6, relatedInfos: a6, ...this._compileTitleAndDesc({ title: u8, description: d10 }) };
  }
  _compileMedia(e14, t4) {
    const i11 = e14.clone(), s11 = new v4(this._createMediaVMParams(e14, t4));
    return i11.mediaInfos = s11.formattedMediaInfos.slice(), this.contentViewModels[t4] = s11, i11;
  }
  _createTextVMParams(e14) {
    const { graphic: t4, _fieldInfoMap: i11, _sourceLayer: s11, _expressionAttributes: o5 } = this;
    if (e14 && e14.text) {
      const r6 = t4?.attributes ?? {}, a6 = this.formattedAttributes?.global ?? {};
      e14.text = D({ attributes: r6, fieldInfoMap: i11, globalAttributes: a6, expressionAttributes: o5, layer: s11, text: e14.text });
    }
    return { graphic: t4, creator: e14.text };
  }
  _compileText(e14, t4) {
    const i11 = e14.clone();
    return this.contentViewModels[t4] = new c7(this._createTextVMParams(i11)), i11;
  }
  _compileLastEditInfo() {
    const { _effectivePopupTemplate: e14, _sourceLayer: t4, graphic: i11, timeZone: s11 } = this;
    if (!e14) return;
    const { lastEditInfoEnabled: o5 } = e14, r6 = t4?.editFieldsInfo;
    return o5 && r6 ? ne(r6, i11?.attributes, s11, t4) : void 0;
  }
  _compileTitle(e14) {
    const { _fieldInfoMap: t4, _sourceLayer: i11, graphic: s11, _expressionAttributes: o5 } = this, r6 = s11?.attributes ?? {}, a6 = this.formattedAttributes?.global ?? {};
    return D({ attributes: r6, fieldInfoMap: t4, globalAttributes: a6, expressionAttributes: o5, layer: i11, text: e14 });
  }
  async _getTitle() {
    const { _effectivePopupTemplate: e14, graphic: t4 } = this;
    return t4 ? q({ type: "title", value: e14?.title, event: { graphic: t4 } }) : null;
  }
  async _getContent() {
    const { _effectivePopupTemplate: e14, graphic: t4 } = this;
    return t4 ? q({ type: "content", value: e14?.content, event: { graphic: t4 } }) : null;
  }
  _evaluateExpressionAttributes({ title: e14, content: t4, expressionInfos: i11 }) {
    this._evaluateExpressionAttributesTask = e(this._evaluateExpressionAttributesTask), this._evaluateExpressionAttributesTask = d2(async (s11) => {
      const { graphic: o5, map: r6, view: a6, spatialReference: n13, location: p10 } = this;
      try {
        if (!o5) return;
        let l5;
        if (null != i11) {
          const e15 = [];
          for (const [t5, l6] of i11.expressions.entries()) null != l6 ? e15.push(l6.evaluate({ graphic: o5, interceptor: te.interceptor, location: p10, map: r6, options: { signal: s11 }, spatialReference: n13, view: a6 }).then((e16) => [t5, c10(e16)]).catch(() => [t5, void 0])) : e15.push(Promise.resolve([t5, void 0]));
          l5 = Object.fromEntries(await Promise.all(e15)), s2(s11);
        }
        this._expressionAttributes = l5, this._graphicExpressionAttributes = { ...o5.attributes, ...l5 }, this._set("formattedAttributes", this._createFormattedAttributes(t4)), this._set("title", this._compileTitle(e14)), this._set("lastEditInfo", this._compileLastEditInfo() || null), this._set("content", this._compileContent(t4) || null);
      } catch (c12) {
        b(c12) || (this._error = c12, i2.getLogger(this).error("error", "The popupTemplate could not be displayed for this feature.", { error: c12, graphic: o5, popupTemplate: this._effectivePopupTemplate }));
      }
    });
  }
  _createMediaFormattedAttributes({ contentElement: e14, contentElementIndex: t4, formattedAttributes: i11 }) {
    const { _effectivePopupTemplate: s11, graphic: o5, relatedInfos: r6, _sourceLayer: a6, _fieldInfoMap: n13, _graphicExpressionAttributes: l5, timeZone: p10 } = this;
    i11.content[t4] = se({ fieldInfos: s11?.fieldInfos, graphic: o5, attributes: { ...l5, ...e14.attributes }, layer: a6, fieldInfoMap: n13, relatedInfos: r6, timeZone: p10 });
  }
  _createFieldsFormattedAttributes({ contentElement: e14, contentElementIndex: t4, formattedAttributes: i11 }) {
    if (e14.fieldInfos) {
      const { graphic: s11, relatedInfos: o5, _sourceLayer: r6, _fieldInfoMap: a6, _graphicExpressionAttributes: n13, timeZone: l5 } = this;
      i11.content[t4] = se({ fieldInfos: e14.fieldInfos, graphic: s11, attributes: { ...n13, ...e14.attributes }, layer: r6, fieldInfoMap: a6, relatedInfos: o5, timeZone: l5 });
    }
  }
  _createFormattedAttributes(e14) {
    const { _effectivePopupTemplate: t4, graphic: i11, relatedInfos: s11, _sourceLayer: o5, _fieldInfoMap: r6, _graphicExpressionAttributes: a6, timeZone: n13 } = this, l5 = t4?.fieldInfos, p10 = { global: se({ fieldInfos: l5, graphic: i11, attributes: a6, layer: o5, fieldInfoMap: r6, relatedInfos: s11, timeZone: n13 }), content: [] };
    return Array.isArray(e14) && e14.forEach((e15, t5) => {
      "fields" === e15.type && this._createFieldsFormattedAttributes({ contentElement: e15, contentElementIndex: t5, formattedAttributes: p10 }), "media" === e15.type && this._createMediaFormattedAttributes({ contentElement: e15, contentElementIndex: t5, formattedAttributes: p10 });
    }), p10;
  }
  _checkForRelatedFeatures(e14) {
    const { graphic: t4, _effectivePopupTemplate: i11 } = this;
    return this._queryRelatedInfos(t4, oe(i11), e14);
  }
  async _queryRelatedInfos(e14, t4, i11) {
    const { relatedInfos: s11, _sourceLayer: o5 } = this;
    s11.clear();
    const r6 = null != o5?.associatedLayer ? await o5?.associatedLayer.load(i11) : o5;
    if (!r6 || !e14) return;
    const a6 = t4.filter((e15) => !!e15.fieldName && pe(e15.fieldName));
    if (!a6?.length) return;
    t4.forEach((e15) => this._configureRelatedInfo(e15, r6));
    const n13 = await v3({ relatedInfos: s11, layer: r6 }, i11);
    Object.keys(n13).forEach((e15) => {
      const t5 = s11.get(e15.toString()), i12 = n13[e15]?.value;
      t5 && i12 && (t5.layerInfo = i12.data);
    });
    const l5 = await T2({ graphic: e14, relatedInfos: s11, layer: r6 }, i11);
    Object.keys(l5).forEach((e15) => {
      g(l5[e15]?.value, s11.get(e15.toString()));
    });
  }
  _configureRelatedInfo(e14, t4) {
    const { relatedInfos: i11 } = this, s11 = h5(e14.fieldName || "");
    if (!s11) return;
    const { layerId: o5, fieldName: r6 } = s11;
    if (!o5) return;
    const a6 = i11.get(o5.toString()) || b4(o5, t4);
    a6 && (q2({ relatedInfo: a6, fieldName: r6, fieldInfo: e14 }), this.relatedInfos.set(o5, a6));
  }
}, te = _a, _a.interceptor = new e12(Ie, we), _a);
r([m()], ne2.prototype, "_error", void 0), r([m()], ne2.prototype, "_graphicChangedTask", void 0), r([m()], ne2.prototype, "_evaluateExpressionAttributesTask", void 0), r([m()], ne2.prototype, "_associationVMAbortController", void 0), r([m({ readOnly: true })], ne2.prototype, "_effectivePopupTemplate", null), r([m({ readOnly: true })], ne2.prototype, "_fieldInfoMap", null), r([m({ readOnly: true })], ne2.prototype, "_sourceLayer", null), r([m()], ne2.prototype, "abilities", void 0), r([s3("abilities")], ne2.prototype, "castAbilities", null), r([m({ readOnly: true })], ne2.prototype, "content", void 0), r([m({ readOnly: true })], ne2.prototype, "contentViewModels", void 0), r([m()], ne2.prototype, "description", void 0), r([m({ type: Boolean })], ne2.prototype, "defaultPopupTemplateEnabled", void 0), r([m({ readOnly: true })], ne2.prototype, "isFeatureFromTable", null), r([m({ readOnly: true })], ne2.prototype, "state", null), r([m({ readOnly: true })], ne2.prototype, "formattedAttributes", void 0), r([m({ type: d4, value: null })], ne2.prototype, "graphic", null), r([m({ readOnly: true })], ne2.prototype, "lastEditInfo", void 0), r([m({ type: _2 })], ne2.prototype, "location", void 0), r([m({ readOnly: true })], ne2.prototype, "relatedInfos", void 0), r([m({ type: f2 })], ne2.prototype, "spatialReference", null), r([m()], ne2.prototype, "timeZone", null), r([m({ readOnly: true })], ne2.prototype, "title", void 0), r([m()], ne2.prototype, "map", null), r([m({ readOnly: true })], ne2.prototype, "waitingForContent", null), r([m()], ne2.prototype, "view", void 0), ne2 = te = r([a("esri.widgets.Feature.FeatureViewModel")], ne2);

// node_modules/@arcgis/core/widgets/Feature/resources.js
var e13 = "esri-feature";
var t3 = { base: e13, container: `${e13}__size-container`, title: `${e13}__title`, main: `${e13}__main-container`, btn: `${e13}__button`, icon: `${e13}__icon`, content: `${e13}__content`, contentNode: `${e13}__content-node`, contentNodeText: `${e13}__content-node--text`, contentElement: `${e13}__content-element`, text: `${e13}__text`, lastEditedInfo: `${e13}__last-edited-info`, fields: `${e13}__fields`, fieldHeader: `${e13}__field-header`, fieldData: `${e13}__field-data`, fieldDataDate: `${e13}__field-data--date`, loadingSpinnerContainer: `${e13}__loading-container` };

// node_modules/@arcgis/core/widgets/Feature/support/FeatureContentMixin.js
var n12 = (n13) => {
  let i11 = class extends n13 {
    constructor() {
      super(...arguments), this.renderNodeContent = (e14) => e8(e14) && !e14.destroyed ? n("div", { class: t3.contentNode, key: e14 }, e14.render()) : e14 instanceof HTMLElement ? n("div", { afterCreate: this._attachToNode, bind: e14, class: t3.contentNode, key: e14 }) : o3(e14) ? n("div", { afterCreate: this._attachToNode, bind: e14.domNode, class: t3.contentNode, key: e14 }) : null;
    }
    _attachToNode(e14) {
      const o5 = this;
      e14.appendChild(o5);
    }
  };
  return i11 = r([a("esri.widgets.Feature.support.FeatureContentMixin")], i11), i11;
};

// node_modules/@arcgis/core/widgets/Feature.js
var b8 = { title: true, content: true, lastEditedInfo: true };
var F8 = class extends n12(O) {
  constructor(e14, t4) {
    super(e14, t4), this._contentWidgets = [], this.flowType = "feature", this.flowItems = null, this.headingLevel = 2, this.messages = null, this.messagesCommon = null, this.visibleElements = { ...b8 }, this.viewModel = new ne2();
  }
  initialize() {
    this.addHandles(l(() => this.viewModel?.contentViewModels, () => this._setupContentWidgets(), h2));
  }
  loadDependencies() {
    return c3({ notice: () => import("./calcite-notice-2INJGHRM.js"), loader: () => import("./calcite-loader-QHY6QNRQ.js") });
  }
  destroy() {
    this._destroyContentWidgets();
  }
  get graphic() {
    return this.viewModel.graphic;
  }
  set graphic(e14) {
    this.viewModel.graphic = e14;
  }
  get defaultPopupTemplateEnabled() {
    return this.viewModel.defaultPopupTemplateEnabled;
  }
  set defaultPopupTemplateEnabled(e14) {
    this.viewModel.defaultPopupTemplateEnabled = e14;
  }
  get isTable() {
    return this.viewModel.isFeatureFromTable;
  }
  get icon() {
    return "polygon";
  }
  set icon(e14) {
    this._overrideIfSome("icon", e14);
  }
  get label() {
    return this.messages?.widgetLabel ?? "";
  }
  set label(e14) {
    this._overrideIfSome("label", e14);
  }
  get location() {
    return this.viewModel.location;
  }
  set location(e14) {
    this.viewModel.location = e14;
  }
  get spatialReference() {
    return this.viewModel.spatialReference;
  }
  set spatialReference(e14) {
    this.viewModel.spatialReference = e14;
  }
  get timeZone() {
    return this.viewModel.timeZone;
  }
  set timeZone(e14) {
    this.viewModel.timeZone = e14;
  }
  get title() {
    return this.viewModel.title;
  }
  castVisibleElements(e14) {
    return { ...b8, ...e14 };
  }
  get map() {
    return this.viewModel.map;
  }
  set map(e14) {
    this.viewModel.map = e14;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e14) {
    this.viewModel.view = e14;
  }
  setActiveMedia(e14, t4) {
    return this.viewModel.setActiveMedia(e14, t4);
  }
  nextMedia(e14) {
    return this.viewModel.nextMedia(e14);
  }
  previousMedia(e14) {
    return this.viewModel.previousMedia(e14);
  }
  render() {
    const { state: e14 } = this.viewModel, t4 = n("div", { class: t3.container, key: "container" }, this._renderTitle(), "error" === e14 ? this._renderError() : "loading" === e14 ? this._renderLoading() : this._renderContentContainer());
    return n("div", { class: this.classes(t3.base, e4.widget) }, t4);
  }
  _renderError() {
    const { messagesCommon: e14, messages: t4, visibleElements: s11 } = this;
    return n("calcite-notice", { icon: "exclamation-mark-circle", kind: "danger", open: true, scale: "s" }, s11.title ? n("div", { key: "error-title", slot: "title" }, e14.errorMessage) : null, n("div", { key: "error-message", slot: "message" }, t4.loadingError));
  }
  _renderLoading() {
    return n("div", { class: t3.loadingSpinnerContainer, key: "loading-container" }, n("calcite-loader", { inline: true, label: "" }));
  }
  _renderContentContainer() {
    const { visibleElements: e14 } = this;
    return e14.content ? n("div", { class: t3.main }, [this._renderContent(), this._renderLastEditInfo()]) : null;
  }
  _renderTitle() {
    const { visibleElements: e14, title: t4 } = this;
    return e14.title ? n(e5, { class: t3.title, innerHTML: t4, level: this.headingLevel }) : null;
  }
  _renderContent() {
    const e14 = this.viewModel.content, t4 = "content";
    if (!e14) return null;
    if (Array.isArray(e14)) return e14.length ? n("div", { class: t3.contentNode, key: `${t4}-content-elements` }, e14.map(this._renderContentElement, this)) : null;
    if ("string" == typeof e14) {
      const e15 = this._contentWidgets[0];
      return !e15 || e15.destroyed ? null : n("div", { class: this.classes(t3.contentNode, t3.contentNodeText), key: `${t4}-content` }, e15.render());
    }
    return this.renderNodeContent(e14);
  }
  _renderContentElement(e14, t4) {
    const { visibleElements: s11 } = this;
    if ("boolean" != typeof s11.content && !s11.content?.[e14.type]) return null;
    switch (e14.type) {
      case "attachments":
        return this._renderAttachments(t4);
      case "custom":
        return this._renderCustom(e14, t4);
      case "fields":
        return this._renderFields(t4);
      case "media":
        return this._renderMedia(t4);
      case "text":
        return this._renderText(e14, t4);
      case "expression":
        return this._renderExpression(t4);
      case "relationship":
        return this._renderRelationship(t4);
      case "utility-network-associations":
        return this._renderAssociation(t4);
      default:
        return null;
    }
  }
  _renderAttachments(e14) {
    const t4 = this._contentWidgets[e14];
    if (!t4 || t4.destroyed) return null;
    const { state: s11, attachmentInfos: i11 } = t4.viewModel;
    return "loading" === s11 || i11.length > 0 ? n("div", { class: this.classes(t3.contentElement), key: this._buildKey("attachments-element", e14) }, t4.render()) : null;
  }
  _renderRelationship(e14) {
    const t4 = this._contentWidgets[e14];
    return t4 && !t4.destroyed && this.flowItems ? n("div", { class: t3.contentElement, key: this._buildKey("relationship-element", e14) }, t4.render()) : null;
  }
  _renderAssociation(e14) {
    const t4 = this._contentWidgets[e14];
    return t4 && !t4.destroyed && this.flowItems ? n("div", { class: t3.contentElement, key: this._buildKey("utility-network-association-element", e14) }, t4.render()) : null;
  }
  _renderExpression(e14) {
    const t4 = this._contentWidgets[e14];
    return t4 && !t4.destroyed && t4.viewModel.contentElement ? n("div", { class: t3.contentElement, key: this._buildKey("expression-element", e14) }, t4.render()) : null;
  }
  _renderCustom(e14, t4) {
    const { creator: s11 } = e14, i11 = this._contentWidgets[t4];
    return !i11 || i11.destroyed ? null : s11 ? n("div", { class: t3.contentElement, key: this._buildKey("custom-element", t4) }, i11.render()) : null;
  }
  _renderFields(e14) {
    const t4 = this._contentWidgets[e14];
    return !t4 || t4.destroyed ? null : n("div", { class: t3.contentElement, key: this._buildKey("fields-element", e14) }, t4.render());
  }
  _renderMedia(e14) {
    const t4 = this._contentWidgets[e14];
    return !t4 || t4.destroyed ? null : n("div", { class: t3.contentElement, key: this._buildKey("media-element", e14) }, t4.render());
  }
  _renderLastEditInfo() {
    const { visibleElements: e14, messages: t4 } = this, { lastEditInfo: s11 } = this.viewModel;
    if (!s11 || !e14.lastEditedInfo) return null;
    const { date: i11, user: n13 } = s11, o5 = "edit" === s11.type ? n13 ? t4.lastEditedByUser : t4.lastEdited : n13 ? t4.lastCreatedByUser : t4.lastCreated, r6 = s4(o5, { date: i11, user: n13 });
    return n("div", { class: this.classes(t3.lastEditedInfo, t3.contentElement), key: "edit-info-element" }, r6);
  }
  _renderText(e14, t4) {
    const s11 = e14.text, i11 = this._contentWidgets[t4];
    return !i11 || i11.destroyed ? null : s11 ? n("div", { class: this.classes(t3.contentElement, t3.text), key: this._buildKey("text-element", t4) }, i11.render()) : null;
  }
  _buildKey(e14, ...t4) {
    return `${e14}__${this.viewModel?.graphic?.uid || "0"}-${t4.join("-")}`;
  }
  _destroyContentWidget(e14) {
    e14 && (e14.viewModel = null, !e14.destroyed && e14.destroy());
  }
  _destroyContentWidgets() {
    this._contentWidgets.forEach((e14) => this._destroyContentWidget(e14)), this._contentWidgets = [];
  }
  _setupContentWidgets() {
    this._destroyContentWidgets();
    const { headingLevel: e14, visibleElements: t4, flowItems: s11, viewModel: i11 } = this, n13 = i11?.content, { contentViewModels: o5 } = i11;
    if (Array.isArray(n13)) n13.forEach((n14, r6) => {
      if ("attachments" === n14.type && (this._contentWidgets[r6] = new h4({ displayType: n14.displayType, headingLevel: t4.title && e14 < 6 ? e14 + 1 : e14, viewModel: o5[r6] })), "fields" === n14.type && (this._contentWidgets[r6] = new c9({ viewModel: o5[r6] })), "media" === n14.type && (this._contentWidgets[r6] = new T3({ viewModel: o5[r6] })), "text" === n14.type && (this._contentWidgets[r6] = new l2({ viewModel: o5[r6] })), "custom" === n14.type && (this._contentWidgets[r6] = new l2({ viewModel: o5[r6] })), "expression" === n14.type && (this._contentWidgets[r6] = new g4({ viewModel: o5[r6] })), "relationship" === n14.type) {
        const e15 = new M4({ flowItems: s11, featureVisibleElements: t4, viewModel: o5[r6] });
        this._contentWidgets[r6] = e15;
      }
      if ("utility-network-associations" === n14.type) {
        const e15 = async (e16) => {
          const { viewModel: n16, listType: o6, title: r7 } = e16;
          if (!s11) return;
          n16.activeAssociationType = o6;
          const { default: l5 } = await import("./FeatureUtilityNetworkAssociationList-7Y2VENRY.js"), d10 = new l5({ viewModel: n16, parentFeatureViewModel: i11, listType: o6, title: r7, featureVisibleElements: t4, description: i11.title, flowItems: s11 });
          s11.push(d10);
        }, n15 = new v7({ flowItems: s11, onSelectAssociationType: e15, parentFeatureViewModel: i11, featureVisibleElements: t4, viewModel: o5[r6] });
        this._contentWidgets[r6] = n15;
      }
    }, this);
    else {
      const e15 = o5[0];
      e15 && !e15.destroyed && (this._contentWidgets[0] = new l2({ viewModel: e15 }));
    }
    this.scheduleRender();
  }
};
r([m()], F8.prototype, "flowType", void 0), r([m()], F8.prototype, "graphic", null), r([m()], F8.prototype, "defaultPopupTemplateEnabled", null), r([m()], F8.prototype, "flowItems", void 0), r([m()], F8.prototype, "headingLevel", void 0), r([m({ readOnly: true })], F8.prototype, "isTable", null), r([m()], F8.prototype, "icon", null), r([m()], F8.prototype, "label", null), r([m()], F8.prototype, "location", null), r([m(), e3("esri/widgets/Feature/t9n/Feature")], F8.prototype, "messages", void 0), r([m(), e3("esri/t9n/common")], F8.prototype, "messagesCommon", void 0), r([m()], F8.prototype, "spatialReference", null), r([m()], F8.prototype, "timeZone", null), r([m({ readOnly: true })], F8.prototype, "title", null), r([m()], F8.prototype, "visibleElements", void 0), r([s3("visibleElements")], F8.prototype, "castVisibleElements", null), r([m()], F8.prototype, "map", null), r([m()], F8.prototype, "view", null), r([m({ type: ne2 })], F8.prototype, "viewModel", void 0), F8 = r([a("esri.widgets.Feature")], F8);

export {
  e9 as e,
  i5 as i,
  ne2 as ne,
  t3 as t,
  n12 as n,
  F8 as F
};
//# sourceMappingURL=chunk-GAXOORY3.js.map
