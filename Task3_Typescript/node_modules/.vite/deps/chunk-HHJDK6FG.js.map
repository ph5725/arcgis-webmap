{
  "version": 3,
  "sources": ["../../@arcgis/core/core/workers/WorkerHandle.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import s from\"../Logger.js\";import{throwIfAborted as r}from\"../promiseUtils.js\";import{open as i}from\"./workers.js\";class h{constructor(e,t,r,h,o={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i(e,{...o,schedule:h}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,o.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>s.getLogger(\"esri.core.workers.WorkerHandle\").error(`Failed to initialize ${e} worker: ${t}`)))}on(s,r){const i={removed:!1,eventName:s,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t((()=>{i.removed=!0,e(this._listeners,i),this._thread&&null!=i.threadHandle&&i.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,s){return this.invokeMethod(this._mainMethod,e,t,s)}invokeMethod(e,t,s,i){if(this._thread){const r=this._transferLists[e],h=r?r(t):[];return this._thread.invoke(e,t,{transferList:h,signal:s,priority:i})}return this._promise?this._promise.then((()=>(r(s),this.invokeMethod(e,t,s)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{h as WorkerHandle};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;AAI6M,IAAM,IAAN,MAAO;AAAA,EAAC,YAAYA,IAAE,GAAE,GAAEC,IAAE,IAAE,CAAC,GAAE;AAAC,SAAK,cAAY,GAAE,KAAK,iBAAe,GAAE,KAAK,aAAW,CAAC,GAAE,KAAK,WAAS,EAAED,IAAE,EAAC,GAAG,GAAE,UAASC,GAAC,CAAC,EAAE,KAAM,CAAAD,OAAG;AAAC,UAAG,WAAS,KAAK,SAAQ;AAAC,aAAK,UAAQA,IAAE,KAAK,WAAS,MAAK,EAAE,iBAAe,KAAK,UAAU,CAAC,GAAE,YAAY;AAAE,mBAAUA,MAAK,KAAK,WAAW,MAAK,iBAAiBA,EAAC;AAAA,MAAC,MAAM,CAAAA,GAAE,MAAM;AAAA,IAAC,CAAE,GAAE,KAAK,SAAS,MAAO,CAAAE,OAAG,EAAE,UAAU,gCAAgC,EAAE,MAAM,wBAAwBF,EAAC,YAAYE,EAAC,EAAE,CAAE;AAAA,EAAC;AAAA,EAAC,GAAGC,IAAE,GAAE;AAAC,UAAMC,KAAE,EAAC,SAAQ,OAAG,WAAUD,IAAE,UAAS,GAAE,cAAa,KAAI;AAAE,WAAO,KAAK,WAAW,KAAKC,EAAC,GAAE,KAAK,iBAAiBA,EAAC,GAAE,EAAG,MAAI;AAAC,MAAAA,GAAE,UAAQ,MAAG,EAAE,KAAK,YAAWA,EAAC,GAAE,KAAK,WAAS,QAAMA,GAAE,gBAAcA,GAAE,aAAa,OAAO;AAAA,IAAC,CAAE;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,YAAU,KAAK,QAAQ,MAAM,GAAE,KAAK,UAAQ,OAAM,KAAK,WAAS,MAAK,KAAK,WAAW,SAAO,GAAE,KAAK,iBAAe,CAAC;AAAA,EAAC;AAAA,EAAC,OAAOJ,IAAE,GAAEG,IAAE;AAAC,WAAO,KAAK,aAAa,KAAK,aAAYH,IAAE,GAAEG,EAAC;AAAA,EAAC;AAAA,EAAC,aAAaH,IAAE,GAAEG,IAAEC,IAAE;AAAC,QAAG,KAAK,SAAQ;AAAC,YAAM,IAAE,KAAK,eAAeJ,EAAC,GAAEC,KAAE,IAAE,EAAE,CAAC,IAAE,CAAC;AAAE,aAAO,KAAK,QAAQ,OAAOD,IAAE,GAAE,EAAC,cAAaC,IAAE,QAAOE,IAAE,UAASC,GAAC,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK,WAAS,KAAK,SAAS,KAAM,OAAK,EAAED,EAAC,GAAE,KAAK,aAAaH,IAAE,GAAEG,EAAC,EAAG,IAAE,QAAQ,OAAO,IAAI;AAAA,EAAC;AAAA,EAAC,UAAUH,IAAE,GAAE;AAAC,WAAO,KAAK,UAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,GAAEA,EAAC,CAAC,EAAE,KAAM,MAAI;AAAA,IAAC,CAAE,IAAE,KAAK,WAAS,KAAK,SAAS,KAAM,MAAI,KAAK,UAAUA,IAAE,CAAC,CAAE,IAAE,QAAQ,OAAO;AAAA,EAAC;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,iBAAiBA,IAAE;AAAC,SAAK,WAAS,KAAK,QAAQ,GAAGA,GAAE,WAAUA,GAAE,QAAQ,EAAE,KAAM,OAAG;AAAC,MAAAA,GAAE,YAAUA,GAAE,eAAa;AAAA,IAAE,CAAE;AAAA,EAAC;AAAC;",
  "names": ["e", "h", "t", "s", "i"]
}
