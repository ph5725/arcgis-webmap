{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/support/associatedFeatureServiceUtils.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{id as e}from\"../../kernel.js\";import r from\"../../request.js\";import t from\"../../core/Error.js\";import{throwIfAbortError as n}from\"../../core/promiseUtils.js\";import{parse as a}from\"./arcgisLayerUrl.js\";import o from\"../../portal/Portal.js\";import i from\"../../portal/PortalItem.js\";async function s(e,r){const n=a(e);if(!n)throw new t(\"invalid-url\",\"Invalid scene service url\");const o={...r,sceneServerUrl:n.url.path,layerId:n.sublayer??void 0};if(o.sceneLayerItem??=await l(o),null==o.sceneLayerItem)return f(o.sceneServerUrl.replace(\"/SceneServer\",\"/FeatureServer\"),o);const i=await y(o);if(!i?.url)throw new t(\"related-service-not-found\",\"Could not find feature service through portal item relationship\");o.featureServiceItem=i;const s=await f(i.url,o);return s.portalItem=i,s}async function l(e){const r=(await c(e)).serviceItemId;if(!r)return null;const t=new i({id:r,apiKey:e.apiKey}),a=await u(e);null!=a&&(t.portal=new o({url:a}));try{return await t.load({signal:e.signal})}catch(s){return n(s),null}}async function c(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:\"json\",...e.customParameters,token:e.apiKey},responseType:\"json\",signal:e.signal};try{const n=await r(e.sceneServerUrl,t);e.rootDocument=n.data}catch{e.rootDocument={}}return e.rootDocument}async function u(t){const a=e?.findServerInfo(t.sceneServerUrl);if(a?.owningSystemUrl)return a.owningSystemUrl;const o=t.sceneServerUrl.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";try{const e=(await r(o,{query:{f:\"json\"},responseType:\"json\",signal:t.signal})).data.owningSystemUrl;if(e)return e}catch(i){n(i)}return null}async function f(e,n){const o=a(e);if(!o)throw new t(\"invalid-feature-service-url\",\"Invalid feature service url\");const i=o.url.path,s=n.layerId;if(null==s)return{serverUrl:i};const l=c(n),u=n.featureServiceItem?await n.featureServiceItem.fetchData(\"json\"):null,f=(u?.layers?.[0]||u?.tables?.[0])?.customParameters,y=e=>{const t={query:{f:\"json\",...f},responseType:\"json\",authMode:e,signal:n.signal};return r(i,t)},m=y(\"anonymous\").catch((()=>y(\"no-prompt\"))),[p,d]=await Promise.all([m,l]),v=d?.layers,w=p.data&&p.data.layers;if(!Array.isArray(w))throw new Error(\"expected layers array\");if(Array.isArray(v))for(let r=0;r<Math.min(v.length,w.length);r++){if(v[r].id===s)return{serverUrl:i,layerId:w[r].id}}else if(null!=s&&s<w.length)return{serverUrl:i,layerId:w[s].id};throw new Error(\"could not find matching associated sublayer\")}async function y({sceneLayerItem:e,signal:r}){if(!e)return null;try{const t=(await e.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:r})).find((e=>\"Feature Service\"===e.type))||null;if(!t)return null;const n=new i({portal:t.portal,id:t.id});return await n.load(),n}catch(t){return n(t),null}}export{s as findAssociatedFeatureService};\r\n"],
  "mappings": "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",
  "names": ["s", "a", "l", "u", "f", "y", "e", "p"]
}
