{
  "version": 3,
  "sources": ["../../@arcgis/core/rest/query/operations/query.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport e from\"../../../request.js\";import{urlToObject as t,join as r}from\"../../../core/urlUtils.js\";import{getJsonType as n}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as o}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as s}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function d(e,t){if(t&&\"extent\"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&\"point\"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function y(e,t,r){const i=e.geometry,a=e.toJSON();delete a.compactGeometryEnabled,delete a.defaultSpatialReferenceEnabled;const s=a;let u,l,y;if(i&&(l=i.spatialReference,y=o(l),s.geometryType=n(i),s.geometry=d(i,e.compactGeometryEnabled),s.inSR=y),a.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=a.groupByFieldsForStatistics.join(\",\")),a.objectIds)switch(r?.uniqueIdFields?.length){case void 0:s.objectIds=a.objectIds.join(\",\");break;case 1:s.uniqueIds=JSON.stringify(a.objectIds),delete s.objectIds;break;default:s.uniqueIds=JSON.stringify(a.objectIds.map((e=>JSON.parse(e)))),delete s.objectIds}if(a.orderByFields&&(s.orderByFields=a.orderByFields.join(\",\")),!a.outFields||!a.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:a.outFields.includes(\"*\")?s.outFields=\"*\":s.outFields=a.outFields.join(\",\"),a.outSR?(s.outSR=o(a.outSR),u=e.outSpatialReference):i&&(a.returnGeometry||a.returnCentroid)&&(s.outSR=s.inSR,u=l),a.returnGeometry&&delete a.returnGeometry,a.outStatistics&&(s.outStatistics=JSON.stringify(a.outStatistics)),a.fullText&&(s.fullText=JSON.stringify(a.fullText)),a.pixelSize&&(s.pixelSize=JSON.stringify(a.pixelSize)),a.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete a.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(a.quantizationParameters)),a.parameterValues&&(s.parameterValues=JSON.stringify(a.parameterValues)),a.rangeValues&&(s.rangeValues=JSON.stringify(a.rangeValues)),a.dynamicDataSource&&(s.layer=JSON.stringify({source:a.dynamicDataSource}),delete a.dynamicDataSource),a.timeExtent){const e=a.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${t??\"null\"},${r??\"null\"}`),delete a.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function c(e,t,r,n,i){const o=t.timeExtent?.isEmpty?{data:{features:[]}}:await g(e,t,\"json\",n,void 0,i);return u(t,r,o.data),o}async function f(e,t,r,n,i){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const o=await m(e,t,n,i),a=o;return a.data=s(o.data,r),a}function m(e,t,r,n){return g(e,t,\"pbf\",r,void 0,n)}function p(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):g(e,t,\"json\",r,{returnIdsOnly:!0},n)}function S(e,t,r,n){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):g(e,t,\"json\",r,{returnIdsOnly:!0,returnCountOnly:!0},n)}async function O(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const n=await g(e,t,\"json\",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=n.data;if(i.hasOwnProperty(\"extent\"))return n;if(i.features)throw new Error(l);if(i.hasOwnProperty(\"count\"))throw new Error(l);return n}function x(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function g(n,o,s,u={},l={},d={}){const c=\"string\"==typeof n?t(n):n,f=o.geometry?[o.geometry]:[],m=await i(f,null,{signal:u.signal}),p=m?.[0];null!=p&&((o=o.clone()).geometry=p);const S=a({...c.query,f:s,...x(l,d),...y(o,l,d)});return e(r(c.path,j(o,l)?\"query3d\":\"query\"),{...u,responseType:\"pbf\"===s?\"array-buffer\":\"json\",query:{...S,...u.query}})}function j(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{d as encodeGeometry,c as executeQuery,S as executeQueryForCount,O as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,m as executeQueryPBFBuffer,y as queryToQueryStringParameters,g as runQuery};\r\n"],
  "mappings": "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",
  "names": ["t", "l", "y", "e", "r", "c", "d", "f", "m", "p", "S"]
}
