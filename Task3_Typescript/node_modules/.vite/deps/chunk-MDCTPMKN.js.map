{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/calculateUVZShadow.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ShadowmapFiltering.glsl.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderModules/Texture2DShadowBindUniform.js", "../../@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{i}from\"../../../../../../chunks/vec32.js\";import{create as n}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{s as t}from\"../../../../../../chunks/vec42.js\";import{create as e}from\"../../../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{PBRMode as h}from\"./PhysicallyBasedRenderingParameters.glsl.js\";import{Float3BindUniform as s}from\"../../shaderModules/Float3BindUniform.js\";import{Float4BindUniform as g}from\"../../shaderModules/Float4BindUniform.js\";import{glsl as r}from\"../../shaderModules/glsl.js\";function m(n,e){const m=n.fragment,o=void 0!==e.lightingSphericalHarmonicsOrder?e.lightingSphericalHarmonicsOrder:2;0===o?(m.uniforms.add(new s(\"lightingAmbientSH0\",(({lighting:n})=>i(l,n.sh.r[0],n.sh.g[0],n.sh.b[0])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\r\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\r\nreturn ambientLight * (1.0 - ambientOcclusion);\r\n}`)):1===o?(m.uniforms.add(new g(\"lightingAmbientSH_R\",(({lighting:i})=>t(a,i.sh.r[0],i.sh.r[1],i.sh.r[2],i.sh.r[3]))),new g(\"lightingAmbientSH_G\",(({lighting:i})=>t(a,i.sh.g[0],i.sh.g[1],i.sh.g[2],i.sh.g[3]))),new g(\"lightingAmbientSH_B\",(({lighting:i})=>t(a,i.sh.b[0],i.sh.b[1],i.sh.b[2],i.sh.b[3])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\r\nvec4 sh0 = vec4(\r\n0.282095,\r\n0.488603 * normal.x,\r\n0.488603 * normal.z,\r\n0.488603 * normal.y\r\n);\r\nvec3 ambientLight = vec3(\r\ndot(lightingAmbientSH_R, sh0),\r\ndot(lightingAmbientSH_G, sh0),\r\ndot(lightingAmbientSH_B, sh0)\r\n);\r\nreturn ambientLight * (1.0 - ambientOcclusion);\r\n}`)):2===o&&(m.uniforms.add(new s(\"lightingAmbientSH0\",(({lighting:n})=>i(l,n.sh.r[0],n.sh.g[0],n.sh.b[0]))),new g(\"lightingAmbientSH_R1\",(({lighting:i})=>t(a,i.sh.r[1],i.sh.r[2],i.sh.r[3],i.sh.r[4]))),new g(\"lightingAmbientSH_G1\",(({lighting:i})=>t(a,i.sh.g[1],i.sh.g[2],i.sh.g[3],i.sh.g[4]))),new g(\"lightingAmbientSH_B1\",(({lighting:i})=>t(a,i.sh.b[1],i.sh.b[2],i.sh.b[3],i.sh.b[4]))),new g(\"lightingAmbientSH_R2\",(({lighting:i})=>t(a,i.sh.r[5],i.sh.r[6],i.sh.r[7],i.sh.r[8]))),new g(\"lightingAmbientSH_G2\",(({lighting:i})=>t(a,i.sh.g[5],i.sh.g[6],i.sh.g[7],i.sh.g[8]))),new g(\"lightingAmbientSH_B2\",(({lighting:i})=>t(a,i.sh.b[5],i.sh.b[6],i.sh.b[7],i.sh.b[8])))),m.code.add(r`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\r\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\r\nvec4 sh1 = vec4(\r\n0.488603 * normal.x,\r\n0.488603 * normal.z,\r\n0.488603 * normal.y,\r\n1.092548 * normal.x * normal.y\r\n);\r\nvec4 sh2 = vec4(\r\n1.092548 * normal.y * normal.z,\r\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n1.092548 * normal.x * normal.z,\r\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n);\r\nambientLight += vec3(\r\ndot(lightingAmbientSH_R1, sh1),\r\ndot(lightingAmbientSH_G1, sh1),\r\ndot(lightingAmbientSH_B1, sh1)\r\n);\r\nambientLight += vec3(\r\ndot(lightingAmbientSH_R2, sh2),\r\ndot(lightingAmbientSH_G2, sh2),\r\ndot(lightingAmbientSH_B2, sh2)\r\n);\r\nreturn ambientLight * (1.0 - ambientOcclusion);\r\n}`),e.pbrMode!==h.Normal&&e.pbrMode!==h.Schematic||m.code.add(r`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\r\nvec3 calculateAmbientRadiance(float ambientOcclusion)\r\n{\r\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\r\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\r\n}`))}const l=n(),a=e();export{m as EvaluateAmbientLighting};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{BindType as r}from\"../../../../webgl/BindType.js\";import{Uniform as o}from\"../../../../webgl/Uniform.js\";class t extends o{constructor(o,t,e){super(o,\"mat4\",r.Draw,((r,e,s,m)=>r.setUniformMatrix4fv(o,t(e,s,m))),e)}}export{t as Matrix4sDrawUniform};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{BindType as r}from\"../../../../webgl/BindType.js\";import{Uniform as s}from\"../../../../webgl/Uniform.js\";class o extends s{constructor(s,o,t){super(s,\"mat4\",r.Pass,((r,t,e)=>r.setUniformMatrix4fv(s,o(t,e))),t)}}export{o as Matrix4sPassUniform};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{create as a}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{Float4BindUniform as e}from\"../../shaderModules/Float4BindUniform.js\";import{glsl as o}from\"../../shaderModules/glsl.js\";import{IntegerBindUniform as s}from\"../../shaderModules/IntegerBindUniform.js\";import{Matrix4sDrawUniform as i}from\"../../shaderModules/Matrix4sDrawUniform.js\";import{Matrix4sPassUniform as t}from\"../../shaderModules/Matrix4sPassUniform.js\";import{NoParameters as r}from\"../../../../../webgl/NoParameters.js\";class d extends r{constructor(){super(...arguments),this.origin=a()}}function c(a){a.fragment.uniforms.add(new t(\"shadowMapMatrix\",((a,e)=>e.shadowMap.getShadowMapMatrices(a.origin)),4)),l(a)}function n(a){a.fragment.uniforms.add(new i(\"shadowMapMatrix\",((a,e)=>e.shadowMap.getShadowMapMatrices(a.origin)),4)),l(a)}function l(a){const{fragment:i}=a;i.uniforms.add(new e(\"cascadeDistances\",(a=>a.shadowMap.cascadeDistances)),new s(\"numCascades\",(a=>a.shadowMap.numCascades))),i.code.add(o`const vec3 invalidShadowmapUVZ = vec3(0.0, 0.0, -1.0);\r\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\r\nvec4 lv = mat * vec4(_vpos, 1.0);\r\nlv.xy /= lv.w;\r\nreturn 0.5 * lv.xyz + vec3(0.5);\r\n}\r\nvec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {\r\nfloat xScale = float(textureSize.y) / float(textureSize.x);\r\nreturn vec2((float(i) + lvpos.x) * xScale, lvpos.y);\r\n}\r\nvec3 calculateUVZShadow(in vec3 _worldPos, in float _linearDepth, in ivec2 shadowMapSize) {\r\nint i = _linearDepth < cascadeDistances[1] ? 0 : _linearDepth < cascadeDistances[2] ? 1 : _linearDepth < cascadeDistances[3] ? 2 : 3;\r\nif (i >= numCascades) {\r\nreturn invalidShadowmapUVZ;\r\n}\r\nmat4 shadowMatrix = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\r\nvec3 lvpos = lightSpacePosition(_worldPos, shadowMatrix);\r\nif (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {\r\nreturn invalidShadowmapUVZ;\r\n}\r\nvec2 uvShadow = cascadeCoordinates(i, shadowMapSize, lvpos);\r\nreturn vec3(uvShadow, lvpos.z);\r\n}`)}export{d as ReadShadowMapOrigin,n as calculateUVZShadowDraw,c as calculateUVZShadowPass};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{ReadShadowMapOrigin as a}from\"./calculateUVZShadow.glsl.js\";import{glsl as o}from\"../../shaderModules/glsl.js\";class d extends a{}function e(a){a.fragment.code.add(o`float readShadowMapUVZ(vec3 uvzShadow, sampler2DShadow _shadowMap) {\r\nreturn texture(_shadowMap, uvzShadow);\r\n}`)}export{d as ReadShadowMapDrawParameters,e as ShadowmapFiltering};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{BindType as r}from\"../../../../webgl/BindType.js\";import{Uniform as e}from\"../../../../webgl/Uniform.js\";class o extends e{constructor(e,o){super(e,\"sampler2DShadow\",r.Bind,((r,s)=>r.bindTexture(e,o(s))))}}export{o as Texture2DShadowBindUniform};\r\n", "/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{create as o}from\"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{calculateUVZShadowPass as e,calculateUVZShadowDraw as a,ReadShadowMapOrigin as r}from\"./calculateUVZShadow.glsl.js\";import{ShadowmapFiltering as s}from\"./ShadowmapFiltering.glsl.js\";import{glsl as d}from\"../../shaderModules/glsl.js\";import{Texture2DShadowBindUniform as t}from\"../../shaderModules/Texture2DShadowBindUniform.js\";import{NoParameters as i}from\"../../../../../webgl/NoParameters.js\";class l extends r{}class n extends i{constructor(){super(...arguments),this.origin=o()}}function c(o,a){a.receiveShadows&&(o.include(e),u(o))}function h(o,e){e.receiveShadows&&(o.include(a),u(o))}function u(o){o.include(s);const{fragment:e}=o;e.uniforms.add(new t(\"shadowMap\",(o=>o.shadowMap.depthTexture))),e.code.add(d`float readShadowMap(const in vec3 _worldPos, float _linearDepth) {\r\nvec3 uvzShadow = calculateUVZShadow(_worldPos, _linearDepth, textureSize(shadowMap,0));\r\nif (uvzShadow.z < 0.0) {\r\nreturn 0.0;\r\n}\r\nreturn readShadowMapUVZ(uvzShadow, shadowMap);\r\n}`)}export{h as ReadShadowMapDraw,l as ReadShadowMapDrawParameters,c as ReadShadowMapPass,n as ReadShadowMapPassParameters};\r\n"],
  "mappings": "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",
  "names": ["n", "e", "m", "o", "i", "a", "o", "t", "e", "s", "m", "o", "s", "t", "e", "c", "a", "o", "e", "l", "n", "i", "e", "a", "n", "o", "e", "s", "c", "o", "a", "e", "n"]
}
