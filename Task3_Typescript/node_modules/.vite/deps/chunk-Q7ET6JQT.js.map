{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/webgl-engine/lib/Intersector.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport{f as t,t as r}from\"../../../../chunks/vec32.js\";import{create as s}from\"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as i,fromPoints as e,copy as n}from\"../../../../geometry/support/ray.js\";import{ViewingMode as a}from\"../../../ViewingMode.js\";import o from\"../../webgl/RenderCamera.js\";import{HUDTarget as h,HUDIntersectorResult as c}from\"./HUDIntersectorResult.js\";import{IntersectorOptions as l,StoreResults as f}from\"./IntersectorInterfaces.js\";import{IntersectorResult as d}from\"./IntersectorResult.js\";import{IntersectorType as m}from\"./IntersectorType.js\";import{IntersectorTransform as u,getVerticalOffsetObject3D as y}from\"./verticalOffsetUtils.js\";const _=1e-5;class g{constructor(t){this.options=new l,this._results=new O,this.transform=new u,this.camera=new o,this.tolerance=_,this.verticalOffset=null,this._ray=i(),this._rayEnd=s(),this._rayBeginTransformed=s(),this._rayEndTransformed=s(),this.viewingMode=t??a.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,s){this.resetWithRay(e(t,r,this._ray),s)}resetWithRay(r,s){this.camera=s,r!==this._ray&&n(r,this._ray),0!==this.options.verticalOffset?this.viewingMode===a.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,t(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,s,i,e){this.point=r,this.filterPredicate=i,this.tolerance=s??_;const n=y(this.verticalOffset);if(t&&t.length>0){const r=e?t=>{e(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};for(const s of t){const t=s.getSpatialQueryAccelerator?.();null!=t?(null!=n?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,r,n):t.forEachAlongRay(this._ray.origin,this._ray.direction,r),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(r)):s.objects.forEach((t=>r(t)))}}this.sortResults()}intersectObject(t){const s=t.geometries;if(!s)return;const i=t.effectiveTransformation,e=y(this.verticalOffset);for(const n of s){if(!n.visible)continue;const{material:s,id:a}=n;if(!s.visible)continue;this.transform.setAndInvalidateLazyTransforms(i,n.transformation),r(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),r(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const o=this.transform.transform;null!=e&&(e.objectTransform=this.transform),s.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((r,s,i,e)=>this.handleObjectIntersection({object:t,geometryId:a,primitiveIndex:i},r,s,o,e)))}}handleObjectIntersection(t,r,s,i,e){if(r<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,r))return;const n=e?this._results.hud:this._results;t=e?new h(t,e):t;const a=e?i=>i.set(m.HUD,t,r,s):e=>e.set(m.OBJECT,t,r,s,i);if((null==n.min.distance||r<n.min.distance)&&a(n.min),this.options.store!==f.MIN&&(null==n.max.distance||r>n.max.distance)&&a(n.max),this.options.store===f.ALL)if(e){const t=new c(this._ray);a(t),this._results.hud.all.push(t)}else{const t=new d(this._ray);a(t),this._results.all.push(t)}}sortResults(t=this._results.all){t.sort(((t,r)=>t.distance!==r.distance?(t.distance??0)-(r.distance??0):t.drapedLayerOrder!==r.drapedLayerOrder?p(t.drapedLayerOrder,r.drapedLayerOrder):p(t.renderPriority,r.renderPriority)))}}function p(t,r){return(r??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}class O{constructor(){this.min=new d(i()),this.max=new d(i()),this.hud={min:new c(i()),max:new c(i()),all:new Array},this.ground=new d(i()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}export{g as Intersector,_ as defaultTolerance};\r\n"],
  "mappings": "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",
  "names": ["b", "i", "e", "n", "r", "t", "s", "E", "p"]
}
