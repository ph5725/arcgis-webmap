import {
  l
} from "./chunk-4QUGWCAY.js";
import {
  t
} from "./chunk-JHOESKXH.js";
import {
  j as j2
} from "./chunk-XMAXGUBN.js";
import {
  H,
  Ke,
  W,
  ae,
  ee,
  ie,
  ne,
  pe,
  q,
  re
} from "./chunk-Q7K6M7G6.js";
import "./chunk-EK343S5L.js";
import "./chunk-4J6GMCJZ.js";
import "./chunk-VZZR2ZMJ.js";
import {
  s as s2
} from "./chunk-YN3U6WZN.js";
import {
  e as e2,
  i,
  p,
  p2
} from "./chunk-O75YZHXO.js";
import {
  n as n2,
  p as p3
} from "./chunk-VOBFRSU5.js";
import "./chunk-NY6S6EMV.js";
import {
  a,
  r
} from "./chunk-AQGMTI4V.js";
import "./chunk-QG7JWSBW.js";
import "./chunk-6TS2ZJL4.js";
import "./chunk-IBGTNH54.js";
import "./chunk-ROVRMLYN.js";
import "./chunk-SYPTUUSZ.js";
import {
  K,
  O,
  k as k2
} from "./chunk-7NMH5MM5.js";
import "./chunk-TCIXF7MM.js";
import "./chunk-UGTICYU7.js";
import "./chunk-3MHRDLQO.js";
import {
  k
} from "./chunk-F4KXGA4J.js";
import "./chunk-EOMIFMDH.js";
import {
  c as c2,
  e,
  n,
  o
} from "./chunk-6QA2BVC5.js";
import "./chunk-RACDQ3AL.js";
import "./chunk-TEXTBDH7.js";
import "./chunk-N3A2BVTW.js";
import "./chunk-52HWRRRQ.js";
import "./chunk-VNTEV3V4.js";
import "./chunk-OGOQOMMV.js";
import "./chunk-7Z3AF3B2.js";
import "./chunk-6GWORUT3.js";
import "./chunk-FPSA4NFH.js";
import "./chunk-UY6B6IVT.js";
import {
  C
} from "./chunk-6PV45IYU.js";
import "./chunk-SRQCQD63.js";
import "./chunk-FIRNXFAH.js";
import "./chunk-O5TPFXRT.js";
import {
  S,
  c,
  j
} from "./chunk-Q6XRAGMA.js";
import "./chunk-JUAPMINU.js";
import {
  f
} from "./chunk-PK2ZR2SJ.js";
import "./chunk-YFPGM5UE.js";
import "./chunk-OXSERRAR.js";
import "./chunk-7HI4VRVW.js";
import "./chunk-ZX46THLM.js";
import "./chunk-Y2ZIOB7Y.js";
import "./chunk-KTUX3OKX.js";
import "./chunk-E3KEUGUG.js";
import "./chunk-N3XLUQJI.js";
import "./chunk-JUAD7TJ6.js";
import "./chunk-VHLUKPRH.js";
import "./chunk-5TPMG26T.js";
import "./chunk-3NBBZ43U.js";
import "./chunk-VOLWOTEG.js";
import "./chunk-XTNIDRTB.js";
import "./chunk-FGWIXJQY.js";
import "./chunk-TKYAZCMB.js";
import "./chunk-3TBMFSPB.js";
import "./chunk-PSZLDJJA.js";
import "./chunk-ZWFY3WY5.js";
import "./chunk-LQFTAGIV.js";
import "./chunk-S7IJH524.js";
import "./chunk-GZ2P4SCJ.js";
import "./chunk-XWG6QGFK.js";
import {
  s
} from "./chunk-GWNLQRNM.js";
import "./chunk-FXKORAMT.js";
import "./chunk-GNMFMITH.js";

// node_modules/@arcgis/core/arcade/functions/knowledgegraph.js
var N = null;
async function F(r2) {
  const t2 = s.geometryServiceUrl ?? "";
  if (!t2) {
    k2() || await K();
    for (const e3 of r2) e3.container[e3.indexer] = O(e3.container[e3.indexer], f.WGS84);
    return;
  }
  const n3 = r2.map((e3) => e3.container[e3.indexer]), o2 = new p3({ geometries: n3, outSpatialReference: f.WGS84 }), a2 = await n2(t2, o2);
  for (let e3 = 0; e3 < a2.length; e3++) {
    const t3 = r2[e3];
    t3.container[t3.indexer] = a2[e3];
  }
}
async function M(e3, r2) {
  const t2 = new k({ portal: e3, id: r2 });
  return await t2.load(), null === N && (N = await import("./knowledgeGraphService-NBZ2KFBM.js")), await N.fetchKnowledgeGraph(t2.url);
}
function Q(e3, r2, t2, n3, o2) {
  if (null === e3) return null;
  if (e(e3) || n(e3)) return e3;
  if (ne(e3)) return e3.toJSDate();
  if (ne(e3)) return e3.toJSDate();
  if (re(e3)) return e3.toStorageFormat();
  if (ie(e3)) return e3.toStorageString();
  if (W(e3)) {
    const a2 = {};
    for (const i2 of e3.keys()) a2[i2] = Q(e3.field(i2), r2, t2, n3, o2), a2[i2] instanceof c && o2.push({ container: a2, indexer: i2 });
    return a2;
  }
  if (o(e3)) {
    const a2 = e3.map((e4) => Q(e4, r2, t2, n3, o2));
    for (let e4 = 0; e4 < a2.length; e4++) a2[e4] instanceof c && o2.push({ container: a2, indexer: e4 });
    return a2;
  }
  return H(e3) ? e3.spatialReference.isWGS84 ? e3 : e3.spatialReference.isWebMercator && r2 ? S(e3) : e3 : void 0;
}
function B(e3, r2) {
  if (!e3) return e3;
  if (e3.spatialReference.isWGS84 && r2.spatialReference.isWebMercator) return j(e3);
  if (e3.spatialReference.equals(r2.spatialReference)) return e3;
  throw new a(r2, r.WrongSpatialReference, null);
}
function E(e3, r2) {
  if (!e3) return null;
  const t2 = {};
  for (const n3 in e3) t2[n3] = K2(e3[n3], r2);
  return t2;
}
function K2(e3, r2) {
  return null === e3 ? null : o(e3) ? e3.map((e4) => K2(e4, r2)) : e3 instanceof p ? { graphTypeName: e3.typeName, id: e3.id, graphType: "entity", properties: E(e3.properties, r2) } : e3 instanceof e2 ? { graphType: "object", properties: E(e3.properties, r2) } : e3 instanceof i ? { graphTypeName: e3.typeName, id: e3.id, graphType: "relationship", originId: e3.originId ?? null, destinationId: e3.destinationId ?? null, properties: E(e3.properties, r2) } : e3 instanceof p2 ? { graphType: "path", path: e3.path ? e3.path.map((e4) => K2(e4, r2)) : null } : H(e3) ? B(e3, r2) : e(e3) || n(e3) || c2(e3) ? e3 : null;
}
function V(e3) {
  "async" === e3.mode && (e3.functions.knowledgegraphbyportalitem = function(t2, s3) {
    return e3.standardFunctionAsync(t2, s3, (e4, p4, l2) => {
      if (ae(l2, 2, 2, t2, s3), null === l2[0]) throw new a(t2, r.PortalRequired, s3);
      if (l2[0] instanceof t) {
        const e5 = pe(l2[1]);
        let r2;
        r2 = t2.services?.portal ? t2.services.portal : C.getDefault();
        return M(l(l2[0], r2), e5);
      }
      if (false === e(l2[0])) throw new a(t2, r.InvalidParameter, s3);
      const c3 = pe(l2[0]);
      return M(t2.services?.portal ?? C.getDefault(), c3);
    });
  }, e3.signatures.push({ name: "knowledgegraphbyportalitem", min: 2, max: 2 }), e3.functions.querygraph = function(r2, i2) {
    return e3.standardFunctionAsync(r2, i2, async (e4, c3, f2) => {
      ae(f2, 2, 4, r2, i2);
      const u = f2[0];
      if (!ee(u)) throw new a(r2, r.InvalidParameter, i2);
      const m = f2[1];
      if (!e(m)) throw new a(r2, r.InvalidParameter, i2);
      null === N && (N = await import("./knowledgeGraphService-NBZ2KFBM.js"));
      let d = null;
      const h = q(f2[2], null);
      if (!(h instanceof j2 || null === h)) throw new a(r2, r.InvalidParameter, i2);
      if (h) {
        let e5 = [];
        d = Q(h, true, false, r2, e5), e5 = e5.filter((e6) => !e6.container[e6.indexer].spatialReference.isWGS84), e5.length > 0 && await F(e5);
      }
      const g = q(f2[3], false), w = new s2({ openCypherQuery: m, bindParameters: d, provenanceBehavior: g ? "include" : "exclude" });
      (u?.serviceDefinition?.currentVersion ?? 11.3) > 11.2 && (w.outputSpatialReference = r2.spatialReference);
      const y = (await N.executeQueryStreaming(u, w)).resultRowsStream.getReader(), j3 = [];
      try {
        for (; ; ) {
          const { done: e5, value: t2 } = await y.read();
          if (e5) break;
          if (o(t2)) for (const n3 of t2) j3.push(K2(n3, r2));
          else {
            const e6 = [];
            for (const n3 of t2) e6.push(K2(t2[n3], r2));
            j3.push(e6);
          }
        }
      } catch (S2) {
        throw S2;
      }
      return j2.convertJsonToArcade(j3, Ke(r2), false, true);
    });
  }, e3.signatures.push({ name: "querygraph", min: 2, max: 4 }));
}
export {
  V as registerFunctions
};
//# sourceMappingURL=knowledgegraph-3FOPTXAD.js.map
