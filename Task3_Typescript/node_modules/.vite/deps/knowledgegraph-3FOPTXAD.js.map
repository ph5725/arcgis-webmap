{
  "version": 3,
  "sources": ["../../@arcgis/core/arcade/functions/knowledgegraph.js"],
  "sourcesContent": ["/*\r\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\r\nSee https://js.arcgis.com/4.33/esri/copyright.txt for details.\r\n*/\r\nimport e from\"../../config.js\";import r from\"../ArcadePortal.js\";import t from\"../Dictionary.js\";import{ArcadeExecutionError as n,ExecutionErrorCodes as o}from\"../executionError.js\";import{B as a,w as i,o as s,J as p,K as l,e as c,f,g as u,n as m,h as d}from\"../../chunks/languageUtils.js\";import{getPortal as h}from\"../portalUtils.js\";import g from\"../../geometry/Geometry.js\";import{load as w,project as y,isLoaded as j}from\"../../geometry/projectionUtils.js\";import S from\"../../geometry/SpatialReference.js\";import{webMercatorToGeographic as v,geographicToWebMercator as R}from\"../../geometry/support/webMercatorUtils.js\";import G from\"../../portal/Portal.js\";import x from\"../../portal/PortalItem.js\";import{project as k}from\"../../rest/geometryService/project.js\";import P from\"../../rest/knowledgeGraph/Entity.js\";import b from\"../../rest/knowledgeGraph/GraphQueryStreaming.js\";import I from\"../../rest/knowledgeGraph/ObjectValue.js\";import W from\"../../rest/knowledgeGraph/Path.js\";import D from\"../../rest/knowledgeGraph/Relationship.js\";import T from\"../../rest/support/ProjectParameters.js\";import{isString as U,isArray as q,isNumber as A,isDate as J}from\"../../support/guards.js\";let N=null;async function F(r){const t=e.geometryServiceUrl??\"\";if(!t){j()||await w();for(const e of r)e.container[e.indexer]=y(e.container[e.indexer],S.WGS84);return}const n=r.map((e=>e.container[e.indexer])),o=new T({geometries:n,outSpatialReference:S.WGS84}),a=await k(t,o);for(let e=0;e<a.length;e++){const t=r[e];t.container[t.indexer]=a[e]}}async function M(e,r){const t=new x({portal:e,id:r});return await t.load(),null===N&&(N=await import(\"../../rest/knowledgeGraphService.js\")),await N.fetchKnowledgeGraph(t.url)}function Q(e,r,t,n,o){if(null===e)return null;if(U(e)||A(e))return e;if(c(e))return e.toJSDate();if(c(e))return e.toJSDate();if(f(e))return e.toStorageFormat();if(u(e))return e.toStorageString();if(m(e)){const a={};for(const i of e.keys())a[i]=Q(e.field(i),r,t,n,o),a[i]instanceof g&&o.push({container:a,indexer:i});return a}if(q(e)){const a=e.map((e=>Q(e,r,t,n,o)));for(let e=0;e<a.length;e++)a[e]instanceof g&&o.push({container:a,indexer:e});return a}return d(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&r?v(e):e:void 0}function B(e,r){if(!e)return e;if(e.spatialReference.isWGS84&&r.spatialReference.isWebMercator)return R(e);if(e.spatialReference.equals(r.spatialReference))return e;throw new n(r,o.WrongSpatialReference,null)}function E(e,r){if(!e)return null;const t={};for(const n in e)t[n]=K(e[n],r);return t}function K(e,r){return null===e?null:q(e)?e.map((e=>K(e,r))):e instanceof P?{graphTypeName:e.typeName,id:e.id,graphType:\"entity\",properties:E(e.properties,r)}:e instanceof I?{graphType:\"object\",properties:E(e.properties,r)}:e instanceof D?{graphTypeName:e.typeName,id:e.id,graphType:\"relationship\",originId:e.originId??null,destinationId:e.destinationId??null,properties:E(e.properties,r)}:e instanceof W?{graphType:\"path\",path:e.path?e.path.map((e=>K(e,r))):null}:d(e)?B(e,r):U(e)||A(e)||J(e)?e:null}function V(e){\"async\"===e.mode&&(e.functions.knowledgegraphbyportalitem=function(t,s){return e.standardFunctionAsync(t,s,((e,p,l)=>{if(a(l,2,2,t,s),null===l[0])throw new n(t,o.PortalRequired,s);if(l[0]instanceof r){const e=i(l[1]);let r;r=t.services?.portal?t.services.portal:G.getDefault();return M(h(l[0],r),e)}if(!1===U(l[0]))throw new n(t,o.InvalidParameter,s);const c=i(l[0]);return M(t.services?.portal??G.getDefault(),c)}))},e.signatures.push({name:\"knowledgegraphbyportalitem\",min:2,max:2}),e.functions.querygraph=function(r,i){return e.standardFunctionAsync(r,i,(async(e,c,f)=>{a(f,2,4,r,i);const u=f[0];if(!s(u))throw new n(r,o.InvalidParameter,i);const m=f[1];if(!U(m))throw new n(r,o.InvalidParameter,i);null===N&&(N=await import(\"../../rest/knowledgeGraphService.js\"));let d=null;const h=p(f[2],null);if(!(h instanceof t||null===h))throw new n(r,o.InvalidParameter,i);if(h){let e=[];d=Q(h,!0,!1,r,e),e=e.filter((e=>!e.container[e.indexer].spatialReference.isWGS84)),e.length>0&&await F(e)}const g=p(f[3],!1),w=new b({openCypherQuery:m,bindParameters:d,provenanceBehavior:g?\"include\":\"exclude\"});(u?.serviceDefinition?.currentVersion??11.3)>11.2&&(w.outputSpatialReference=r.spatialReference);const y=(await N.executeQueryStreaming(u,w)).resultRowsStream.getReader(),j=[];try{for(;;){const{done:e,value:t}=await y.read();if(e)break;if(q(t))for(const n of t)j.push(K(n,r));else{const e=[];for(const n of t)e.push(K(t[n],r));j.push(e)}}}catch(S){throw S}return t.convertJsonToArcade(j,l(r),!1,!0)}))},e.signatures.push({name:\"querygraph\",min:2,max:4}))}export{V as registerFunctions};\r\n"],
  "mappings": "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",
  "names": ["r", "t", "k", "e", "n", "o", "p", "a", "i", "K", "c", "s", "l", "f", "j", "S"]
}
