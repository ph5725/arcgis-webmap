{"version":3,"file":"developer-credentials.esm.js","sources":["../../src/shared/getRegisteredAppInfo.ts","../../src/shared/generateApiKeyToken.ts","../../src/shared/helpers.ts","../../src/shared/registerApp.ts","../../src/createApiKey.ts","../../src/updateApiKey.ts","../../src/getApiKey.ts","../../src/invalidateApiKey.ts","../../src/getOAuthApp.ts","../../src/updateOAuthApp.ts","../../src/createOAuthApp.ts","../../src/shared/unregisterApp.ts"],"sourcesContent":["/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"@esri/arcgis-rest-portal\";\n\nimport {\n  IRegisteredAppResponse,\n  IGetAppInfoOptions,\n  IApp\n} from \"./types/appType.js\";\nimport { registeredAppResponseToApp } from \"./helpers.js\";\n\n/**\n * Used to retrieve registered app info. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/registered-app-info.htm) for more information.\n *\n * ```js\n * import { getRegisteredAppInfo, IApp } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * getRegisteredAppInfo({\n *   itemId: \"xyz_itemId\",\n *   authentication: authSession\n * }).then((registeredApp: IApp) => {\n *   // => {client_id: \"xyz_id\", client_secret: \"xyz_secret\", ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode getRegisteredAppInfo | getRegisteredAppInfo()}, including an itemId of which app to retrieve and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IApp} object representing successfully retrieved app.\n */\nexport async function getRegisteredAppInfo(\n  requestOptions: IGetAppInfoOptions\n): Promise<IApp> {\n  const userName = await requestOptions.authentication.getUsername();\n  const url =\n    getPortalUrl(requestOptions) +\n    `/content/users/${userName}/items/${requestOptions.itemId}/registeredAppInfo`;\n  requestOptions.httpMethod = \"POST\";\n\n  const registeredAppResponse: IRegisteredAppResponse = await request(url, {\n    ...requestOptions,\n    params: { f: \"json\" }\n  });\n\n  return registeredAppResponseToApp(registeredAppResponse);\n}\n","import {\n  request,\n  IRequestOptions,\n  IAuthenticationManager\n} from \"@esri/arcgis-rest-request\";\nimport { getRegisteredAppInfo } from \"./getRegisteredAppInfo.js\";\nimport { getPortalUrl } from \"@esri/arcgis-rest-portal\";\n\nexport interface IGenerateApiKeyTokenOptions extends IRequestOptions {\n  itemId: string;\n  apiKey: 1 | 2;\n  portal?: string;\n  authentication: IAuthenticationManager;\n}\n\nexport async function generateApiKeyToken(\n  options: IGenerateApiKeyTokenOptions\n): Promise<{ access_token: string; expires_in: number }> {\n  const portal = getPortalUrl(options);\n  const url = `${portal}/oauth2/token`;\n\n  const appInfo = await getRegisteredAppInfo({\n    itemId: options.itemId,\n    authentication: options.authentication\n  });\n\n  const params = {\n    client_id: appInfo.client_id,\n    client_secret: appInfo.client_secret,\n    apiToken: options.apiKey,\n    regenerateApiToken: true,\n    grant_type: \"client_credentials\"\n  };\n\n  // authentication is not being passed to the request because client_secret acts as the auth\n  return request(url, {\n    params\n  });\n}\n","import {\n  IRequestOptions,\n  IAuthenticationManager\n} from \"@esri/arcgis-rest-request\";\nimport { IRegisteredAppResponse, IApp } from \"./types/appType.js\";\nimport { IApiKeyInfo } from \"./types/apiKeyType.js\";\nimport { IOAuthAppInfo } from \"./types/oAuthType.js\";\nimport { generateApiKeyToken } from \"./generateApiKeyToken.js\";\n\n/**\n * @internal\n * Encode special params value (e.g. array type...) in advance in order to make {@linkcode encodeParam} works correctly. Usage is case by case.\n */\nexport const stringifyArrays = (requestOptions: IRequestOptions) => {\n  Object.entries(requestOptions.params).forEach((entry) => {\n    const [key, value] = entry;\n    if (value.constructor.name === \"Array\") {\n      requestOptions.params[key] = JSON.stringify(value);\n    }\n  });\n};\n\n/**\n * @internal\n * Used to convert {@linkcode IRegisteredAppResponse} to {@linkcode IApp}.\n */\nexport function registeredAppResponseToApp(\n  response: IRegisteredAppResponse\n): IApp {\n  const omittedKeys = [\n    \"apnsProdCert\",\n    \"apnsSandboxCert\",\n    \"gcmApiKey\",\n    \"isBeta\",\n    \"customAppLoginShowTriage\"\n  ];\n  const dateKeys = [\"modified\", \"registered\"];\n\n  return Object.keys(response)\n    .filter((key) => !omittedKeys.includes(key))\n    .reduce((obj: any, key) => {\n      if (dateKeys.includes(key)) {\n        obj[key] = new Date((response as any)[key]);\n      } else {\n        obj[key] = (response as any)[key];\n      }\n      return obj;\n    }, {});\n}\n\n/**\n * @internal\n * Used to convert {@linkcode IApp} to {@linkcode IApiKeyInfo} only if `appType` is \"apikey\".\n */\nexport function appToApiKeyProperties(response: IApp): IApiKeyInfo {\n  delete response.client_secret;\n  delete response.redirect_uris;\n  delete response.appType;\n  delete (response as any).customAppLoginShowTriage;\n  delete response.apiKey;\n\n  return response as IApiKeyInfo;\n}\n\n/**\n * @internal\n * Used to convert {@linkcode IApp} to {@linkcode IOAuthAppInfo}.\n */\nexport function appToOAuthAppProperties(response: IApp): IOAuthAppInfo {\n  delete response.appType;\n  delete response.httpReferrers;\n  delete response.privileges;\n  delete response.apiKey;\n  delete (response as any).customAppLoginShowTriage;\n  delete response.isPersonalAPIToken;\n  delete response.apiToken1Active;\n  delete response.apiToken2Active;\n\n  return response as IOAuthAppInfo;\n}\n\n/**\n * @internal\n * Used to extract base request options from a hybrid option and exclude `params` and `authentication`.\n */\nexport function extractBaseRequestOptions<T extends IRequestOptions>(\n  options: T\n): Partial<IRequestOptions> {\n  const requestOptionsProperties: Array<keyof T> = [\n    \"credentials\",\n    \"headers\",\n    \"hideToken\",\n    \"httpMethod\",\n    \"maxUrlLength\",\n    \"portal\",\n    \"rawResponse\",\n    \"signal\",\n    \"suppressWarnings\"\n  ];\n\n  return filterKeys(options, requestOptionsProperties);\n}\n\n/**\n * @internal\n * Used to create a new object including only specified keys from another object.\n */\nexport function filterKeys<T extends object>(\n  object: T,\n  includedKeys: Array<keyof T>\n): any {\n  return includedKeys.reduce(\n    (obj: { [key: string | number | symbol]: any }, ele) => {\n      if (ele in object) {\n        obj[ele] = object[ele];\n      }\n      return obj;\n    },\n    {}\n  );\n}\n\n/**\n * Used to determine if a generated key is in slot 1 or slot 2 key. The full API key should be passed. `undefined` will be returned if the proper slot could not be identified.\n */\nexport function slotForKey(key: string) {\n  const slot = parseInt(key.substring(key.length - 10, key.length - 9));\n\n  if (slot === 1 || slot === 2) {\n    return slot;\n  }\n\n  return undefined;\n}\n\n/**\n * @internal\n * Used to determine which slot to invalidate a key in given a number or a full or patial key.\n */\nexport function slotForInvalidationKey(param: string | 1 | 2) {\n  if (param === 1 || param === 2) {\n    return param;\n  }\n\n  if (typeof param !== \"string\") {\n    return undefined;\n  }\n\n  const fullKeySlot = slotForKey(param);\n  if (fullKeySlot) {\n    return fullKeySlot;\n  }\n}\n\ninterface IGenerateApiKeyTokenOptions extends IRequestOptions {\n  authentication: IAuthenticationManager;\n}\n\n/**\n * @internal\n * Used to generate tokens in slot 1 and/or 2 of an API key.\n */\nexport function generateApiKeyTokens(\n  itemId: string,\n  slots: Array<1 | 2>,\n  requestOptions: IGenerateApiKeyTokenOptions\n) {\n  return Promise.all(\n    slots.map((slot) => {\n      return generateApiKeyToken({\n        itemId,\n        apiKey: slot,\n        ...requestOptions\n      });\n    })\n  ).then((responses) => {\n    return responses\n      .map((responses) => responses.access_token)\n      .reduce((obj, token, index) => {\n        obj[`accessToken${slotForKey(token)}`] = token;\n        return obj;\n      }, {} as { [key: string]: string });\n  });\n}\n\n/**\n * @internal\n * Convert boolean flags to an array of slots for {@linkcode generateApiKeyTokens}.\n */\nexport function generateOptionsToSlots(\n  generateToken1: boolean,\n  generateToken2: boolean\n): Array<1 | 2> {\n  const slots: Array<1 | 2> = [];\n  if (generateToken1) {\n    slots.push(1);\n  }\n  if (generateToken2) {\n    slots.push(2);\n  }\n  return slots;\n}\n\ntype expirationDateParams =\n  | {\n      apiToken1ExpirationDate: Date | -1;\n      apiToken2ExpirationDate: Date | -1;\n    }\n  | {\n      apiToken1ExpirationDate: Date | -1;\n    }\n  | {\n      apiToken2ExpirationDate: Date | -1;\n    }\n  | {};\n\n/**\n * @internal\n * Build params for updating expiration dates\n */\nexport function buildExpirationDateParams(\n  requestOptions: {\n    apiToken1ExpirationDate?: Date;\n    apiToken2ExpirationDate?: Date;\n  },\n  fillDefaults?: boolean\n): expirationDateParams {\n  const updateparams: any = {};\n  if (requestOptions.apiToken1ExpirationDate) {\n    updateparams.apiToken1ExpirationDate =\n      requestOptions.apiToken1ExpirationDate;\n  }\n\n  if (requestOptions.apiToken2ExpirationDate) {\n    updateparams.apiToken2ExpirationDate =\n      requestOptions.apiToken2ExpirationDate;\n  }\n\n  if (fillDefaults && !updateparams.apiToken1ExpirationDate) {\n    updateparams.apiToken1ExpirationDate = -1;\n  }\n\n  if (fillDefaults && !updateparams.apiToken2ExpirationDate) {\n    updateparams.apiToken2ExpirationDate = -1;\n  }\n  return updateparams;\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"@esri/arcgis-rest-portal\";\nimport {\n  IApp,\n  IRegisterAppOptions,\n  IRegisteredAppResponse\n} from \"./types/appType.js\";\nimport { stringifyArrays, registeredAppResponseToApp } from \"./helpers.js\";\n\n/**\n * Used to register an app. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/register-app.htm) for more information.\n *\n * Accepted app types:\n * - apikey\n * - multiple\n * - browser\n * - server\n * - native\n *\n * ```js\n * import { registerApp, IApp } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * registerApp({\n *   itemId: \"xyz_itemId\",\n *   appType: \"multiple\",\n *   redirect_uris: [\"http://localhost:3000/\"],\n *   httpReferrers: [\"http://localhost:3000/\"],\n *   privileges: [\"premium:user:geocode:temporary\", Privileges.FeatureReport],\n *   authentication: authSession\n * }).then((registeredApp: IApp) => {\n *   // => {client_id: \"xyz_id\", client_secret: \"xyz_secret\", ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode registerApp | registerApp()}, including necessary params to register an app and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IApp} object representing the newly registered app.\n */\nexport async function registerApp(\n  requestOptions: IRegisterAppOptions\n): Promise<IApp> {\n  // build params\n  const options = appendCustomParams(requestOptions, [\n    \"itemId\",\n    \"appType\",\n    \"redirect_uris\",\n    \"httpReferrers\",\n    \"privileges\"\n  ]);\n  // encode special params value (e.g. array type...) in advance in order to make encodeQueryString() works correctly\n  stringifyArrays(options);\n\n  const url = getPortalUrl(options) + \"/oauth2/registerApp\";\n  options.httpMethod = \"POST\";\n  options.params.f = \"json\";\n\n  const registeredAppResponse: IRegisteredAppResponse = await request(\n    url,\n    options\n  );\n\n  return registeredAppResponseToApp(registeredAppResponse);\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  ICreateItemOptions,\n  createItem,\n  getItem,\n  IItemAdd,\n  updateItem\n} from \"@esri/arcgis-rest-portal\";\nimport {\n  IApiKeyResponse,\n  ICreateApiKeyOptions\n} from \"./shared/types/apiKeyType.js\";\n\nimport { registerApp } from \"./shared/registerApp.js\";\nimport { IRegisterAppOptions } from \"./shared/types/appType.js\";\nimport {\n  appToApiKeyProperties,\n  filterKeys,\n  extractBaseRequestOptions,\n  generateApiKeyTokens,\n  generateOptionsToSlots,\n  buildExpirationDateParams\n} from \"./shared/helpers.js\";\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\n\n/**\n * Used to register an API key. See the [security and authentication](https://developers.arcgis.com/documentation/mapping-apis-and-services/security/api-keys/) for more information about API key.\n *\n * ```js\n * import { createApiKey, IApiKeyResponse } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * const threeDaysFromToday = new Date();\n * threeDaysFromToday.setDate(threeDaysFromToday.getDate() + 3);\n * threeDaysFromToday.setHours(23, 59, 59, 999);\n *\n * createApiKey({\n *   title: \"xyz_title\",\n *   description: \"xyz_desc\",\n *   tags: [\"xyz_tag1\", \"xyz_tag2\"],\n *   privileges: [\"premium:user:networkanalysis:routing\"],\n *   authentication: authSession,\n *   generateToken1: true, // optional,generate a new token\n *   apiToken1ExpirationDate: threeDaysFromToday  // optional, update expiration date\n * }).then((registeredAPIKey: IApiKeyResponse) => {\n *   // => {accessToken1: \"xyz_key\", item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode createApiKey | createApiKey()}, including necessary params to register an API key and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IApiKeyResponse} object representing the newly registered API key.\n */\nexport async function createApiKey(\n  requestOptions: ICreateApiKeyOptions\n): Promise<IApiKeyResponse> {\n  requestOptions.httpMethod = \"POST\";\n\n  // filter param buckets:\n  const baseRequestOptions = extractBaseRequestOptions(requestOptions); // snapshot of basic IRequestOptions before customized params being built into it\n\n  const itemAddProperties: Array<keyof IItemAdd> = [\n    \"categories\",\n    \"culture\",\n    \"description\",\n    \"documentation\",\n    \"extent\",\n    \"owner\",\n    \"properties\",\n    \"snippet\",\n    \"spatialReference\",\n    \"tags\",\n    \"title\",\n    \"type\",\n    \"typeKeywords\",\n    \"url\"\n  ];\n\n  /**\n   * step 1: create item\n   */\n  const createItemOption: ICreateItemOptions = {\n    item: {\n      ...filterKeys(requestOptions as any, itemAddProperties),\n      type: \"Application\"\n    },\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: {\n      f: \"json\"\n    }\n  };\n\n  const createItemResponse = await createItem(createItemOption);\n\n  /**\n   * getRegisteredAppInfoRoute\n   */\n  const registerAppOptions: IRegisterAppOptions = {\n    itemId: createItemResponse.id,\n    appType: \"multiple\",\n    redirect_uris: [\"urn:ietf:wg:oauth:2.0:oob\"],\n    httpReferrers: requestOptions.httpReferrers || [],\n    privileges: requestOptions.privileges,\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication\n  };\n\n  const registeredAppResponse = await registerApp(registerAppOptions);\n\n  /**\n   * step 3: update item with desired expiration dates\n   * you cannot set the expiration date propierties until you\n   * regiester the app so this has to be a seperate step\n   */\n  await updateItem({\n    ...baseRequestOptions,\n    item: {\n      id: createItemResponse.id,\n      ...buildExpirationDateParams(requestOptions, true)\n    },\n    authentication: requestOptions.authentication\n  });\n\n  /*\n   * step 4: get item info\n   */\n  const itemInfo = await getItem(registeredAppResponse.itemId, {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: { f: \"json\" }\n  });\n\n  /**\n   * step 5: generate tokens if requested\n   */\n  const generatedTokens = await generateApiKeyTokens(\n    itemInfo.id,\n    generateOptionsToSlots(\n      requestOptions.generateToken1,\n      requestOptions.generateToken2\n    ),\n    {\n      ...baseRequestOptions,\n      authentication: requestOptions.authentication\n    }\n  );\n\n  /**\n   * step 6: get registered app info to get updated active key status\n   */\n  const updatedRegisteredAppResponse = await getRegisteredAppInfo({\n    ...baseRequestOptions,\n    itemId: itemInfo.id,\n    authentication: requestOptions.authentication\n  });\n\n  return {\n    ...generatedTokens,\n    ...appToApiKeyProperties(updatedRegisteredAppResponse),\n    item: itemInfo\n  };\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  IApiKeyResponse,\n  IUpdateApiKeyOptions\n} from \"./shared/types/apiKeyType.js\";\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\nimport {\n  appToApiKeyProperties,\n  extractBaseRequestOptions,\n  stringifyArrays,\n  registeredAppResponseToApp,\n  generateApiKeyTokens,\n  generateOptionsToSlots,\n  buildExpirationDateParams\n} from \"./shared/helpers.js\";\nimport { getItem, getPortalUrl, updateItem } from \"@esri/arcgis-rest-portal\";\nimport { appendCustomParams, request } from \"@esri/arcgis-rest-request\";\nimport {\n  IApp,\n  IGetAppInfoOptions,\n  IRegisteredAppResponse\n} from \"./shared/types/appType.js\";\n\n/**\n * Used to update an API key.\n *\n * Notes about `privileges` and `httpReferrers` options:\n * 1. Provided option will override corresponding old option.\n * 2. Unprovided option will not trigger corresponding option updates.\n *\n * ```js\n * import { updateApiKey, IApiKeyResponse } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * const threeDaysFromToday = new Date();\n * threeDaysFromToday.setDate(threeDaysFromToday.getDate() + 3);\n * threeDaysFromToday.setHours(23, 59, 59, 999);\n *\n * updateApiKey({\n *   itemId: \"xyz_itemId\",\n *   privileges: [\"premium:user:geocode:temporary\"],\n *   httpReferrers: [], // httpReferrers will be set to be empty\n *   authentication: authSession\n *   generateToken1: true, // optional,generate a new token\n *   apiToken1ExpirationDate: threeDaysFromToday  // optional, update expiration date\n * }).then((updatedAPIKey: IApiKeyResponse) => {\n *   // => {accessToken1: \"xyz_key\", item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode updateApiKey | updateApiKey()}, including `itemId` of which API key to be operated on, optional new `privileges`, optional new `httpReferrers` and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IApiKeyResponse} object representing updated API key.\n */\nexport async function updateApiKey(\n  requestOptions: IUpdateApiKeyOptions\n): Promise<IApiKeyResponse> {\n  requestOptions.httpMethod = \"POST\";\n  const baseRequestOptions = extractBaseRequestOptions(requestOptions); // get base requestOptions snapshot\n\n  /**\n   * step 1: update expiration dates if provided. Build the object up to avoid overwriting any existing properties.\n   */\n  if (\n    requestOptions.apiToken1ExpirationDate ||\n    requestOptions.apiToken2ExpirationDate\n  ) {\n    const updateParams = buildExpirationDateParams(requestOptions);\n    await updateItem({\n      ...baseRequestOptions,\n      item: {\n        id: requestOptions.itemId,\n        ...updateParams\n      },\n      authentication: requestOptions.authentication\n    });\n  }\n\n  /**\n   * step 2: update privileges and httpReferrers if provided. Build the object up to avoid overwriting any existing properties.\n   */\n  if (requestOptions.privileges || requestOptions.httpReferrers) {\n    const getAppOption: IGetAppInfoOptions = {\n      ...baseRequestOptions,\n      authentication: requestOptions.authentication,\n      itemId: requestOptions.itemId\n    };\n    const appResponse = await getRegisteredAppInfo(getAppOption);\n    const clientId = appResponse.client_id;\n    const options = appendCustomParams(\n      { ...appResponse, ...requestOptions }, // object with the custom params to look in\n      [\"privileges\", \"httpReferrers\"] // keys you want copied to the params object\n    );\n    options.params.f = \"json\";\n\n    // encode special params value (e.g. array type...) in advance in order to make encodeQueryString() works correctly\n    stringifyArrays(options);\n\n    const url = getPortalUrl(options) + `/oauth2/apps/${clientId}/update`;\n\n    // Raw response from `/oauth2/apps/${clientId}/update`, apiKey not included because key is same.\n    const updateResponse: IRegisteredAppResponse = await request(url, {\n      ...options,\n      authentication: requestOptions.authentication\n    });\n  }\n\n  /**\n   * step 3: get the updated item info to return to the user.\n   */\n  const updatedItemInfo = await getItem(requestOptions.itemId, {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: { f: \"json\" }\n  });\n\n  /**\n   * step 4: generate tokens if requested\n   */\n  const generatedTokens = await generateApiKeyTokens(\n    requestOptions.itemId,\n    generateOptionsToSlots(\n      requestOptions.generateToken1,\n      requestOptions.generateToken2\n    ),\n    {\n      ...baseRequestOptions,\n      authentication: requestOptions.authentication\n    }\n  );\n\n  /**\n   * step 5: get updated registered app info\n   */\n  const updatedRegisteredAppResponse = await getRegisteredAppInfo({\n    ...baseRequestOptions,\n    itemId: requestOptions.itemId,\n    authentication: requestOptions.authentication\n  });\n\n  return {\n    ...generatedTokens,\n    ...appToApiKeyProperties(updatedRegisteredAppResponse),\n    item: updatedItemInfo\n  };\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\nimport {\n  IApiKeyResponse,\n  IGetApiKeyOptions\n} from \"./shared/types/apiKeyType.js\";\nimport { getItem } from \"@esri/arcgis-rest-portal\";\nimport {\n  appToApiKeyProperties,\n  extractBaseRequestOptions\n} from \"./shared/helpers.js\";\n\n/**\n * Used to retrieve the API key with given `itemId`. See the [security and authentication](https://developers.arcgis.com/documentation/mapping-apis-and-services/security/api-keys/) for more information about API key.\n *\n * ```js\n * import { getApiKey, IApiKeyResponse } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * getApiKey({\n *   itemId: \"xyz_itemId\",\n *   authentication: authSession\n * }).then((retrievedAPIKey: IApiKeyResponse) => {\n *   // => {apiKey: \"xyz_key\", item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode getApiKey | getApiKey()}, including `itemId` of which API key to retrieve and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IApiKeyResponse} object representing successfully retrieved API key.\n */\nexport async function getApiKey(\n  requestOptions: IGetApiKeyOptions\n): Promise<IApiKeyResponse> {\n  const appResponse = await getRegisteredAppInfo(requestOptions);\n\n  const itemInfo = await getItem(requestOptions.itemId, {\n    ...extractBaseRequestOptions(requestOptions),\n    authentication: requestOptions.authentication\n  });\n\n  return {\n    ...appToApiKeyProperties(appResponse),\n    item: itemInfo\n  };\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  IInvalidateApiKeyOptions,\n  IInvalidateApiKeyResponse\n} from \"./shared/types/apiKeyType.js\";\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\nimport { getPortalUrl } from \"@esri/arcgis-rest-portal\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { slotForInvalidationKey } from \"./shared/helpers.js\";\n\n/**\n * Used to invalidate an API key.\n *\n * ```js\n * import { invalidateApiKey } from \"@esri/arcgis-rest-developer-credentials\";\n *\n * invalidateApiKey({\n *   itemId: ITEM_ID,\n *   authentication,\n *   apiKey: 1, // invalidate the key in slot 1\n * }).then((response) => {\n *   // => {success: true}\n * }).catch(e => {\n *   // => an exception object\n * });\n */\nexport async function invalidateApiKey(\n  requestOptions: IInvalidateApiKeyOptions\n): Promise<IInvalidateApiKeyResponse> {\n  const portal = getPortalUrl(requestOptions);\n  const url = `${portal}/oauth2/revokeToken`;\n\n  const appInfo = await getRegisteredAppInfo({\n    itemId: requestOptions.itemId,\n    authentication: requestOptions.authentication\n  });\n\n  const params = {\n    client_id: appInfo.client_id,\n    client_secret: appInfo.client_secret,\n    apiToken: slotForInvalidationKey(requestOptions.apiKey),\n    regenerateApiToken: true,\n    grant_type: \"client_credentials\"\n  };\n\n  // authentication is not being passed to the request because client_secret acts as the auth\n  return request(url, {\n    params\n  });\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\nimport { getItem } from \"@esri/arcgis-rest-portal\";\nimport {\n  appToOAuthAppProperties,\n  extractBaseRequestOptions\n} from \"./shared/helpers.js\";\nimport { IGetOAuthAppOptions, IOAuthApp } from \"./shared/types/oAuthType.js\";\n\n/**\n * Used to retrieve the OAuth2.0 app with given `itemId`. See the [OAuth2.0](https://developers.arcgis.com/documentation/mapping-apis-and-services/security/oauth-2.0/) for more information.\n *\n * ```js\n * import { getOAuthApp, IOAuthApp } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * getOAuthApp({\n *   itemId: \"xyz_itemId\",\n *   authentication: authSession\n * }).then((retrievedOAuthApp: IOAuthApp) => {\n *   // => {redirect_uris: [\"http://localhost:3000/\"], item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode getOAuthApp | getOAuthApp()}, including `itemId` of which OAuth app to retrieve and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IOAuthApp} object representing successfully retrieved OAuth app.\n */\nexport async function getOAuthApp(\n  requestOptions: IGetOAuthAppOptions\n): Promise<IOAuthApp> {\n  const appResponse = await getRegisteredAppInfo(requestOptions);\n\n  const itemInfo = await getItem(requestOptions.itemId, {\n    ...extractBaseRequestOptions(requestOptions),\n    authentication: requestOptions.authentication\n  });\n\n  return {\n    ...appToOAuthAppProperties(appResponse),\n    item: itemInfo\n  };\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  extractBaseRequestOptions,\n  stringifyArrays,\n  registeredAppResponseToApp,\n  appToOAuthAppProperties\n} from \"./shared/helpers.js\";\nimport { getItem, getPortalUrl } from \"@esri/arcgis-rest-portal\";\nimport { appendCustomParams, request } from \"@esri/arcgis-rest-request\";\nimport {\n  IApp,\n  IGetAppInfoOptions,\n  IRegisteredAppResponse\n} from \"./shared/types/appType.js\";\nimport { IOAuthApp, IUpdateOAuthOptions } from \"./shared/types/oAuthType.js\";\nimport { getRegisteredAppInfo } from \"./shared/getRegisteredAppInfo.js\";\n\n/**\n * Used to update an OAuth2.0 app.\n *\n * Notes about `redirect_uris` options:\n * 1. Provided option will override corresponding old option.\n * 2. Unprovided option will not trigger corresponding option updates.\n *\n * ```js\n * import { updateOAuthApp, IOAuthApp } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * updateOAuthApp({\n *   itemId: \"xyz_itemId\",\n *   authentication: authSession\n * }).then((updatedOAuthApp: IOAuthApp) => {\n *   // => This OAuth app will be not be updated because its redirect_uris is not provided.\n *   // => {redirect_uris: [\"http://localhost:3000/\"], item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode updateOAuthApp | updateOAuthApp()}, including `itemId` of which OAuth app to be operated on, optional new `redirect_uris` and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IOAuthApp} object representing updated OAuth app.\n */\nexport async function updateOAuthApp(\n  requestOptions: IUpdateOAuthOptions\n): Promise<IOAuthApp> {\n  requestOptions.httpMethod = \"POST\";\n\n  // get app\n  const baseRequestOptions = extractBaseRequestOptions(requestOptions); // get base requestOptions snapshot\n  const getAppOption: IGetAppInfoOptions = {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    itemId: requestOptions.itemId\n  };\n\n  const appResponse = await getRegisteredAppInfo(getAppOption);\n\n  if (appResponse.appType === \"apikey\") {\n    throw new Error(\"Item is not an OAuth 2.0 app.\");\n  }\n\n  const clientId = appResponse.client_id;\n  const options = appendCustomParams({ ...appResponse, ...requestOptions }, [\n    \"redirect_uris\"\n  ]);\n  options.params.f = \"json\";\n  options.params.appType = \"multiple\";\n\n  // encode special params value (e.g. array type...) in advance in order to make encodeQueryString() works correctly\n  stringifyArrays(options);\n\n  const url = getPortalUrl(options) + `/oauth2/apps/${clientId}/update`;\n\n  // Raw response from `/oauth2/apps/${clientId}/update`.\n  const updateResponse: IRegisteredAppResponse = await request(url, {\n    ...options,\n    authentication: requestOptions.authentication\n  });\n\n  const app: IApp = registeredAppResponseToApp(updateResponse);\n\n  const itemInfo = await getItem(requestOptions.itemId, {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: { f: \"json\" }\n  });\n\n  return {\n    ...appToOAuthAppProperties(app),\n    item: itemInfo\n  };\n}\n","/* Copyright (c) 2023 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  ICreateItemOptions,\n  createItem,\n  getItem,\n  IItemAdd\n} from \"@esri/arcgis-rest-portal\";\n\nimport { registerApp } from \"./shared/registerApp.js\";\nimport { IRegisterAppOptions } from \"./shared/types/appType.js\";\nimport {\n  filterKeys,\n  extractBaseRequestOptions,\n  appToOAuthAppProperties\n} from \"./shared/helpers.js\";\nimport { ICreateOAuthAppOption, IOAuthApp } from \"./shared/types/oAuthType.js\";\n\n/**\n * Used to register an OAuth2.0 app. See the [OAuth2.0](https://developers.arcgis.com/documentation/mapping-apis-and-services/security/oauth-2.0/) for more information.\n *\n * ```js\n * import { createOAuthApp, IOAuthApp } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * createOAuthApp({\n *   title: \"xyz_title\",\n *   description: \"xyz_desc\",\n *   tags: [\"xyz_tag1\", \"xyz_tag2\"],\n *   redirect_uris: [\"http://localhost:3000/\"],\n *   authentication: authSession\n * }).then((registeredOAuthApp: IOAuthApp) => {\n *   // => {redirect_uris: [\"http://localhost:3000/\"], item: {tags: [\"xyz_tag1\", \"xyz_tag2\"], ...}, ...}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode createOAuthApp | createOAuthApp()}, including necessary params to register an OAuth app and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IOAuthApp} object representing the newly registered OAuth app.\n */\nexport async function createOAuthApp(\n  requestOptions: ICreateOAuthAppOption\n): Promise<IOAuthApp> {\n  requestOptions.httpMethod = \"POST\";\n\n  // filter param buckets:\n\n  const baseRequestOptions = extractBaseRequestOptions(requestOptions);\n\n  const itemAddProperties: Array<keyof IItemAdd> = [\n    \"categories\",\n    \"culture\",\n    \"description\",\n    \"documentation\",\n    \"extent\",\n    \"owner\",\n    \"properties\",\n    \"snippet\",\n    \"spatialReference\",\n    \"tags\",\n    \"title\",\n    \"type\",\n    \"typeKeywords\",\n    \"url\"\n  ];\n\n  // step 1: add item\n  const createItemOption: ICreateItemOptions = {\n    item: {\n      ...filterKeys(requestOptions as any, itemAddProperties),\n      type: \"Application\"\n    },\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: {\n      f: \"json\"\n    }\n  };\n\n  const createItemResponse = await createItem(createItemOption);\n\n  // step 2: register app\n  const registerAppOption: IRegisterAppOptions = {\n    itemId: createItemResponse.id,\n    appType: \"multiple\",\n    redirect_uris: requestOptions.redirect_uris || [],\n    httpReferrers: [],\n    privileges: [],\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication\n  };\n\n  const registeredAppResponse = await registerApp(registerAppOption);\n  const itemInfo = await getItem(registeredAppResponse.itemId, {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: { f: \"json\" }\n  });\n\n  return {\n    ...appToOAuthAppProperties(registeredAppResponse),\n    item: itemInfo\n  };\n}\n","import {\n  IGetAppInfoOptions,\n  IUnregisterAppOptions,\n  IUnregisterAppResponse\n} from \"./types/appType.js\";\nimport { extractBaseRequestOptions } from \"./helpers.js\";\nimport { getRegisteredAppInfo } from \"./getRegisteredAppInfo.js\";\nimport { getPortalUrl } from \"@esri/arcgis-rest-portal\";\nimport { request } from \"@esri/arcgis-rest-request\";\n\n/**\n * Used to unregister the app with given `itemId`. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unregister-app.htm) for more information.\n *\n * ```js\n * import { unregisterApp, IUnregisterAppResponse } from '@esri/arcgis-rest-developer-credentials';\n * import { ArcGISIdentityManager } from \"@esri/arcgis-rest-request\";\n *\n * const authSession: ArcGISIdentityManager = await ArcGISIdentityManager.signIn({\n *   username: \"xyz_usrName\",\n *   password: \"xyz_pw\"\n * });\n *\n * unregisterApp({\n *   itemId: \"xyz_itemId\",\n *   authentication: authSession\n * }).then((unregisteredApp: IUnregisterAppResponse) => {\n *   // => {itemId: \"xyz_itemId\", success: true}\n * }).catch(e => {\n *   // => an exception object\n * });\n * ```\n *\n * @param requestOptions - Options for {@linkcode unregisterApp | unregisterApp()}, including `itemId` of which app to be un-registered and an {@linkcode ArcGISIdentityManager} authentication session.\n * @returns A Promise that will resolve to an {@linkcode IUnregisterAppResponse} object representing un-registration status.\n */\nexport async function unregisterApp(\n  requestOptions: IUnregisterAppOptions\n): Promise<IUnregisterAppResponse> {\n  requestOptions.httpMethod = \"POST\";\n\n  // get app\n  const baseRequestOptions = extractBaseRequestOptions(requestOptions);\n  const getAppOption: IGetAppInfoOptions = {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    itemId: requestOptions.itemId\n  };\n\n  const appResponse = await getRegisteredAppInfo(getAppOption);\n\n  const clientId = appResponse.client_id;\n\n  const url =\n    getPortalUrl(requestOptions) + `/oauth2/apps/${clientId}/unregister`;\n\n  const unregisterAppResponse: IUnregisterAppResponse = await request(url, {\n    ...baseRequestOptions,\n    authentication: requestOptions.authentication,\n    params: { f: \"json\" }\n  });\n  return unregisterAppResponse;\n}\n"],"names":[],"mappings":"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"}