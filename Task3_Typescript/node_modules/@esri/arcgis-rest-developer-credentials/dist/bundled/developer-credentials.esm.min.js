/* @preserve
* @esri/arcgis-rest-developer-credentials - v2.0.0 - Apache-2.0
* Copyright (c) 2017-2025 Esri, Inc.
* Wed Feb 26 2025 22:10:42 GMT+0000 (Coordinated Universal Time)
*/
import{getPortalUrl as t,createItem as e,updateItem as i,getItem as n}from"@esri/arcgis-rest-portal";import{request as a,appendCustomParams as s}from"@esri/arcgis-rest-request";async function c(e){const i=await e.authentication.getUsername(),n=t(e)+`/content/users/${i}/items/${e.itemId}/registeredAppInfo`;e.httpMethod="POST";return r(await a(n,Object.assign(Object.assign({},e),{params:{f:"json"}})))}const o=t=>{Object.entries(t.params).forEach((e=>{const[i,n]=e;"Array"===n.constructor.name&&(t.params[i]=JSON.stringify(n))}))};function r(t){const e=["apnsProdCert","apnsSandboxCert","gcmApiKey","isBeta","customAppLoginShowTriage"],i=["modified","registered"];return Object.keys(t).filter((t=>!e.includes(t))).reduce(((e,n)=>(i.includes(n)?e[n]=new Date(t[n]):e[n]=t[n],e)),{})}function p(t){return delete t.client_secret,delete t.redirect_uris,delete t.appType,delete t.customAppLoginShowTriage,delete t.apiKey,t}function u(t){return delete t.appType,delete t.httpReferrers,delete t.privileges,delete t.apiKey,delete t.customAppLoginShowTriage,delete t.isPersonalAPIToken,delete t.apiToken1Active,delete t.apiToken2Active,t}function g(t){return h(t,["credentials","headers","hideToken","httpMethod","maxUrlLength","portal","rawResponse","signal","suppressWarnings"])}function h(t,e){return e.reduce(((e,i)=>(i in t&&(e[i]=t[i]),e)),{})}function d(t){const e=parseInt(t.substring(t.length-10,t.length-9));if(1===e||2===e)return e}function j(t){if(1===t||2===t)return t;if("string"!=typeof t)return;const e=d(t);return e||void 0}function O(e,i,n){return Promise.all(i.map((i=>async function(e){const i=`${t(e)}/oauth2/token`,n=await c({itemId:e.itemId,authentication:e.authentication}),s={client_id:n.client_id,client_secret:n.client_secret,apiToken:e.apiKey,regenerateApiToken:!0,grant_type:"client_credentials"};return a(i,{params:s})}(Object.assign({itemId:e,apiKey:i},n))))).then((t=>t.map((t=>t.access_token)).reduce(((t,e,i)=>(t[`accessToken${d(e)}`]=e,t)),{})))}function b(t,e){const i=[];return t&&i.push(1),e&&i.push(2),i}function m(t,e){const i={};return t.apiToken1ExpirationDate&&(i.apiToken1ExpirationDate=t.apiToken1ExpirationDate),t.apiToken2ExpirationDate&&(i.apiToken2ExpirationDate=t.apiToken2ExpirationDate),e&&!i.apiToken1ExpirationDate&&(i.apiToken1ExpirationDate=-1),e&&!i.apiToken2ExpirationDate&&(i.apiToken2ExpirationDate=-1),i}async function l(e){const i=s(e,["itemId","appType","redirect_uris","httpReferrers","privileges"]);o(i);const n=t(i)+"/oauth2/registerApp";i.httpMethod="POST",i.params.f="json";return r(await a(n,i))}async function f(t){t.httpMethod="POST";const a=g(t),s=Object.assign(Object.assign({item:Object.assign(Object.assign({},h(t,["categories","culture","description","documentation","extent","owner","properties","snippet","spatialReference","tags","title","type","typeKeywords","url"])),{type:"Application"})},a),{authentication:t.authentication,params:{f:"json"}}),o=await e(s),r=Object.assign(Object.assign({itemId:o.id,appType:"multiple",redirect_uris:["urn:ietf:wg:oauth:2.0:oob"],httpReferrers:t.httpReferrers||[],privileges:t.privileges},a),{authentication:t.authentication}),u=await l(r);await i(Object.assign(Object.assign({},a),{item:Object.assign({id:o.id},m(t,!0)),authentication:t.authentication}));const d=await n(u.itemId,Object.assign(Object.assign({},a),{authentication:t.authentication,params:{f:"json"}})),j=await O(d.id,b(t.generateToken1,t.generateToken2),Object.assign(Object.assign({},a),{authentication:t.authentication})),f=await c(Object.assign(Object.assign({},a),{itemId:d.id,authentication:t.authentication}));return Object.assign(Object.assign(Object.assign({},j),p(f)),{item:d})}async function T(e){e.httpMethod="POST";const r=g(e);if(e.apiToken1ExpirationDate||e.apiToken2ExpirationDate){const t=m(e);await i(Object.assign(Object.assign({},r),{item:Object.assign({id:e.itemId},t),authentication:e.authentication}))}if(e.privileges||e.httpReferrers){const i=Object.assign(Object.assign({},r),{authentication:e.authentication,itemId:e.itemId}),n=await c(i),p=n.client_id,u=s(Object.assign(Object.assign({},n),e),["privileges","httpReferrers"]);u.params.f="json",o(u);const g=t(u)+`/oauth2/apps/${p}/update`;await a(g,Object.assign(Object.assign({},u),{authentication:e.authentication}))}const u=await n(e.itemId,Object.assign(Object.assign({},r),{authentication:e.authentication,params:{f:"json"}})),h=await O(e.itemId,b(e.generateToken1,e.generateToken2),Object.assign(Object.assign({},r),{authentication:e.authentication})),d=await c(Object.assign(Object.assign({},r),{itemId:e.itemId,authentication:e.authentication}));return Object.assign(Object.assign(Object.assign({},h),p(d)),{item:u})}async function w(t){const e=await c(t),i=await n(t.itemId,Object.assign(Object.assign({},g(t)),{authentication:t.authentication}));return Object.assign(Object.assign({},p(e)),{item:i})}async function y(e){const i=`${t(e)}/oauth2/revokeToken`,n=await c({itemId:e.itemId,authentication:e.authentication}),s={client_id:n.client_id,client_secret:n.client_secret,apiToken:j(e.apiKey),regenerateApiToken:!0,grant_type:"client_credentials"};return a(i,{params:s})}async function k(t){const e=await c(t),i=await n(t.itemId,Object.assign(Object.assign({},g(t)),{authentication:t.authentication}));return Object.assign(Object.assign({},u(e)),{item:i})}async function I(e){e.httpMethod="POST";const i=g(e),p=Object.assign(Object.assign({},i),{authentication:e.authentication,itemId:e.itemId}),h=await c(p);if("apikey"===h.appType)throw new Error("Item is not an OAuth 2.0 app.");const d=h.client_id,j=s(Object.assign(Object.assign({},h),e),["redirect_uris"]);j.params.f="json",j.params.appType="multiple",o(j);const O=t(j)+`/oauth2/apps/${d}/update`,b=r(await a(O,Object.assign(Object.assign({},j),{authentication:e.authentication}))),m=await n(e.itemId,Object.assign(Object.assign({},i),{authentication:e.authentication,params:{f:"json"}}));return Object.assign(Object.assign({},u(b)),{item:m})}async function _(t){t.httpMethod="POST";const i=g(t),a=Object.assign(Object.assign({item:Object.assign(Object.assign({},h(t,["categories","culture","description","documentation","extent","owner","properties","snippet","spatialReference","tags","title","type","typeKeywords","url"])),{type:"Application"})},i),{authentication:t.authentication,params:{f:"json"}}),s=await e(a),c=Object.assign(Object.assign({itemId:s.id,appType:"multiple",redirect_uris:t.redirect_uris||[],httpReferrers:[],privileges:[]},i),{authentication:t.authentication}),o=await l(c),r=await n(o.itemId,Object.assign(Object.assign({},i),{authentication:t.authentication,params:{f:"json"}}));return Object.assign(Object.assign({},u(o)),{item:r})}async function x(e){e.httpMethod="POST";const i=g(e),n=Object.assign(Object.assign({},i),{authentication:e.authentication,itemId:e.itemId}),s=(await c(n)).client_id,o=t(e)+`/oauth2/apps/${s}/unregister`;return await a(o,Object.assign(Object.assign({},i),{authentication:e.authentication,params:{f:"json"}}))}export{p as appToApiKeyProperties,u as appToOAuthAppProperties,m as buildExpirationDateParams,f as createApiKey,_ as createOAuthApp,g as extractBaseRequestOptions,h as filterKeys,O as generateApiKeyTokens,b as generateOptionsToSlots,w as getApiKey,k as getOAuthApp,c as getRegisteredAppInfo,y as invalidateApiKey,l as registerApp,r as registeredAppResponseToApp,j as slotForInvalidationKey,d as slotForKey,o as stringifyArrays,x as unregisterApp,T as updateApiKey,I as updateOAuthApp};
//# sourceMappingURL=developer-credentials.esm.min.js.map
