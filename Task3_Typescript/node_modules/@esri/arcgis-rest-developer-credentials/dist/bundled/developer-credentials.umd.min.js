/* @preserve
* @esri/arcgis-rest-developer-credentials - v2.0.0 - Apache-2.0
* Copyright (c) 2017-2025 Esri, Inc.
* Wed Feb 26 2025 22:10:42 GMT+0000 (Coordinated Universal Time)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@esri/arcgis-rest-portal"),require("@esri/arcgis-rest-request")):"function"==typeof define&&define.amd?define(["exports","@esri/arcgis-rest-portal","@esri/arcgis-rest-request"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).arcgisRest=t.arcgisRest||{},t.arcgisRest,t.arcgisRest)}(this,(function(t,e,i){"use strict";async function a(t){const a=await t.authentication.getUsername(),n=e.getPortalUrl(t)+`/content/users/${a}/items/${t.itemId}/registeredAppInfo`;t.httpMethod="POST";return s(await i.request(n,Object.assign(Object.assign({},t),{params:{f:"json"}})))}const n=t=>{Object.entries(t.params).forEach((e=>{const[i,a]=e;"Array"===a.constructor.name&&(t.params[i]=JSON.stringify(a))}))};function s(t){const e=["apnsProdCert","apnsSandboxCert","gcmApiKey","isBeta","customAppLoginShowTriage"],i=["modified","registered"];return Object.keys(t).filter((t=>!e.includes(t))).reduce(((e,a)=>(i.includes(a)?e[a]=new Date(t[a]):e[a]=t[a],e)),{})}function r(t){return delete t.client_secret,delete t.redirect_uris,delete t.appType,delete t.customAppLoginShowTriage,delete t.apiKey,t}function c(t){return delete t.appType,delete t.httpReferrers,delete t.privileges,delete t.apiKey,delete t.customAppLoginShowTriage,delete t.isPersonalAPIToken,delete t.apiToken1Active,delete t.apiToken2Active,t}function o(t){return p(t,["credentials","headers","hideToken","httpMethod","maxUrlLength","portal","rawResponse","signal","suppressWarnings"])}function p(t,e){return e.reduce(((e,i)=>(i in t&&(e[i]=t[i]),e)),{})}function u(t){const e=parseInt(t.substring(t.length-10,t.length-9));if(1===e||2===e)return e}function g(t){if(1===t||2===t)return t;if("string"!=typeof t)return;const e=u(t);return e||void 0}function d(t,n,s){return Promise.all(n.map((n=>async function(t){const n=`${e.getPortalUrl(t)}/oauth2/token`,s=await a({itemId:t.itemId,authentication:t.authentication}),r={client_id:s.client_id,client_secret:s.client_secret,apiToken:t.apiKey,regenerateApiToken:!0,grant_type:"client_credentials"};return i.request(n,{params:r})}(Object.assign({itemId:t,apiKey:n},s))))).then((t=>t.map((t=>t.access_token)).reduce(((t,e,i)=>(t[`accessToken${u(e)}`]=e,t)),{})))}function h(t,e){const i=[];return t&&i.push(1),e&&i.push(2),i}function l(t,e){const i={};return t.apiToken1ExpirationDate&&(i.apiToken1ExpirationDate=t.apiToken1ExpirationDate),t.apiToken2ExpirationDate&&(i.apiToken2ExpirationDate=t.apiToken2ExpirationDate),e&&!i.apiToken1ExpirationDate&&(i.apiToken1ExpirationDate=-1),e&&!i.apiToken2ExpirationDate&&(i.apiToken2ExpirationDate=-1),i}async function m(t){const a=i.appendCustomParams(t,["itemId","appType","redirect_uris","httpReferrers","privileges"]);n(a);const r=e.getPortalUrl(a)+"/oauth2/registerApp";a.httpMethod="POST",a.params.f="json";return s(await i.request(r,a))}t.appToApiKeyProperties=r,t.appToOAuthAppProperties=c,t.buildExpirationDateParams=l,t.createApiKey=async function(t){t.httpMethod="POST";const i=o(t),n=Object.assign(Object.assign({item:Object.assign(Object.assign({},p(t,["categories","culture","description","documentation","extent","owner","properties","snippet","spatialReference","tags","title","type","typeKeywords","url"])),{type:"Application"})},i),{authentication:t.authentication,params:{f:"json"}}),s=await e.createItem(n),c=Object.assign(Object.assign({itemId:s.id,appType:"multiple",redirect_uris:["urn:ietf:wg:oauth:2.0:oob"],httpReferrers:t.httpReferrers||[],privileges:t.privileges},i),{authentication:t.authentication}),u=await m(c);await e.updateItem(Object.assign(Object.assign({},i),{item:Object.assign({id:s.id},l(t,!0)),authentication:t.authentication}));const g=await e.getItem(u.itemId,Object.assign(Object.assign({},i),{authentication:t.authentication,params:{f:"json"}})),O=await d(g.id,h(t.generateToken1,t.generateToken2),Object.assign(Object.assign({},i),{authentication:t.authentication})),j=await a(Object.assign(Object.assign({},i),{itemId:g.id,authentication:t.authentication}));return Object.assign(Object.assign(Object.assign({},O),r(j)),{item:g})},t.createOAuthApp=async function(t){t.httpMethod="POST";const i=o(t),a=Object.assign(Object.assign({item:Object.assign(Object.assign({},p(t,["categories","culture","description","documentation","extent","owner","properties","snippet","spatialReference","tags","title","type","typeKeywords","url"])),{type:"Application"})},i),{authentication:t.authentication,params:{f:"json"}}),n=await e.createItem(a),s=Object.assign(Object.assign({itemId:n.id,appType:"multiple",redirect_uris:t.redirect_uris||[],httpReferrers:[],privileges:[]},i),{authentication:t.authentication}),r=await m(s),u=await e.getItem(r.itemId,Object.assign(Object.assign({},i),{authentication:t.authentication,params:{f:"json"}}));return Object.assign(Object.assign({},c(r)),{item:u})},t.extractBaseRequestOptions=o,t.filterKeys=p,t.generateApiKeyTokens=d,t.generateOptionsToSlots=h,t.getApiKey=async function(t){const i=await a(t),n=await e.getItem(t.itemId,Object.assign(Object.assign({},o(t)),{authentication:t.authentication}));return Object.assign(Object.assign({},r(i)),{item:n})},t.getOAuthApp=async function(t){const i=await a(t),n=await e.getItem(t.itemId,Object.assign(Object.assign({},o(t)),{authentication:t.authentication}));return Object.assign(Object.assign({},c(i)),{item:n})},t.getRegisteredAppInfo=a,t.invalidateApiKey=async function(t){const n=`${e.getPortalUrl(t)}/oauth2/revokeToken`,s=await a({itemId:t.itemId,authentication:t.authentication}),r={client_id:s.client_id,client_secret:s.client_secret,apiToken:g(t.apiKey),regenerateApiToken:!0,grant_type:"client_credentials"};return i.request(n,{params:r})},t.registerApp=m,t.registeredAppResponseToApp=s,t.slotForInvalidationKey=g,t.slotForKey=u,t.stringifyArrays=n,t.unregisterApp=async function(t){t.httpMethod="POST";const n=o(t),s=Object.assign(Object.assign({},n),{authentication:t.authentication,itemId:t.itemId}),r=(await a(s)).client_id,c=e.getPortalUrl(t)+`/oauth2/apps/${r}/unregister`;return await i.request(c,Object.assign(Object.assign({},n),{authentication:t.authentication,params:{f:"json"}}))},t.updateApiKey=async function(t){t.httpMethod="POST";const s=o(t);if(t.apiToken1ExpirationDate||t.apiToken2ExpirationDate){const i=l(t);await e.updateItem(Object.assign(Object.assign({},s),{item:Object.assign({id:t.itemId},i),authentication:t.authentication}))}if(t.privileges||t.httpReferrers){const r=Object.assign(Object.assign({},s),{authentication:t.authentication,itemId:t.itemId}),c=await a(r),o=c.client_id,p=i.appendCustomParams(Object.assign(Object.assign({},c),t),["privileges","httpReferrers"]);p.params.f="json",n(p);const u=e.getPortalUrl(p)+`/oauth2/apps/${o}/update`;await i.request(u,Object.assign(Object.assign({},p),{authentication:t.authentication}))}const c=await e.getItem(t.itemId,Object.assign(Object.assign({},s),{authentication:t.authentication,params:{f:"json"}})),p=await d(t.itemId,h(t.generateToken1,t.generateToken2),Object.assign(Object.assign({},s),{authentication:t.authentication})),u=await a(Object.assign(Object.assign({},s),{itemId:t.itemId,authentication:t.authentication}));return Object.assign(Object.assign(Object.assign({},p),r(u)),{item:c})},t.updateOAuthApp=async function(t){t.httpMethod="POST";const r=o(t),p=Object.assign(Object.assign({},r),{authentication:t.authentication,itemId:t.itemId}),u=await a(p);if("apikey"===u.appType)throw new Error("Item is not an OAuth 2.0 app.");const g=u.client_id,d=i.appendCustomParams(Object.assign(Object.assign({},u),t),["redirect_uris"]);d.params.f="json",d.params.appType="multiple",n(d);const h=e.getPortalUrl(d)+`/oauth2/apps/${g}/update`,l=s(await i.request(h,Object.assign(Object.assign({},d),{authentication:t.authentication}))),m=await e.getItem(t.itemId,Object.assign(Object.assign({},r),{authentication:t.authentication,params:{f:"json"}}));return Object.assign(Object.assign({},c(l)),{item:m})},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=developer-credentials.umd.min.js.map
